import{d as Q,q as $,r as b,c as I,o as W,a as l,b as r,g as V,e,f as c,i as y,w as h,h as tt,G as et,E,t as u,l as D,u as C,n as P,F as ot,p as st,y as nt,s as at,x as z,j as it,k as lt}from"./supabase-Dkl3gFRn.js";/* empty css                   */import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function A(S){const f=await S.text();try{const i=JSON.parse(f);return String((i==null?void 0:i.detail)||(i==null?void 0:i.error)||(i==null?void 0:i.message)||f)}catch{return f||`HTTP ${S.status}`}}const dt={class:"video-page"},ut={class:"main-container"},vt={class:"sidebar"},pt={class:"sidebar-section config-section"},ct={class:"form-group"},mt={class:"input-wrapper"},gt=["type"],bt={class:"form-group"},ft={class:"checkbox-item",style:{"user-select":"none"}},yt={class:"form-group"},ht=["disabled"],kt={class:"sidebar-section"},wt={class:"form-group"},xt={class:"form-group"},_t={class:"form-group"},Ut={class:"main-content"},Ct={class:"input-grid"},St={class:"content-panel"},Rt={class:"panel-header"},Bt={class:"panel-hint"},It={class:"content-panel"},Vt={class:"upload-zone-body"},Et={class:"upload-actions"},Mt=["disabled"],Tt=["disabled"],Ht={class:"form-group",style:{"margin-top":"12px"}},Nt={class:"image-tools"},$t=["disabled"],Dt={key:0,class:"image-preview",style:{"margin-top":"12px"}},Pt=["src"],zt={class:"result-area"},At={key:0,class:"result-placeholder"},qt={key:1,class:"loading-state"},Ft={key:2,class:"result-container"},Gt={class:"content-panel",style:{"margin-bottom":"16px"}},Ot={class:"panel-header"},jt={class:"panel-hint"},Lt={style:{display:"grid",gap:"8px","font-size":"13px",color:"var(--text-secondary)"}},Jt={key:0},Kt={key:1,style:{color:"#ef4444"}},Yt={key:0,class:"result-video-container"},Xt=["src"],Zt={key:1,class:"result-actions"},Qt=["disabled"],Wt={key:0,class:"spinner-small"},te={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ee={class:"content-panel",style:{"margin-top":"16px"}},oe={style:{"white-space":"pre-wrap","margin-top":"12px","font-size":"12px",color:"var(--text-secondary)"}},se={class:"generate-section"},ne=["disabled"],ae={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ie={key:1,class:"spinner-small"},le={key:0,class:"generate-hint"},re={class:"toast-container"},de=Q({__name:"runninghub-video-page",setup(S){const f={token:"runninghub_token",autoSave:"runninghub_auto_save"},i=$({token:"",autoSave:!0}),n=$({prompt:"",imageUrl:"",resolution:"1080p",aspectRatio:"16:9",duration:4}),R=b(!1),v=b(!1),_=b(!1),k=b(!1),d=b(null),m=b(""),w=b(""),x=b([]),M=b(null),B=I(()=>!!n.prompt.trim()&&!!n.imageUrl.trim()),q=I(()=>n.prompt.trim()?n.imageUrl.trim()?"":"请输入图片 URL":"请输入提示词"),T=I(()=>{const s=n.imageUrl.trim();return!s||!/^https?:\/\//i.test(s)?"":s});function F(){var s;(s=M.value)==null||s.click()}async function H(s){k.value=!0;try{const t=new FormData;t.append("image",s);const o=await z("/api/v1/uploads/runninghub/image",{method:"POST",body:t});if(!o.ok)throw new Error(await A(o));const a=await o.json(),g=String((a==null?void 0:a.image_url)||"").trim();if(!g)throw new Error("上传失败：缺少 image_url");n.imageUrl=g,p("图片上传成功","success")}catch(t){p(String((t==null?void 0:t.message)||t||"上传失败"),"error")}finally{k.value=!1}}function G(s){var a;const t=s.target,o=(a=t==null?void 0:t.files)==null?void 0:a[0];t&&(t.value=""),o&&H(o)}function O(s){var o,a;const t=(a=(o=s.dataTransfer)==null?void 0:o.files)==null?void 0:a[0];t&&H(t)}function j(){n.imageUrl=""}async function L(){const s=n.imageUrl.trim();if(s)try{await navigator.clipboard.writeText(s),p("已复制图片链接","success")}catch{p("复制失败，请手动复制","warning")}}function p(s,t="info",o=3e3){const a=`${Date.now()}-${Math.random().toString(16).slice(2)}`,g={id:a,message:s,type:t};x.value=[...x.value,g],window.setTimeout(()=>{x.value=x.value.filter(U=>U.id!==a)},o)}function J(){i.token=localStorage.getItem(f.token)||"",localStorage.getItem(f.autoSave)==="0"&&(i.autoSave=!1)}function K(){localStorage.setItem(f.token,i.token),localStorage.setItem(f.autoSave,i.autoSave?"1":"0"),p("配置已保存","success")}function Y(s){var o,a;const t=((a=(o=s==null?void 0:s.results)==null?void 0:o[0])==null?void 0:a.url)||"";return String(t||"").trim()}async function N(s){var t,o;if(!m.value){s&&p("缺少视频链接，无法保存","warning");return}_.value=!0;try{const a={title:`RunningHub ${((t=d.value)==null?void 0:t.task_id)||""}`.trim(),model:"runninghub-video-s",prompt:n.prompt.trim(),video_url:m.value,status:"completed",metadata:{provider:"runninghub",provider_task_id:((o=d.value)==null?void 0:o.task_id)||null,resolution:n.resolution,aspect_ratio:n.aspectRatio,duration:n.duration,image_url:n.imageUrl.trim()},request:{prompt:n.prompt.trim(),resolution:n.resolution,aspect_ratio:n.aspectRatio,image_url:n.imageUrl.trim(),duration:n.duration},response:d.value},g=await nt();if(!g)throw new Error("Not authenticated");const{error:U}=await at.from("user_videos").insert({user_id:g,title:a.title,model:a.model,prompt:a.prompt,status:a.status,video_url:a.video_url,metadata:a.metadata,request:a.request,response:a.response});if(U)throw new Error(U.message);p("已保存到存储库","success")}catch(a){const g=String((a==null?void 0:a.message)||a||"保存失败");p(`保存失败：${g}`,"error")}finally{_.value=!1}}async function X(){if(!(!B.value||v.value)){v.value=!0,w.value="",d.value=null,m.value="";try{const s={"Content-Type":"application/json"};i.token.trim()&&(s["X-RunningHub-Token"]=i.token.trim());const t=await z("/api/v1/runninghub/image-to-video-realistic",{method:"POST",headers:s,body:JSON.stringify({prompt:n.prompt.trim(),resolution:n.resolution,aspect_ratio:n.aspectRatio,image_url:n.imageUrl.trim(),duration:n.duration})});if(!t.ok)throw new Error(await A(t));const o=await t.json();d.value=o;const a=Y(o);if(a){m.value=a,p("生成成功","success"),i.autoSave&&await N(!1);return}p(`已提交任务（状态：${o.status}）`,"info")}catch(s){w.value=String((s==null?void 0:s.message)||s||"生成失败")}finally{v.value=!1}}}function Z(){var t;if(!m.value)return;const s=document.createElement("a");s.href=m.value,s.download=`runninghub-${((t=d.value)==null?void 0:t.task_id)||"video"}.mp4`,s.rel="noopener",document.body.appendChild(s),s.click(),s.remove()}return W(()=>{J()}),(s,t)=>(r(),l("div",dt,[t[43]||(t[43]=V('<header class="header" data-v-b7f33b1e><div class="logo" data-v-b7f33b1e><div class="logo-icon" data-v-b7f33b1e><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" data-v-b7f33b1e><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" data-v-b7f33b1e></rect><polygon points="10 8 16 12 10 16" fill="white" stroke="none" data-v-b7f33b1e></polygon></svg></div><span data-v-b7f33b1e>RunningHub 图生视频</span></div><div class="header-actions" data-v-b7f33b1e><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;" data-v-b7f33b1e><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b7f33b1e><path d="M19 12H5M12 19l-7-7 7-7" data-v-b7f33b1e></path></svg> 返回主页面 </a><a href="/storage" class="btn btn-ghost btn-icon" title="生成记录" style="text-decoration:none;" data-v-b7f33b1e><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b7f33b1e><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-b7f33b1e></path><polyline points="7 10 12 15 17 10" data-v-b7f33b1e></polyline><line x1="12" y1="15" x2="12" y2="3" data-v-b7f33b1e></line></svg></a></div></header>',1)),e("div",ut,[e("aside",vt,[e("section",pt,[t[18]||(t[18]=e("div",{class:"section-title"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4"})]),y(" 配置 ")],-1)),e("div",ct,[t[15]||(t[15]=e("label",{class:"form-label"},"RunningHub Token（可选）",-1)),e("div",mt,[h(e("input",{type:R.value?"text":"password",class:"form-input","onUpdate:modelValue":t[0]||(t[0]=o=>i.token=o),placeholder:"后端已配置 RUNNINGHUB_API_KEY 可留空",autocomplete:"current-password"},null,8,gt),[[tt,i.token]]),e("button",{class:"toggle-visibility",type:"button",onClick:t[1]||(t[1]=o=>R.value=!R.value)},[...t[14]||(t[14]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),t[16]||(t[16]=e("div",{class:"form-hint"},"请求头：Authorization: Bearer <token>",-1))]),e("div",bt,[e("label",ft,[h(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>i.autoSave=o)},null,512),[[et,i.autoSave]]),t[17]||(t[17]=e("span",null,"生成成功后自动保存到存储库",-1))])]),e("div",yt,[e("button",{class:"btn btn-secondary",style:{width:"100%"},disabled:v.value,onClick:K}," 保存配置 ",8,ht)])]),e("section",kt,[t[25]||(t[25]=V('<div class="section-title" data-v-b7f33b1e><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b7f33b1e><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" data-v-b7f33b1e></rect><line x1="7" y1="2" x2="7" y2="22" data-v-b7f33b1e></line><line x1="17" y1="2" x2="17" y2="22" data-v-b7f33b1e></line></svg> 参数 </div>',1)),e("div",wt,[t[20]||(t[20]=e("label",{class:"form-label"},"分辨率",-1)),h(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=o=>n.resolution=o)},[...t[19]||(t[19]=[e("option",{value:"720p"},"720p",-1),e("option",{value:"1080p"},"1080p",-1)])],512),[[E,n.resolution]])]),e("div",xt,[t[22]||(t[22]=e("label",{class:"form-label"},"画幅比例",-1)),h(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=o=>n.aspectRatio=o)},[...t[21]||(t[21]=[e("option",{value:"16:9"},"16:9（横向）",-1),e("option",{value:"9:16"},"9:16（纵向）",-1)])],512),[[E,n.aspectRatio]])]),e("div",_t,[t[24]||(t[24]=e("label",{class:"form-label"},"时长（秒）",-1)),h(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=o=>n.duration=o)},[...t[23]||(t[23]=[e("option",{value:4},"4",-1),e("option",{value:8},"8",-1),e("option",{value:12},"12",-1)])],512),[[E,n.duration,void 0,{number:!0}]])])])]),e("main",Ut,[e("div",Ct,[e("div",St,[e("div",Rt,[t[26]||(t[26]=e("h3",null,"输入提示词",-1)),e("span",Bt,u(n.prompt.length)+"/1000 字符",1)]),h(e("textarea",{class:"form-input","onUpdate:modelValue":t[6]||(t[6]=o=>n.prompt=o),rows:"7",maxlength:"1000",placeholder:"例如：一位女孩在海边，风吹动头发，写实风格..."},null,512),[[D,n.prompt]])]),e("div",It,[t[30]||(t[30]=e("div",{class:"panel-header"},[e("h3",null,"输入图片"),e("span",{class:"panel-hint"},"上传后自动填充 URL")],-1)),e("div",{class:P(["upload-zone",{disabled:k.value}]),onDragenter:t[7]||(t[7]=C(()=>{},["prevent"])),onDragover:t[8]||(t[8]=C(()=>{},["prevent"])),onDrop:C(O,["prevent"])},[e("input",{ref_key:"fileInputEl",ref:M,class:"sr-only",type:"file",accept:"image/png,image/jpeg",onChange:G},null,544),e("div",Vt,[t[27]||(t[27]=e("div",{class:"upload-title"},"拖拽 PNG/JPEG 到这里",-1)),e("div",Et,[e("button",{class:"btn btn-secondary",type:"button",disabled:k.value,onClick:F},u(k.value?"上传中…":"选择图片上传"),9,Mt),e("button",{class:"btn btn-ghost",type:"button",disabled:k.value||!n.imageUrl.trim(),onClick:j}," 清除 ",8,Tt)]),t[28]||(t[28]=e("div",{class:"upload-hint"}," RunningHub 需要可公网访问的 http(s) 地址；如果你的服务在公网，请使用上传生成的链接。 ",-1))])],34),e("div",Ht,[t[29]||(t[29]=e("label",{class:"form-label"},"图片 URL",-1)),h(e("input",{class:"form-input","onUpdate:modelValue":t[9]||(t[9]=o=>n.imageUrl=o),placeholder:"https://example.com/input.png"},null,512),[[D,n.imageUrl]]),e("div",Nt,[e("button",{class:"btn btn-ghost btn-small",type:"button",disabled:!n.imageUrl.trim(),onClick:L}," 复制链接 ",8,$t)])]),T.value?(r(),l("div",Dt,[e("img",{src:T.value,alt:"input preview",style:{"max-width":"100%","border-radius":"12px"}},null,8,Pt)])):c("",!0)])]),e("div",zt,[!v.value&&!d.value?(r(),l("div",At,[...t[31]||(t[31]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}),e("polygon",{points:"10 8 16 12 10 16"})],-1),e("h3",null,"准备生成",-1),e("p",null,"填写提示词与图片 URL 后点击「生成视频」",-1)])])):c("",!0),v.value?(r(),l("div",qt,[...t[32]||(t[32]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在提交任务...",-1)])])):c("",!0),d.value&&!v.value?(r(),l("div",Ft,[e("div",Gt,[e("div",Ot,[t[33]||(t[33]=e("h3",null,"任务状态",-1)),e("span",jt,u(d.value.status),1)]),e("div",Lt,[e("div",null,[t[34]||(t[34]=e("span",{style:{color:"var(--text-muted)"}},"task_id：",-1)),y(u(d.value.task_id),1)]),d.value.prompt_tips?(r(),l("div",Jt,[t[35]||(t[35]=e("span",{style:{color:"var(--text-muted)"}},"prompt_tips：",-1)),y(u(d.value.prompt_tips),1)])):c("",!0),d.value.error_message?(r(),l("div",Kt,[t[36]||(t[36]=e("span",{style:{color:"var(--text-muted)"}},"error：",-1)),y(u(d.value.error_message),1)])):c("",!0)])]),m.value?(r(),l("div",Yt,[e("video",{src:m.value,controls:"",preload:"metadata"},null,8,Xt)])):c("",!0),m.value?(r(),l("div",Zt,[e("button",{class:"btn btn-secondary",onClick:Z},[...t[37]||(t[37]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),y(" 下载 ",-1)])]),e("button",{class:"btn btn-secondary",disabled:_.value,onClick:t[10]||(t[10]=o=>N(!0))},[_.value?(r(),l("div",Wt)):(r(),l("svg",te,[...t[38]||(t[38]=[e("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},null,-1),e("polyline",{points:"17 21 17 13 7 13 7 21"},null,-1),e("polyline",{points:"7 3 7 8 15 8"},null,-1)])])),t[39]||(t[39]=y(" 保存到存储库 ",-1))],8,Qt)])):c("",!0),e("details",ee,[t[40]||(t[40]=e("summary",{style:{cursor:"pointer","font-weight":"500"}},"查看原始响应",-1)),e("pre",oe,u(JSON.stringify(d.value,null,2)),1)])])):c("",!0)]),e("div",se,[e("button",{class:"generate-btn",disabled:!B.value||v.value,onClick:X},[v.value?(r(),l("div",ie)):(r(),l("svg",ae,[...t[41]||(t[41]=[e("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),y(" "+u(v.value?"生成中...":"生成视频"),1)],8,ne),B.value?c("",!0):(r(),l("div",le,u(q.value),1))])])]),e("div",re,[(r(!0),l(ot,null,st(x.value,o=>(r(),l("div",{key:o.id,class:P(["toast",o.type])},u(o.message),3))),128))]),w.value?(r(),l("div",{key:0,class:"error-overlay",onClick:t[13]||(t[13]=o=>w.value="")},[e("div",{class:"error-modal",onClick:t[12]||(t[12]=C(()=>{},["stop"]))},[t[42]||(t[42]=V('<div class="error-header" data-v-b7f33b1e><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b7f33b1e><circle cx="12" cy="12" r="10" data-v-b7f33b1e></circle><line x1="12" y1="8" x2="12" y2="12" data-v-b7f33b1e></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-b7f33b1e></line></svg><h3 data-v-b7f33b1e>生成失败</h3></div>',1)),e("p",null,u(w.value),1),e("button",{class:"btn btn-primary",onClick:t[11]||(t[11]=o=>w.value="")},"确定")])])):c("",!0)]))}}),ue=rt(de,[["__scopeId","data-v-b7f33b1e"]]);async function ve(){await it(),lt(ue).mount("#app")}ve();
