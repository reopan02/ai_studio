import{d as dt,a as n,b as i,n as y,e as t,s as oe,l as pe,q as b,f as u,u as Pe,t as a,T as ut,x as H,w as c,v as Zt,m as Z,r as d,c as D,y as at,o as Yt,g as ce,F as h,p as f,z as Ue,k as V,i as I,A as Me,B as Qt,C as Wt,j as es}from"./runtime-dom.esm-bundler-D9CM_geE.js";/* empty css                        */const ts=["aria-expanded","onKeydown"],ss={class:"collapsible-title"},ls={class:"collapsible-title-text"},ns={key:0,class:"collapsible-summary"},is={class:"collapsible-actions"},os={class:"collapsible-body"},De=dt({__name:"CollapsibleGroup",props:{title:{},summary:{},open:{type:Boolean}},emits:["toggle"],setup(Y,{emit:Ie}){const z=Ie;function R(){z("toggle")}return(m,ve)=>(i(),n("div",{class:y(["collapsible-group",{collapsed:!Y.open}])},[t("div",{class:"collapsible-header",role:"button",tabindex:"0","aria-expanded":Y.open,onClick:R,onKeydown:[pe(b(R,["prevent"]),["enter"]),pe(b(R,["prevent"]),["space"])]},[t("div",ss,[t("span",ls,a(Y.title),1),Pe(m.$slots,"title-extra")]),Y.open?u("",!0):(i(),n("div",ns,[Pe(m.$slots,"summary",{},()=>[t("span",null,a(Y.summary),1)])])),t("div",is,[Pe(m.$slots,"actions"),ve[0]||(ve[0]=t("span",{class:"collapsible-toggle"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"6 9 12 15 18 9"})])],-1))])],40,ts),oe(ut,{name:"collapse"},{default:H(()=>[c(t("div",os,[Pe(m.$slots,"default")],512),[[Zt,Y.open]])]),_:3})],2))}}),as={class:"ecommerce-image-page"},rs={class:"wizard-nav"},ds={class:"wizard-steps"},us=["aria-current","aria-disabled","onClick"],cs={class:"wizard-step-indicator"},ps={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},vs={key:1},ms={class:"wizard-step-label"},gs={key:0,class:"wizard-step-hint"},hs={class:"main-container"},fs={class:"sidebar"},ys={class:"sidebar-section"},bs={class:"form-group",style:{"margin-top":"16px"}},ks={class:"form-group"},ws={class:"form-group"},_s=["value"],xs={class:"sidebar-section"},Cs={class:"search-wrapper"},Ts={key:0,class:"product-list"},$s=["onClick"],Ss={class:"product-thumb-wrap"},Bs=["src","alt"],Ps={key:0,class:"product-count-badge"},Us={class:"product-info"},Ms={class:"product-name"},Ds={class:"product-meta"},Vs={key:0},Is={key:1},zs={key:2},Es={key:0,class:"spinner-small"},js={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},Ls={key:1,class:"product-list-empty"},Ks={key:2,class:"product-list-loading"},Hs={key:3,class:"pagination"},As=["disabled"],Os={class:"page-info"},Fs=["disabled"],Rs={key:0,class:"sidebar-section"},Ns={class:"section-title"},Gs={key:0,class:"image-grid"},Xs=["onClick"],qs=["src"],Js={key:0,class:"image-check"},Zs={key:1,class:"image-primary"},Ys={key:1,class:"no-images"},Qs={class:"sidebar-section"},Ws={key:0,class:"product-list"},el=["onClick"],tl=["src","alt"],sl={class:"product-info"},ll={class:"product-name"},nl={class:"product-meta"},il={key:1,class:"product-list-empty"},ol={key:2,class:"product-list-loading"},al={class:"main-content"},rl={key:0,class:"workflow-section"},dl={class:"content-panel"},ul={class:"panel-header"},cl={key:0,class:"panel-hint"},pl={key:0,class:"product-fields"},vl={class:"field-row"},ml={class:"field-checkbox"},gl=["disabled"],hl={class:"field-row"},fl={class:"field-checkbox"},yl=["disabled"],bl={class:"field-row"},kl={class:"field-checkbox"},wl=["disabled"],_l={class:"field-row"},xl={class:"field-checkbox"},Cl=["disabled"],Tl={key:1,class:"panel-empty"},$l={key:1,class:"workflow-section"},Sl={class:"content-panel"},Bl={class:"template-modules"},Pl={class:"option-chips"},Ul=["onClick"],Ml=["onUpdate:modelValue","data-option-id","onKeydown"],Dl=["onClick"],Vl=["onClick"],Il={class:"option-chips"},zl=["onClick"],El=["onUpdate:modelValue","data-option-id","onKeydown"],jl=["onClick"],Ll=["onClick"],Kl={class:"option-chips"},Hl=["onClick"],Al=["onUpdate:modelValue","data-option-id","onKeydown"],Ol=["onClick"],Fl=["onClick"],Rl={class:"target-type-selector"},Nl={class:"target-type-options"},Gl=["value","onChange"],Xl={class:"target-type-label"},ql={key:0,class:"target-description-input"},Jl={key:0,class:"saved-descriptions-section"},Zl={class:"saved-descriptions-list"},Yl=["onClick"],Ql=["onClick"],Wl=["placeholder","disabled"],en={class:"target-description-actions"},tn=["disabled"],sn=["disabled"],ln={key:1,class:"target-loading"},nn={class:"template-editor"},on={class:"template-editor-section"},an={key:2,class:"workflow-section"},rn={class:"content-panel prompt-preview-panel"},dn={class:"panel-header"},un={key:0,class:"panel-hint"},cn={class:"prompt-structured"},pn={class:"prompt-row"},vn={key:1,class:"prompt-empty"},mn={class:"prompt-row"},gn={key:1,class:"prompt-empty"},hn={class:"prompt-row"},fn={key:1,class:"prompt-empty"},yn={class:"prompt-row"},bn={key:1,class:"prompt-empty"},kn={class:"prompt-row"},wn={key:0,class:"prompt-chip target-chip"},_n={key:0,class:"target-chip-name"},xn={key:1,class:"prompt-empty"},Cn={class:"prompt-full"},Tn={class:"prompt-full-header"},$n=["disabled"],Sn={class:"prompt-full-body"},Bn={key:0},Pn={key:1,class:"prompt-placeholder"},Un={key:3,class:"workflow-section"},Mn={class:"content-panel"},Dn={class:"panel-header"},Vn={key:0,class:"panel-hint"},In={class:"result-area"},zn={key:0,class:"result-placeholder"},En={key:1,class:"loading-state"},jn={key:0},Ln={key:1},Kn={key:2,class:"result-container"},Hn=["src"],An={class:"result-image-overlay"},On=["onClick"],Fn={class:"result-actions"},Rn={class:"generate-section"},Nn=["disabled"],Gn={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Xn={key:1,class:"spinner-small"},qn={key:0,class:"generate-hint"},Jn={class:"preview-panel"},Zn={class:"preview-card"},Yn={class:"preview-card-header"},Qn={key:0,class:"preview-card-hint"},Wn={class:"preview-card-body"},ei={key:0},ti={key:1,class:"preview-placeholder"},si={class:"preview-card"},li={class:"preview-card-header"},ni={key:0,class:"preview-count"},ii={class:"preview-card-body preview-result"},oi={key:0,class:"preview-loading"},ai={key:0},ri={key:1},di={key:1,class:"preview-images-grid"},ui=["src"],ci={key:2,class:"preview-placeholder"},pi={class:"toast-container"},vi={class:"save-dialog-header"},mi={class:"save-dialog-body"},gi={class:"form-group"},hi={class:"form-group"},fi=["value"],yi={class:"save-dialog-footer"},bi=["disabled"],rt="",Ve=10,ki=dt({__name:"ecommerce-image-page",setup(Y){const Ie=[{id:"target-main",name:"主图",placeholder:"请描述主图的展示重点，如产品摆放方式、突出的卖点...",default_template:"适合电商主图展示的产品图，突出产品整体外观，简洁大方",sort_order:0},{id:"target-detail",name:"详情页",placeholder:"请描述详情页需要展示的产品细节或使用场景...",default_template:"适合详情页的产品展示图，展现产品细节和使用场景",sort_order:1},{id:"target-poster",name:"海报",placeholder:"请描述海报的主题和风格，如促销活动、节日氛围...",default_template:"具有视觉冲击力的营销海报风格，适合活动推广",sort_order:2},{id:"target-white",name:"白底图",placeholder:"请描述白底图的拍摄角度和展示方式...",default_template:"纯白色背景的产品图，适合平台商品展示",sort_order:3},{id:"target-scene",name:"场景图",placeholder:"请描述期望的使用场景和环境氛围...",default_template:"产品在真实使用场景中的展示图，增强代入感",sort_order:4}],z={scene:[{id:"scene-white",label:"白色背景"},{id:"scene-natural-table",label:"自然光桌面"},{id:"scene-outdoor",label:"户外场景"},{id:"scene-solid",label:"纯色背景"},{id:"scene-life",label:"生活场景"}],angle:[{id:"angle-front",label:"正面"},{id:"angle-45",label:"45度侧面"},{id:"angle-top",label:"俯视"},{id:"angle-eye",label:"平视"},{id:"angle-close",label:"特写"}],style:[{id:"style-soft",label:"柔和光影"},{id:"style-contrast",label:"高对比度"},{id:"style-natural",label:"自然光"},{id:"style-studio",label:"专业棚拍"},{id:"style-warm",label:"暖色调"}],target:[{id:"target-main",label:"主图"},{id:"target-detail",label:"详情页"},{id:"target-poster",label:"海报"},{id:"target-white",label:"白底图"},{id:"target-scene",label:"场景图"}]},R=Z({apiKey:"",baseUrl:""}),m=Z({model:"gemini-3-pro-image-preview",aspectRatio:"",imageSize:"1K",generateCount:1}),ve=[{id:1,title:"选择产品"},{id:2,title:"配置模板"},{id:3,title:"预览提示词"},{id:4,title:"生成图片"}],E=d(1),ae=d(""),me=d([]),ge=d(!1),he=d(""),A=d(1),ze=d(0),B=d(null),j=d([]),$=d([]),re=d(null),fe=d([]),ye=d(!1),ct="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
  <rect width="100" height="100" fill="#1a1a2e"/>
  <rect x="25" y="25" width="50" height="50" rx="4" fill="none" stroke="#4a4a6a" stroke-width="2"/>
  <circle cx="38" cy="38" r="5" fill="#4a4a6a"/>
  <path d="M25 65 L45 45 L55 55 L75 35 L75 75 L25 75 Z" fill="#4a4a6a" opacity="0.5"/>
</svg>
`),k=Z({name:"",dimensions:"",featuresText:"",characteristicsText:""}),de=d([]),Ee=d(!1),L=d(null),T=d(""),pt=d(!1),se=d(!1),N=d([]),le=d(!1),Q=d(null),ue=d(""),W=D(()=>L.value&&de.value.find(l=>l.id===L.value)||null),vt=D(()=>{var l;return((l=W.value)==null?void 0:l.placeholder)||"请描述您期望的生成效果..."}),w=Z({name:!0,dimensions:!0,features:!0,characteristics:!0}),p=Z({scene:z.scene.map(l=>({...l})),angle:z.angle.map(l=>({...l})),style:z.style.map(l=>({...l})),target:z.target.map(l=>({...l}))}),C=Z({scene:[],angle:[],style:[],target:[]}),G=Z({scene:!0,angle:!1,style:!1,target:!1}),be=d(!1),_=Z({category:"",id:""}),X=d(rt),M=d(!1),g=d([]),O=d({current:0,total:0}),ne=d(""),ke=d([]),je=D(()=>Math.ceil(ze.value/Ve));function Le(l){return globalThis.crypto&&"randomUUID"in globalThis.crypto?`${l}-${globalThis.crypto.randomUUID()}`:`${l}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function We(l){return l.split(`
`).map(e=>e.trim()).filter(Boolean)}function et(l){return l.filter(Boolean).join("、")}function we(l){const e=new Set(C[l]);return p[l].filter(s=>e.has(s.id)).map(s=>s.label.trim()).filter(Boolean)}function F(l,e){return _.category===l&&_.id===e}const ee=D(()=>({scene:we("scene"),angle:we("angle"),style:we("style"),target:we("target")})),mt=D(()=>C.scene.length>0||C.angle.length>0||C.style.length>0||!!L.value);function Ke(l){const e=ee.value[l];return e.length?e.length<=2?e.join("、"):`${e[0]}、${e[1]} 等${e.length}项`:"未选择"}function _e(l){G[l]=!G[l],be.value=!0}function He(l=!1){if(be.value&&!l)return;const e=["scene","angle","style","target"];let s=!1;e.forEach(o=>{!s&&C[o].length===0?(G[o]=!0,s=!0):G[o]=!1}),be.value=!1}const Ae=D(()=>{const l=[],e=k.name.trim(),s=k.dimensions.trim();return w.name&&e&&l.push(e),w.dimensions&&s&&l.push(s),w.features&&l.push(...We(k.featuresText)),w.characteristics&&l.push(...We(k.characteristicsText)),l}),P=D(()=>({product:Ae.value,scene:ee.value.scene,angle:ee.value.angle,style:ee.value.style,target:T.value?[T.value]:[]}));function Oe(l,e){return e.length?`${l}：${et(e)}`:""}function tt(l){return l.replace(/[，、]{2,}/g,"，").replace(/^[，、\s]+/,"").replace(/[，、\s]+$/,"").replace(/\s*[，、]\s*/g,"，").trim()}function Fe(l){if(!l)return"";const e=l.trim();if(!e.includes("{{"))return e;const s=e.replace(/\{\{(\w+)(?:\|([^}]*))?\}\}/g,(o,r,v)=>v??"");return tt(s)}const S=D(()=>{if(!B.value)return"";const l=[];Ae.value.length&&l.push(et(Ae.value));const e=Oe("场景",ee.value.scene);e&&l.push(e);const s=Oe("拍摄角度",ee.value.angle);s&&l.push(s);const o=Oe("风格",ee.value.style);o&&l.push(o);const r=T.value.trim();r&&l.push(r);const v=Fe(X.value);return v&&l.push(v),tt(l.join("，"))}),st=D(()=>B.value&&$.value.length>0&&S.value.length>0),xe=D(()=>M.value?"正在生成图片...":B.value?$.value.length===0?"请选择至少一张参考图片":S.value?"":"请完善模板选项或产品信息":"请先在左侧选择产品");function q(l){return l===1?!!B.value&&$.value.length>0:l===2?mt.value:l===3?S.value.length>0:l===4?g.value.length>0:!1}const lt=D(()=>q(1)?q(2)?q(3)?4:3:2:1);function Re(l){return l<=lt.value}function gt(){return q(1)?q(2)?q(3)?"请先完成前置步骤":"请先完成步骤3：完善提示词预览":"请先完成步骤2：至少选择一个模板选项":"请先完成步骤1：选择产品并勾选参考图"}function ht(l){if(Re(l)){E.value=l,ae.value="";return}ae.value=gt()}function Ne(){const l=document.cookie.match(/csrf_token=([^;]+)/);return l?l[1]:""}function ft(l){return String(l||"").trim().replace(/^bearer\s+/i,"").trim()}function yt(l){return String(l||"").trim()||null}function nt(l){if(!l||typeof l!="object")return null;if(Array.isArray(l.data)&&l.data[0]){const e=l.data[0];if(e!=null&&e.url)return e.url;if(e!=null&&e.b64_json)return`data:image/png;base64,${e.b64_json}`}return l.url?l.url:l.b64_json?`data:image/png;base64,${l.b64_json}`:l.image_url?l.image_url:null}async function Ce(){ge.value=!0;try{const l=new URLSearchParams({offset:String((A.value-1)*Ve),limit:String(Ve)});he.value&&l.set("name",he.value);const e=await fetch(`/api/v1/products?${l}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch products");const s=await e.json();me.value=s.products||[],ze.value=s.total||0}catch{U("加载产品列表失败","error")}finally{ge.value=!1}}function bt(){A.value=1,Ce()}async function it(){ye.value=!0;try{const l=await fetch("/api/v1/images?limit=20",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch history");const e=await l.json();fe.value=e||[]}catch(l){console.error("Failed to load history:",l)}finally{ye.value=!1}}function kt(l){l.image_url&&(g.value=[l.image_url],E.value=4)}function wt(l,e){return l?l.length<=e?l:l.substring(0,e)+"...":""}function _t(l){return l?new Date(l).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}async function xt(){Ee.value=!0;try{const l=await fetch("/api/v1/target-types",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch target types");const e=await l.json();de.value=e.target_types||[]}catch{console.warn("Failed to load target types from API, using defaults"),de.value=[...Ie]}finally{Ee.value=!1}}async function Ct(l){if(!l){N.value=[];return}try{const e=await fetch(`/api/v1/target-descriptions?target_type_id=${encodeURIComponent(l)}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch saved descriptions");const s=await e.json();N.value=s.descriptions||[]}catch(e){console.warn("Failed to load saved descriptions:",e),N.value=[]}}function Tt(l){T.value=l.description,Q.value=l.id}async function $t(){const l=L.value,e=ue.value.trim(),s=T.value.trim();if(!l||!e||!s){U("请填写名称和描述","error");return}se.value=!0;try{const o={target_type_id:l,name:e,description:s},r=await fetch("/api/v1/target-descriptions",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":Ne()},body:JSON.stringify(o)});if(!r.ok){const te=await r.json().catch(()=>({}));throw new Error(te.detail||`HTTP ${r.status}`)}const v=await r.json();N.value.unshift(v),Q.value=v.id,le.value=!1,ue.value="",U("描述已保存","success")}catch(o){U(o.message||"保存描述失败","error")}finally{se.value=!1}}async function St(l){if(confirm("确定要删除这个保存的描述吗？"))try{const e=await fetch(`/api/v1/target-descriptions/${l}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":Ne()}});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||`HTTP ${e.status}`)}N.value=N.value.filter(s=>s.id!==l),Q.value===l&&(Q.value=null),U("描述已删除","success")}catch(e){U(e.message||"删除描述失败","error")}}function Bt(){const l=W.value;l&&(T.value=l.default_template||"",Q.value=null)}async function Pt(l){const e=L.value;if(L.value=l,e!==l){Q.value=null;const s=de.value.find(o=>o.id===l);T.value=(s==null?void 0:s.default_template)||"",await Ct(l)}}function Ut(){A.value>1&&(A.value--,Ce())}function Mt(){A.value<je.value&&(A.value++,Ce())}function Dt(l){if(l.images&&l.images.length>0){const e=l.images.find(s=>s.is_primary);return e?e.image_url:l.images[0].image_url}return l.original_image_url||"/static/placeholder.png"}async function Vt(l){var e;if(l!=null&&l.id&&((e=B.value)==null?void 0:e.id)!==l.id&&!re.value){re.value=l.id;try{const s=await fetch(`/api/v1/products/${l.id}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to load product details");const o=await s.json();B.value=o,k.name=o.name||"",k.dimensions=o.dimensions||"",k.featuresText=(o.features||[]).join(`
`),k.characteristicsText=(o.characteristics||[]).join(`
`),j.value=o.images||[],j.value.length===0&&o.original_image_url&&(j.value=[{id:o.id,image_url:o.original_image_url,is_primary:!0}]);const r=j.value.find(v=>v.is_primary);r?$.value=[r.id]:j.value.length>0?$.value=[j.value[0].id]:$.value=[]}catch{U("加载产品详情失败","error")}finally{re.value=null}}}function It(l){const e=$.value.indexOf(l);e===-1?$.value.push(l):$.value.splice(e,1)}function zt(l,e){return p[l].find(s=>s.id===e)??null}function Et(l){Wt(()=>{const e=document.querySelector(`.option-edit-input[data-option-id="${l}"]`);e&&(e.focus(),e.select())})}function Ge(l,e){const s=C[l],o=s.indexOf(e);o===-1?s.push(e):s.splice(o,1)}function Xe(l){const e={id:Le(l),label:"新选项"};p[l].push(e),qe(),$e(l,e.id)}function Te(l,e){const s=p[l].findIndex(r=>r.id===e);if(s===-1)return;p[l].splice(s,1);const o=C[l].indexOf(e);o!==-1&&C[l].splice(o,1),_.category===l&&_.id===e&&(_.category="",_.id=""),qe()}function $e(l,e){_.category=l,_.id=e,Et(e)}function ie(){if(!_.category||!_.id)return;const l=_.category,e=_.id;_.category="",_.id="";const s=zt(l,e);if(!s)return;const o=s.label.trim();if(!o){Te(l,e);return}s.label=o,qe()}function jt(){p.scene=z.scene.map(l=>({...l})),p.angle=z.angle.map(l=>({...l})),p.style=z.style.map(l=>({...l})),p.target=z.target.map(l=>({...l})),C.scene=[],C.angle=[],C.style=[],C.target=[],_.category="",_.id="",be.value=!1,He(!0),localStorage.removeItem("ecommerce-image-templates"),U("模板已重置为默认值","success")}function qe(){const l={version:2,templates:{scene:p.scene.map(e=>({id:e.id,label:e.label})),angle:p.angle.map(e=>({id:e.id,label:e.label})),style:p.style.map(e=>({id:e.id,label:e.label})),target:p.target.map(e=>({id:e.id,label:e.label}))}};localStorage.setItem("ecommerce-image-templates",JSON.stringify(l))}function Se(l,e){if(!Array.isArray(l))return null;const s=[];for(const o of l){if(typeof o=="string"){const r=o.trim();r&&s.push({id:Le(e),label:r});continue}if(o&&typeof o=="object"){const r=typeof o.label=="string"?o.label.trim():"";if(!r)continue;const v=typeof o.id=="string"?String(o.id):Le(e);s.push({id:v,label:r})}}return s.length?s:null}function Lt(){const l=localStorage.getItem("ecommerce-image-templates");if(l)try{const e=JSON.parse(l),s=(e==null?void 0:e.templates)||e,o=Se(s==null?void 0:s.scene,"scene"),r=Se(s==null?void 0:s.angle,"angle"),v=Se(s==null?void 0:s.style,"style"),te=Se(s==null?void 0:s.target,"target");o&&(p.scene=o),r&&(p.angle=r),v&&(p.style=v),te&&(p.target=te)}catch{}}function Kt(){const l=Fe(X.value);l!==X.value&&(X.value=l),localStorage.setItem("ecommerce-image-prompt-template",l)}function Ht(){const l=localStorage.getItem("ecommerce-image-prompt-template");l&&(X.value=Fe(l))}function At(){X.value=rt,localStorage.removeItem("ecommerce-image-prompt-template"),U("提示词模板已重置为默认值","success")}function Ot(){R.apiKey=localStorage.getItem("global_api_key")||localStorage.getItem("video_api_key")||"",R.baseUrl=localStorage.getItem("global_base_url")||localStorage.getItem("video_base_url")||""}async function Ft(){if(S.value)try{await navigator.clipboard.writeText(S.value),U("提示词已复制到剪贴板","success")}catch{U("复制失败","error")}}async function ot(){var e;if(!st.value||M.value)return;M.value=!0,ne.value="",g.value=[];const l=m.generateCount;O.value={current:0,total:l};try{const s={"X-CSRF-Token":Ne()},o=ft(R.apiKey);o&&(s["X-API-Key"]=o);const r=yt(R.baseUrl);r&&(s["X-Base-Url"]=r);const v=[];for(const x of $.value){const J=j.value.find(K=>K.id===x);if(J)try{const Ye=await(await fetch(J.image_url)).blob();v.push({id:x,blob:Ye})}catch{console.warn("Failed to fetch reference image:",J.image_url)}}const te=async()=>{const x=new FormData;x.append("prompt",S.value),x.append("model",m.model),x.append("response_format","url"),m.aspectRatio&&x.append("aspect_ratio",m.aspectRatio),m.imageSize&&x.append("image_size",m.imageSize);for(const{id:Qe,blob:Jt}of v)x.append("image",Jt,`ref-${Qe}.jpg`);const J=await fetch("/api/v1/images/edits",{method:"POST",credentials:"include",headers:s,body:x});if(!J.ok){const Qe=await J.json().catch(()=>({}));throw new Error(Qe.detail||`HTTP ${J.status}`)}const K=await J.json(),Ye=K&&typeof K=="object"&&K.response?K.response:K,qt=nt(Ye)||nt(K);return O.value.current++,qt},Gt=Array.from({length:l},()=>te()),Xt=await Promise.allSettled(Gt),Be=[],Ze=[];for(const x of Xt)x.status==="fulfilled"&&x.value?Be.push(x.value):x.status==="rejected"&&Ze.push(((e=x.reason)==null?void 0:e.message)||"生成失败");if(Be.length>0)g.value=Be,U(`成功生成 ${Be.length} 张图片`,"success"),it();else throw Ze.length>0?new Error(Ze[0]):new Error("Invalid response format")}catch(s){ne.value=s.message||"生成失败，请重试"}finally{M.value=!1,O.value={current:0,total:0}}}function Je(l,e){if(!l)return;const s=document.createElement("a");s.href=l,s.download=`ecommerce-${Date.now()}-${e+1}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s)}async function Rt(){if(g.value.length!==0)for(let l=0;l<g.value.length;l++)Je(g.value[l],l),l<g.value.length-1&&await new Promise(e=>setTimeout(e,300))}let Nt=0;function U(l,e="info"){const s=Nt++;ke.value.push({id:s,message:l,type:e}),setTimeout(()=>{const o=ke.value.findIndex(r=>r.id===s);o!==-1&&ke.value.splice(o,1)},3e3)}return at(E,l=>{ae.value="",l===2&&He()}),at(lt,l=>{E.value>l&&(E.value=l)}),Yt(()=>{Lt(),Ht(),Ot(),Ce(),xt(),it(),He(!0)}),(l,e)=>(i(),n("div",as,[e[104]||(e[104]=ce('<header class="header"><div class="logo"><div class="logo-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></div><span>电商图生成</span></div><div class="header-actions"><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> 返回主页面 </a></div></header>',1)),t("nav",rs,[t("div",ds,[(i(),n(h,null,f(ve,s=>t("button",{key:s.id,class:y(["wizard-step",{active:E.value===s.id,completed:q(s.id),disabled:!Re(s.id)}]),"aria-current":E.value===s.id?"step":void 0,"aria-disabled":!Re(s.id),onClick:o=>ht(s.id)},[t("span",cs,[q(s.id)?(i(),n("svg",ps,[...e[33]||(e[33]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(i(),n("span",vs,a(s.id),1))]),t("span",ms,a(s.title),1)],10,us)),64))]),ae.value?(i(),n("div",gs,a(ae.value),1)):u("",!0)]),t("div",hs,[t("aside",fs,[t("section",ys,[e[40]||(e[40]=ce('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg> Model Selection </div>',1)),c(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=s=>m.model=s)},[...e[34]||(e[34]=[t("option",{value:"gemini-3-pro-image-preview"},"gemini-3-pro-image-preview (推荐)",-1),t("option",{value:"gemini-2.5-flash-image"},"gemini-2.5-flash-image (快速)",-1)])],512),[[Ue,m.model]]),t("div",bs,[e[36]||(e[36]=t("label",{class:"form-label"},"Aspect Ratio",-1)),c(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>m.aspectRatio=s)},[...e[35]||(e[35]=[ce('<option value="">Auto</option><option value="1:1">1:1 (Square)</option><option value="16:9">16:9 (Landscape)</option><option value="9:16">9:16 (Portrait)</option><option value="4:3">4:3</option><option value="3:4">3:4</option><option value="3:2">3:2</option><option value="2:3">2:3</option><option value="4:5">4:5</option><option value="5:4">5:4</option>',10)])],512),[[Ue,m.aspectRatio]])]),t("div",ks,[e[38]||(e[38]=t("label",{class:"form-label"},"Image Size",-1)),c(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=s=>m.imageSize=s)},[...e[37]||(e[37]=[t("option",{value:""},"Default",-1),t("option",{value:"1K"},"1K",-1),t("option",{value:"2K"},"2K",-1),t("option",{value:"4K"},"4K",-1)])],512),[[Ue,m.imageSize]])]),t("div",ws,[e[39]||(e[39]=t("label",{class:"form-label"},"生成数量",-1)),c(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=s=>m.generateCount=s)},[(i(),n(h,null,f(4,s=>t("option",{key:s,value:s},a(s)+" 张",9,_s)),64))],512),[[Ue,m.generateCount]])])]),t("section",xs,[e[47]||(e[47]=ce('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Z"></path><path d="M9 2v5"></path><path d="M15 2v5"></path><path d="M2 9h20"></path></svg> 选择产品 </div>',1)),t("div",Cs,[e[41]||(e[41]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)),c(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[4]||(e[4]=s=>he.value=s),placeholder:"搜索产品...",onInput:bt},null,544),[[V,he.value]])]),!ge.value&&me.value.length>0?(i(),n("div",Ts,[(i(!0),n(h,null,f(me.value,s=>{var o,r,v;return i(),n("div",{key:s.id,class:y(["product-item",{selected:((o=B.value)==null?void 0:o.id)===s.id,loading:re.value===s.id}]),onClick:te=>Vt(s)},[t("div",Ss,[t("img",{src:Dt(s),alt:s.name,class:"product-thumb"},null,8,Bs),s.image_count>1?(i(),n("span",Ps,a(s.image_count),1)):u("",!0)]),t("div",Us,[t("div",Ms,a(s.name||"未命名产品"),1),t("div",Ds,[s.dimensions?(i(),n("span",Vs,a(s.dimensions),1)):u("",!0),s.dimensions&&s.image_count?(i(),n("span",Is,"·")):u("",!0),s.image_count?(i(),n("span",zs,a(s.image_count)+" 张",1)):u("",!0)])]),t("div",{class:y(["product-select-indicator",{active:((r=B.value)==null?void 0:r.id)===s.id}])},[re.value===s.id?(i(),n("div",Es)):((v=B.value)==null?void 0:v.id)===s.id?(i(),n("svg",js,[...e[42]||(e[42]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):u("",!0)],2)],10,$s)}),128))])):!ge.value&&me.value.length===0?(i(),n("div",Ls,[...e[43]||(e[43]=[t("p",null,"暂无产品",-1),t("a",{href:"/products",class:"btn btn-secondary btn-sm"},"前往产品库",-1)])])):(i(),n("div",Ks,[...e[44]||(e[44]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])])),ze.value>Ve?(i(),n("div",Hs,[t("button",{class:"btn btn-ghost btn-sm",disabled:A.value<=1,onClick:Ut},[...e[45]||(e[45]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)])],8,As),t("span",Os,a(A.value)+" / "+a(je.value),1),t("button",{class:"btn btn-ghost btn-sm",disabled:A.value>=je.value,onClick:Mt},[...e[46]||(e[46]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 18 15 12 9 6"})],-1)])],8,Fs)])):u("",!0)]),B.value?(i(),n("section",Rs,[t("div",Ns,[e[48]||(e[48]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("polyline",{points:"21 15 16 10 5 21"})],-1)),I(" 参考图片 ("+a($.value.length)+"/"+a(j.value.length)+") ",1)]),j.value.length>0?(i(),n("div",Gs,[(i(!0),n(h,null,f(j.value,s=>(i(),n("div",{key:s.id,class:y(["image-item",{selected:$.value.includes(s.id)}]),onClick:o=>It(s.id)},[t("img",{src:s.image_url,alt:"Product image"},null,8,qs),$.value.includes(s.id)?(i(),n("div",Js,[...e[49]||(e[49]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white","stroke-width":"3"},[t("polyline",{points:"20 6 9 17 4 12"})],-1)])])):u("",!0),s.is_primary?(i(),n("div",Zs,"主图")):u("",!0)],10,Xs))),128))])):(i(),n("div",Ys,[...e[50]||(e[50]=[t("p",null,"该产品暂无图片",-1)])]))])):u("",!0),t("section",Qs,[e[53]||(e[53]=t("div",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})]),I(" 生成历史 ")],-1)),!ye.value&&fe.value.length>0?(i(),n("div",Ws,[(i(!0),n(h,null,f(fe.value,s=>(i(),n("div",{key:s.id,class:"product-item",onClick:o=>kt(s)},[t("img",{src:s.image_url||ct,alt:s.prompt,class:"product-thumb"},null,8,tl),t("div",sl,[t("div",ll,a(wt(s.prompt,30)),1),t("div",nl,a(_t(s.created_at)),1)])],8,el))),128))])):!ye.value&&fe.value.length===0?(i(),n("div",il,[...e[51]||(e[51]=[t("p",null,"暂无生成历史",-1)])])):(i(),n("div",ol,[...e[52]||(e[52]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])]))])]),t("main",al,[oe(ut,{name:"step-fade",mode:"out-in"},{default:H(()=>[E.value===1?(i(),n("section",rl,[t("div",dl,[t("div",ul,[e[54]||(e[54]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"1"),t("div",null,[t("h3",null,"产品选择"),t("p",{class:"panel-subtitle"},"选择产品与参考图，并完善提示词字段")])],-1)),B.value?u("",!0):(i(),n("span",cl,"请先从左侧选择产品"))]),B.value?(i(),n("div",pl,[t("div",vl,[t("label",ml,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>w.name=s)},null,512),[[Me,w.name]]),e[55]||(e[55]=t("span",null,"产品名称",-1))]),c(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[6]||(e[6]=s=>k.name=s),disabled:!w.name,placeholder:"例如：保温杯"},null,8,gl),[[V,k.name]])]),t("div",hl,[t("label",fl,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>w.dimensions=s)},null,512),[[Me,w.dimensions]]),e[56]||(e[56]=t("span",null,"尺寸规格",-1))]),c(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[8]||(e[8]=s=>k.dimensions=s),disabled:!w.dimensions,placeholder:"例如：500ml"},null,8,yl),[[V,k.dimensions]])]),t("div",bl,[t("label",kl,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>w.features=s)},null,512),[[Me,w.features]]),e[57]||(e[57]=t("span",null,"功能特征",-1))]),c(t("textarea",{class:"form-input","onUpdate:modelValue":e[10]||(e[10]=s=>k.featuresText=s),disabled:!w.features,rows:"2",placeholder:"每行一个特征"},null,8,wl),[[V,k.featuresText]])]),t("div",_l,[t("label",xl,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=s=>w.characteristics=s)},null,512),[[Me,w.characteristics]]),e[58]||(e[58]=t("span",null,"产品特点",-1))]),c(t("textarea",{class:"form-input","onUpdate:modelValue":e[12]||(e[12]=s=>k.characteristicsText=s),disabled:!w.characteristics,rows:"2",placeholder:"每行一个特点"},null,8,Cl),[[V,k.characteristicsText]])])])):(i(),n("div",Tl," 选择产品后将自动填充名称、规格与特征信息。 "))])])):E.value===2?(i(),n("section",$l,[t("div",Sl,[t("div",{class:"panel-header"},[e[60]||(e[60]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"2"),t("div",null,[t("h3",null,"模板配置"),t("p",{class:"panel-subtitle"},"点击标签可多选，支持就地编辑")])],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:jt},[...e[59]||(e[59]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),I(" 重置模板 ",-1)])])]),t("div",Bl,[oe(De,{title:"场景选择",summary:Ke("scene"),open:G.scene,onToggle:e[14]||(e[14]=s=>_e("scene"))},{actions:H(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[13]||(e[13]=b(s=>Xe("scene"),["stop"]))},[...e[61]||(e[61]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:H(()=>[t("div",Pl,[(i(!0),n(h,null,f(p.scene,s=>(i(),n("div",{key:s.id,class:y(["option-chip",{selected:C.scene.includes(s.id),editing:F("scene",s.id)}])},[F("scene",s.id)?c((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:ie,onKeydown:pe(b(ie,["prevent"]),["enter"])},null,40,Ml)),[[V,s.label]]):(i(),n("span",{key:0,onClick:o=>Ge("scene",s.id)},a(s.label),9,Ul)),F("scene",s.id)?u("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:b(o=>$e("scene",s.id),["stop"])},[...e[62]||(e[62]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Dl)),t("button",{class:"chip-delete",onClick:b(o=>Te("scene",s.id),["stop"])},[...e[63]||(e[63]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Vl)],2))),128))])]),_:1},8,["summary","open"]),oe(De,{title:"拍摄角度",summary:Ke("angle"),open:G.angle,onToggle:e[16]||(e[16]=s=>_e("angle"))},{actions:H(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[15]||(e[15]=b(s=>Xe("angle"),["stop"]))},[...e[64]||(e[64]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:H(()=>[t("div",Il,[(i(!0),n(h,null,f(p.angle,s=>(i(),n("div",{key:s.id,class:y(["option-chip",{selected:C.angle.includes(s.id),editing:F("angle",s.id)}])},[F("angle",s.id)?c((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:ie,onKeydown:pe(b(ie,["prevent"]),["enter"])},null,40,El)),[[V,s.label]]):(i(),n("span",{key:0,onClick:o=>Ge("angle",s.id)},a(s.label),9,zl)),F("angle",s.id)?u("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:b(o=>$e("angle",s.id),["stop"])},[...e[65]||(e[65]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,jl)),t("button",{class:"chip-delete",onClick:b(o=>Te("angle",s.id),["stop"])},[...e[66]||(e[66]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Ll)],2))),128))])]),_:1},8,["summary","open"]),oe(De,{title:"风格 / 光影",summary:Ke("style"),open:G.style,onToggle:e[18]||(e[18]=s=>_e("style"))},{"title-extra":H(()=>[...e[67]||(e[67]=[t("span",{class:"optional-tag"},"(可选)",-1)])]),actions:H(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[17]||(e[17]=b(s=>Xe("style"),["stop"]))},[...e[68]||(e[68]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:H(()=>[t("div",Kl,[(i(!0),n(h,null,f(p.style,s=>(i(),n("div",{key:s.id,class:y(["option-chip",{selected:C.style.includes(s.id),editing:F("style",s.id)}])},[F("style",s.id)?c((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:ie,onKeydown:pe(b(ie,["prevent"]),["enter"])},null,40,Al)),[[V,s.label]]):(i(),n("span",{key:0,onClick:o=>Ge("style",s.id)},a(s.label),9,Hl)),F("style",s.id)?u("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:b(o=>$e("style",s.id),["stop"])},[...e[69]||(e[69]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Ol)),t("button",{class:"chip-delete",onClick:b(o=>Te("style",s.id),["stop"])},[...e[70]||(e[70]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Fl)],2))),128))])]),_:1},8,["summary","open"]),oe(De,{title:"生成目标",summary:W.value?W.value.name:"未选择",open:G.target,onToggle:e[22]||(e[22]=s=>_e("target"))},{default:H(()=>[t("div",Rl,[t("div",Nl,[(i(!0),n(h,null,f(de.value,s=>(i(),n("label",{key:s.id,class:y(["target-type-radio",{selected:L.value===s.id}])},[c(t("input",{type:"radio",name:"target-type",value:s.id,"onUpdate:modelValue":e[19]||(e[19]=o=>L.value=o),onChange:o=>Pt(s.id)},null,40,Gl),[[Qt,L.value]]),t("span",Xl,a(s.name),1)],2))),128))]),L.value?(i(),n("div",ql,[N.value.length>0?(i(),n("div",Jl,[e[72]||(e[72]=t("label",{class:"target-description-label"},"已保存的描述",-1)),t("div",Zl,[(i(!0),n(h,null,f(N.value,s=>(i(),n("div",{key:s.id,class:y(["saved-description-item",{active:Q.value===s.id}])},[t("button",{class:"saved-description-btn",onClick:o=>Tt(s)},a(s.name),9,Yl),t("button",{class:"saved-description-delete",onClick:b(o=>St(s.id),["stop"]),title:"删除"},[...e[71]||(e[71]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Ql)],2))),128))])])):u("",!0),e[74]||(e[74]=t("label",{class:"target-description-label"},"目标描述",-1)),c(t("textarea",{class:"form-input target-textarea","onUpdate:modelValue":e[20]||(e[20]=s=>T.value=s),placeholder:vt.value,disabled:pt.value||se.value,rows:"3"},null,8,Wl),[[V,T.value]]),t("div",en,[t("button",{class:"btn btn-secondary btn-sm",type:"button",onClick:e[21]||(e[21]=s=>le.value=!0),disabled:!T.value.trim()||se.value},[...e[73]||(e[73]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),t("polyline",{points:"17 21 17 13 7 13 7 21"}),t("polyline",{points:"7 3 7 8 15 8"})],-1),I(" 保存描述 ",-1)])],8,tn),t("button",{class:"btn btn-ghost btn-sm",type:"button",onClick:Bt,disabled:!W.value}," 重置为默认 ",8,sn)]),e[75]||(e[75]=t("p",{class:"target-description-hint"}," 描述将作为生成提示词的一部分，请详细描述您期望的效果 ",-1))])):u("",!0),Ee.value?(i(),n("div",ln,[...e[76]||(e[76]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载目标类型...",-1)])])):u("",!0)])]),_:1},8,["summary","open"])]),t("div",nn,[t("div",{class:"template-editor-header"},[e[78]||(e[78]=t("div",null,[t("h4",null,"提示词模板"),t("p",{class:"template-editor-subtitle"},"系统会自动拼接已选信息，可补充额外描述")],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:At},[...e[77]||(e[77]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),I(" 重置模板 ",-1)])])]),t("div",on,[e[79]||(e[79]=t("div",{class:"template-editor-hint"}," 已选场景/角度等会自动生成，例如：场景：客厅，拍摄角度：正面。 ",-1)),c(t("textarea",{class:"form-input template-textarea","onUpdate:modelValue":e[23]||(e[23]=s=>X.value=s),rows:"4",placeholder:"补充提示词",onInput:Kt},null,544),[[V,X.value]])])])])])):E.value===3?(i(),n("section",an,[t("div",rn,[t("div",dn,[e[80]||(e[80]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"3"),t("div",null,[t("h3",null,"提示词预览"),t("p",{class:"panel-subtitle"},"分段预览并高亮关键信息")])],-1)),S.value?u("",!0):(i(),n("span",un,"完善产品信息与模板后自动生成"))]),t("div",cn,[t("div",pn,[e[81]||(e[81]=t("span",{class:"prompt-label"},"产品信息",-1)),t("div",{class:y(["prompt-value",{empty:P.value.product.length===0}])},[P.value.product.length?(i(!0),n(h,{key:0},f(P.value.product,(s,o)=>(i(),n("span",{key:`product-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",vn,"未选择或未填写"))],2)]),t("div",mn,[e[82]||(e[82]=t("span",{class:"prompt-label"},"场景",-1)),t("div",{class:y(["prompt-value",{empty:P.value.scene.length===0}])},[P.value.scene.length?(i(!0),n(h,{key:0},f(P.value.scene,(s,o)=>(i(),n("span",{key:`scene-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",gn,"未选择场景"))],2)]),t("div",hn,[e[83]||(e[83]=t("span",{class:"prompt-label"},"角度",-1)),t("div",{class:y(["prompt-value",{empty:P.value.angle.length===0}])},[P.value.angle.length?(i(!0),n(h,{key:0},f(P.value.angle,(s,o)=>(i(),n("span",{key:`angle-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",fn,"未选择角度"))],2)]),t("div",yn,[e[84]||(e[84]=t("span",{class:"prompt-label"},"风格 / 光影",-1)),t("div",{class:y(["prompt-value",{empty:P.value.style.length===0}])},[P.value.style.length?(i(!0),n(h,{key:0},f(P.value.style,(s,o)=>(i(),n("span",{key:`style-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",bn,"未选择风格"))],2)]),t("div",kn,[e[85]||(e[85]=t("span",{class:"prompt-label"},"生成目标",-1)),t("div",{class:y(["prompt-value",{empty:!T.value}])},[T.value?(i(),n("span",wn,[W.value?(i(),n("span",_n,a(W.value.name)+"：",1)):u("",!0),I(" "+a(T.value),1)])):(i(),n("span",xn,"未选择目标"))],2)])]),t("div",Cn,[t("div",Tn,[e[87]||(e[87]=t("div",null,[t("h4",null,"完整 Prompt"),t("p",{class:"prompt-full-hint"},"可直接复制用于生成")],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:Ft,disabled:!S.value},[...e[86]||(e[86]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1),I(" 复制 ",-1)])],8,$n)]),t("div",Sn,[S.value?(i(),n("p",Bn,a(S.value),1)):(i(),n("p",Pn,"选择产品和模板选项后，提示词将在这里生成。"))])])])])):(i(),n("section",Un,[t("div",Mn,[t("div",Dn,[e[88]||(e[88]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"4"),t("div",null,[t("h3",null,"生成与结果"),t("p",{class:"panel-subtitle"},"确认参考图与提示词后开始生成")])],-1)),xe.value?(i(),n("span",Vn,a(xe.value),1)):u("",!0)]),t("div",In,[!M.value&&g.value.length===0?(i(),n("div",zn,[...e[89]||(e[89]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("polyline",{points:"21 15 16 10 5 21"})],-1),t("h3",null,"准备生成",-1),t("p",null,"选择产品、参考图片与模板选项，然后点击生成。",-1)])])):u("",!0),M.value?(i(),n("div",En,[e[90]||(e[90]=t("div",{class:"spinner"},null,-1)),O.value.total>1?(i(),n("p",jn,"正在生成图片 ("+a(O.value.current)+"/"+a(O.value.total)+")...",1)):(i(),n("p",Ln,"正在生成图片..."))])):u("",!0),g.value.length>0&&!M.value?(i(),n("div",Kn,[t("div",{class:y(["result-grid",{"single-image":g.value.length===1}])},[(i(!0),n(h,null,f(g.value,(s,o)=>(i(),n("div",{key:o,class:"result-image-item"},[t("img",{src:s,alt:"Generated image",class:"result-image"},null,8,Hn),t("div",An,[t("button",{class:"btn btn-ghost btn-icon",onClick:r=>Je(s,o),title:"下载"},[...e[91]||(e[91]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,On)])]))),128))],2),t("div",Fn,[g.value.length>1?(i(),n("button",{key:0,class:"btn btn-secondary",onClick:Rt},[e[92]||(e[92]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)),I(" 下载全部 ("+a(g.value.length)+") ",1)])):(i(),n("button",{key:1,class:"btn btn-secondary",onClick:e[24]||(e[24]=s=>Je(g.value[0],0))},[...e[93]||(e[93]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),I(" 下载 ",-1)])])),t("button",{class:"btn btn-primary",onClick:ot},[...e[94]||(e[94]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),I(" 重新生成 ",-1)])])])])):u("",!0)]),t("div",Rn,[t("button",{class:"generate-btn",disabled:!st.value||M.value,onClick:ot},[M.value?(i(),n("div",Xn)):(i(),n("svg",Gn,[...e[95]||(e[95]=[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),I(" "+a(M.value?"生成中...":"生成电商图"),1)],8,Nn),xe.value?(i(),n("div",qn,a(xe.value),1)):u("",!0)])])]))]),_:1})]),t("aside",Jn,[t("div",Zn,[t("div",Yn,[e[96]||(e[96]=t("h4",null,"提示词预览",-1)),S.value?u("",!0):(i(),n("span",Qn,"完成前两步后显示"))]),t("div",Wn,[S.value?(i(),n("p",ei,a(S.value),1)):(i(),n("p",ti,"选择产品与模板选项后生成提示词。"))])]),t("div",si,[t("div",li,[e[97]||(e[97]=t("h4",null,"生成结果",-1)),g.value.length>1?(i(),n("span",ni,"("+a(g.value.length)+")",1)):u("",!0)]),t("div",ii,[M.value?(i(),n("div",oi,[e[98]||(e[98]=t("div",{class:"spinner-small"},null,-1)),O.value.total>1?(i(),n("span",ai,a(O.value.current)+"/"+a(O.value.total),1)):(i(),n("span",ri,"正在生成..."))])):g.value.length>0?(i(),n("div",di,[(i(!0),n(h,null,f(g.value.slice(0,4),(s,o)=>(i(),n("img",{key:o,src:s,alt:"Generated preview",class:"preview-image"},null,8,ui))),128))])):(i(),n("p",ci,"生成完成后显示结果。"))])])])]),t("div",pi,[(i(!0),n(h,null,f(ke.value,s=>(i(),n("div",{key:s.id,class:y(["toast",s.type])},a(s.message),3))),128))]),ne.value?(i(),n("div",{key:0,class:"error-overlay",onClick:e[27]||(e[27]=s=>ne.value="")},[t("div",{class:"error-modal",onClick:e[26]||(e[26]=b(()=>{},["stop"]))},[e[99]||(e[99]=ce('<div class="error-header"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><h3>生成失败</h3></div>',1)),t("p",null,a(ne.value),1),t("button",{class:"btn btn-primary",onClick:e[25]||(e[25]=s=>ne.value="")},"确定")])])):u("",!0),le.value?(i(),n("div",{key:1,class:"save-dialog-overlay",onClick:e[32]||(e[32]=s=>le.value=!1)},[t("div",{class:"save-dialog-modal",onClick:e[31]||(e[31]=b(()=>{},["stop"]))},[t("div",vi,[e[101]||(e[101]=t("h3",null,"保存目标描述",-1)),t("button",{class:"save-dialog-close",onClick:e[28]||(e[28]=s=>le.value=!1)},[...e[100]||(e[100]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),t("div",mi,[t("div",gi,[e[102]||(e[102]=t("label",{class:"form-label"},"描述名称",-1)),c(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[29]||(e[29]=s=>ue.value=s),placeholder:"例如：清新自然风格",maxlength:"100"},null,512),[[V,ue.value]])]),t("div",hi,[e[103]||(e[103]=t("label",{class:"form-label"},"描述内容",-1)),t("textarea",{class:"form-input",value:T.value,readonly:"",rows:"3"},null,8,fi)])]),t("div",yi,[t("button",{class:"btn btn-secondary",onClick:e[30]||(e[30]=s=>le.value=!1)},"取消"),t("button",{class:"btn btn-primary",onClick:$t,disabled:!ue.value.trim()||se.value},a(se.value?"保存中...":"保存"),9,bi)])])])):u("",!0)]))}});es(ki).mount("#app");
