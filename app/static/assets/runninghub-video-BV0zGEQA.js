import{d as at,q as H,r as f,c as C,o as nt,a as r,b as d,g as B,e,f as b,n as y,w as k,h as lt,G as it,E as $,t as c,l as O,u as E,i as U,F as rt,p as dt,y as ut,s as ct,x as q,j as vt,k as pt}from"./supabase-Dkl3gFRn.js";/* empty css                   */import{_ as gt}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function z(T){const h=await T.text();try{const l=JSON.parse(h);return String((l==null?void 0:l.detail)||(l==null?void 0:l.error)||(l==null?void 0:l.message)||h)}catch{return h||`HTTP ${T.status}`}}const mt={class:"video-page"},ft={class:"main-container"},bt={class:"sidebar"},ht={class:"sidebar-section config-section"},yt={class:"config-content-inner"},kt={class:"form-group"},wt={class:"input-wrapper"},_t=["type"],xt={class:"form-group"},St={class:"checkbox-item"},Ct={class:"form-group"},Ut=["disabled"],It={class:"sidebar-section config-section"},Rt={class:"config-content-inner"},Bt={class:"form-group"},Et={class:"form-group"},Tt={class:"form-group"},Vt={class:"main-content"},Mt={class:"input-grid"},Ht={class:"content-panel"},$t={class:"panel-header"},Nt={class:"panel-hint"},Dt={class:"content-panel"},Pt={class:"upload-zone-body"},At={class:"upload-actions"},Gt=["disabled"],Ot=["disabled"],qt={class:"form-group image-url-group"},zt={class:"image-tools"},Ft=["disabled"],jt={key:0,class:"image-preview"},Lt=["src"],Jt={class:"result-area"},Kt={key:0,class:"result-placeholder"},Yt={key:1,class:"loading-state"},Xt={key:2,class:"result-container"},Zt={class:"content-panel result-meta-panel"},Qt={class:"panel-header"},Wt={class:"panel-hint"},te={class:"result-meta-grid"},ee={key:0},se={key:1,class:"result-meta-error"},oe={key:0,class:"result-video-container"},ae=["src"],ne={key:1,class:"result-actions"},le=["disabled"],ie={key:0,class:"loader loader-inline loader-dark","aria-label":"saving"},re={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},de={class:"content-panel raw-details"},ue={class:"raw-details-pre"},ce={class:"main-prompt-section action-bar"},ve={class:"prompt-footer"},pe={class:"status-indicator"},ge=["disabled"],me={class:"toast-container"},fe=at({__name:"runninghub-video-page",setup(T){const h={token:"runninghub_token",autoSave:"runninghub_auto_save"},l=H({token:"",autoSave:!0}),a=H({prompt:"",imageUrl:"",resolution:"1080p",aspectRatio:"16:9",duration:4}),V=f(!1),u=f(!1),x=f(!1),w=f(!1),i=f(null),p=f(""),_=f(""),S=f([]),N=f(null),M={config:"runninghub_sidebar_config_collapsed",params:"runninghub_sidebar_params_collapsed"},g=H({config:!0,params:!1}),I=C(()=>!!a.prompt.trim()&&!!a.imageUrl.trim()),F=C(()=>a.prompt.trim()?a.imageUrl.trim()?"":"请输入图片 URL":"请输入提示词"),D=C(()=>{const s=a.imageUrl.trim();return!s||!/^https?:\/\//i.test(s)?"":s}),j=C(()=>u.value?"正在提交任务…":I.value?"准备就绪":F.value),L=C(()=>u.value?"generating":I.value?"ready":"error");function J(){const s=localStorage.getItem(M.config),t=localStorage.getItem(M.params);g.config=s===null?!0:s==="true",g.params=t===null?!1:t==="true"}function P(s){g[s]=!g[s],localStorage.setItem(M[s],String(g[s]))}function K(){var s;(s=N.value)==null||s.click()}async function A(s){w.value=!0;try{const t=new FormData;t.append("image",s);const o=await q("/api/v1/uploads/runninghub/image",{method:"POST",body:t});if(!o.ok)throw new Error(await z(o));const n=await o.json(),m=String((n==null?void 0:n.image_url)||"").trim();if(!m)throw new Error("上传失败：缺少 image_url");a.imageUrl=m,v("图片上传成功","success")}catch(t){v(String((t==null?void 0:t.message)||t||"上传失败"),"error")}finally{w.value=!1}}function Y(s){var n;const t=s.target,o=(n=t==null?void 0:t.files)==null?void 0:n[0];t&&(t.value=""),o&&A(o)}function X(s){var o,n;const t=(n=(o=s.dataTransfer)==null?void 0:o.files)==null?void 0:n[0];t&&A(t)}function Z(){a.imageUrl=""}async function Q(){const s=a.imageUrl.trim();if(s)try{await navigator.clipboard.writeText(s),v("已复制图片链接","success")}catch{v("复制失败，请手动复制","warning")}}function v(s,t="info",o=3e3){const n=`${Date.now()}-${Math.random().toString(16).slice(2)}`,m={id:n,message:s,type:t};S.value=[...S.value,m],window.setTimeout(()=>{S.value=S.value.filter(R=>R.id!==n)},o)}function W(){l.token=localStorage.getItem(h.token)||"",localStorage.getItem(h.autoSave)==="0"&&(l.autoSave=!1)}function tt(){localStorage.setItem(h.token,l.token),localStorage.setItem(h.autoSave,l.autoSave?"1":"0"),v("配置已保存","success")}function et(s){var o,n;const t=((n=(o=s==null?void 0:s.results)==null?void 0:o[0])==null?void 0:n.url)||"";return String(t||"").trim()}async function G(s){var t,o;if(!p.value){s&&v("缺少视频链接，无法保存","warning");return}x.value=!0;try{const n={title:`RunningHub ${((t=i.value)==null?void 0:t.task_id)||""}`.trim(),model:"runninghub-video-s",prompt:a.prompt.trim(),video_url:p.value,status:"completed",metadata:{provider:"runninghub",provider_task_id:((o=i.value)==null?void 0:o.task_id)||null,resolution:a.resolution,aspect_ratio:a.aspectRatio,duration:a.duration,image_url:a.imageUrl.trim()},request:{prompt:a.prompt.trim(),resolution:a.resolution,aspect_ratio:a.aspectRatio,image_url:a.imageUrl.trim(),duration:a.duration},response:i.value},m=await ut();if(!m)throw new Error("Not authenticated");const{error:R}=await ct.from("user_videos").insert({user_id:m,title:n.title,model:n.model,prompt:n.prompt,status:n.status,video_url:n.video_url,metadata:n.metadata,request:n.request,response:n.response});if(R)throw new Error(R.message);v("已保存到存储库","success")}catch(n){const m=String((n==null?void 0:n.message)||n||"保存失败");v(`保存失败：${m}`,"error")}finally{x.value=!1}}async function st(){if(!(!I.value||u.value)){u.value=!0,_.value="",i.value=null,p.value="";try{const s={"Content-Type":"application/json"};l.token.trim()&&(s["X-RunningHub-Token"]=l.token.trim());const t=await q("/api/v1/runninghub/image-to-video-realistic",{method:"POST",headers:s,body:JSON.stringify({prompt:a.prompt.trim(),resolution:a.resolution,aspect_ratio:a.aspectRatio,image_url:a.imageUrl.trim(),duration:a.duration})});if(!t.ok)throw new Error(await z(t));const o=await t.json();i.value=o;const n=et(o);if(n){p.value=n,v("生成成功","success"),l.autoSave&&await G(!1);return}v(`已提交任务（状态：${o.status}）`,"info")}catch(s){_.value=String((s==null?void 0:s.message)||s||"生成失败")}finally{u.value=!1}}}function ot(){var t;if(!p.value)return;const s=document.createElement("a");s.href=p.value,s.download=`runninghub-${((t=i.value)==null?void 0:t.task_id)||"video"}.mp4`,s.rel="noopener",document.body.appendChild(s),s.click(),s.remove()}return nt(()=>{J(),W()}),(s,t)=>(d(),r("div",mt,[t[44]||(t[44]=B('<header class="header" data-v-c080c815><div class="logo" data-v-c080c815><div class="logo-icon" data-v-c080c815><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" data-v-c080c815><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" data-v-c080c815></rect><polygon points="10 8 16 12 10 16" fill="white" stroke="none" data-v-c080c815></polygon></svg></div><span data-v-c080c815>RunningHub 图生视频</span></div><div class="header-actions" data-v-c080c815><a href="/" class="btn btn-secondary header-link" data-v-c080c815><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c080c815><path d="M19 12H5M12 19l-7-7 7-7" data-v-c080c815></path></svg> 返回主页面 </a><a href="/storage" class="btn btn-ghost btn-icon header-link" title="生成记录" data-v-c080c815><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c080c815><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-c080c815></path><polyline points="7 10 12 15 17 10" data-v-c080c815></polyline><line x1="12" y1="15" x2="12" y2="3" data-v-c080c815></line></svg></a></div></header>',1)),e("div",ft,[e("aside",bt,[e("section",ht,[e("div",{class:y(["section-title collapsible-header",{collapsed:g.config}]),onClick:t[0]||(t[0]=o=>P("config"))},[...t[16]||(t[16]=[B('<span class="section-title-left" data-v-c080c815><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c080c815><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" data-v-c080c815></path><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4" data-v-c080c815></path></svg> 配置 </span><svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c080c815><polyline points="6 9 12 15 18 9" data-v-c080c815></polyline></svg>',2)])],2),e("div",{class:y(["collapsible-content",{collapsed:g.config}])},[e("div",yt,[e("div",kt,[t[18]||(t[18]=e("label",{class:"form-label"},"RunningHub Token（可选）",-1)),e("div",wt,[k(e("input",{type:V.value?"text":"password",class:"form-input","onUpdate:modelValue":t[1]||(t[1]=o=>l.token=o),placeholder:"后端已配置 RUNNINGHUB_API_KEY 可留空",autocomplete:"current-password"},null,8,_t),[[lt,l.token]]),e("button",{class:"toggle-visibility",type:"button",onClick:t[2]||(t[2]=o=>V.value=!V.value)},[...t[17]||(t[17]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),t[19]||(t[19]=e("div",{class:"form-hint"},"请求头：Authorization: Bearer <token>",-1))]),e("div",xt,[e("label",St,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=o=>l.autoSave=o)},null,512),[[it,l.autoSave]]),t[20]||(t[20]=e("span",null,"生成成功后自动保存到存储库",-1))])]),e("div",Ct,[e("button",{class:"btn btn-secondary btn-block",disabled:u.value,onClick:tt}," 保存配置 ",8,Ut)])])],2)]),e("section",It,[e("div",{class:y(["section-title collapsible-header",{collapsed:g.params}]),onClick:t[4]||(t[4]=o=>P("params"))},[...t[21]||(t[21]=[B('<span class="section-title-left" data-v-c080c815><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c080c815><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" data-v-c080c815></rect><line x1="7" y1="2" x2="7" y2="22" data-v-c080c815></line><line x1="17" y1="2" x2="17" y2="22" data-v-c080c815></line></svg> 参数 </span><svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c080c815><polyline points="6 9 12 15 18 9" data-v-c080c815></polyline></svg>',2)])],2),e("div",{class:y(["collapsible-content",{collapsed:g.params}])},[e("div",Rt,[e("div",Bt,[t[23]||(t[23]=e("label",{class:"form-label"},"分辨率",-1)),k(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=o=>a.resolution=o)},[...t[22]||(t[22]=[e("option",{value:"720p"},"720p",-1),e("option",{value:"1080p"},"1080p",-1)])],512),[[$,a.resolution]])]),e("div",Et,[t[25]||(t[25]=e("label",{class:"form-label"},"画幅比例",-1)),k(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=o=>a.aspectRatio=o)},[...t[24]||(t[24]=[e("option",{value:"16:9"},"16:9（横向）",-1),e("option",{value:"9:16"},"9:16（纵向）",-1)])],512),[[$,a.aspectRatio]])]),e("div",Tt,[t[27]||(t[27]=e("label",{class:"form-label"},"时长（秒）",-1)),k(e("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=o=>a.duration=o)},[...t[26]||(t[26]=[e("option",{value:4},"4",-1),e("option",{value:8},"8",-1),e("option",{value:12},"12",-1)])],512),[[$,a.duration,void 0,{number:!0}]])])])],2)])]),e("main",Vt,[e("div",Mt,[e("div",Ht,[e("div",$t,[t[28]||(t[28]=e("h3",null,"输入提示词",-1)),e("span",Nt,c(a.prompt.length)+"/1000 字符",1)]),k(e("textarea",{class:"prompt-textarea","onUpdate:modelValue":t[8]||(t[8]=o=>a.prompt=o),rows:"6",maxlength:"1000",placeholder:"例如：一位女孩在海边，风吹动头发，写实风格..."},null,512),[[O,a.prompt]])]),e("div",Dt,[t[32]||(t[32]=e("div",{class:"panel-header"},[e("h3",null,"输入图片"),e("span",{class:"panel-hint"},"上传后自动填充 URL")],-1)),e("div",{class:y(["upload-zone",{disabled:w.value}]),onDragenter:t[9]||(t[9]=E(()=>{},["prevent"])),onDragover:t[10]||(t[10]=E(()=>{},["prevent"])),onDrop:E(X,["prevent"])},[e("input",{ref_key:"fileInputEl",ref:N,class:"sr-only",type:"file",accept:"image/png,image/jpeg",onChange:Y},null,544),e("div",Pt,[t[29]||(t[29]=e("div",{class:"upload-title"},"拖拽 PNG/JPEG 到这里",-1)),e("div",At,[e("button",{class:"btn btn-secondary",type:"button",disabled:w.value,onClick:K},c(w.value?"上传中…":"选择图片上传"),9,Gt),e("button",{class:"btn btn-ghost",type:"button",disabled:w.value||!a.imageUrl.trim(),onClick:Z}," 清除 ",8,Ot)]),t[30]||(t[30]=e("div",{class:"upload-hint"}," RunningHub 需要可公网访问的 http(s) 地址；如果你的服务在公网，请使用上传生成的链接。 ",-1))])],34),e("div",qt,[t[31]||(t[31]=e("label",{class:"form-label"},"图片 URL",-1)),k(e("input",{class:"form-input","onUpdate:modelValue":t[11]||(t[11]=o=>a.imageUrl=o),placeholder:"https://example.com/input.png"},null,512),[[O,a.imageUrl]]),e("div",zt,[e("button",{class:"btn btn-ghost btn-small",type:"button",disabled:!a.imageUrl.trim(),onClick:Q}," 复制链接 ",8,Ft)])]),D.value?(d(),r("div",jt,[e("img",{src:D.value,alt:"input preview"},null,8,Lt)])):b("",!0)])]),e("div",Jt,[!u.value&&!i.value?(d(),r("div",Kt,[...t[33]||(t[33]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}),e("polygon",{points:"10 8 16 12 10 16"})],-1),e("h3",null,"准备生成",-1),e("p",null,"填写提示词与图片 URL 后点击「生成视频」",-1)])])):b("",!0),u.value?(d(),r("div",Yt,[...t[34]||(t[34]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在提交任务...",-1)])])):b("",!0),i.value&&!u.value?(d(),r("div",Xt,[e("div",Zt,[e("div",Qt,[t[35]||(t[35]=e("h3",null,"任务状态",-1)),e("span",Wt,c(i.value.status),1)]),e("div",te,[e("div",null,[t[36]||(t[36]=e("span",{class:"result-meta-label"},"task_id：",-1)),U(c(i.value.task_id),1)]),i.value.prompt_tips?(d(),r("div",ee,[t[37]||(t[37]=e("span",{class:"result-meta-label"},"prompt_tips：",-1)),U(c(i.value.prompt_tips),1)])):b("",!0),i.value.error_message?(d(),r("div",se,[t[38]||(t[38]=e("span",{class:"result-meta-label"},"error：",-1)),U(c(i.value.error_message),1)])):b("",!0)])]),p.value?(d(),r("div",oe,[e("video",{src:p.value,controls:"",preload:"metadata"},null,8,ae)])):b("",!0),p.value?(d(),r("div",ne,[e("button",{class:"btn btn-secondary",onClick:ot},[...t[39]||(t[39]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),U(" 下载 ",-1)])]),e("button",{class:"btn btn-secondary",disabled:x.value,onClick:t[12]||(t[12]=o=>G(!0))},[x.value?(d(),r("span",ie)):(d(),r("svg",re,[...t[40]||(t[40]=[e("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},null,-1),e("polyline",{points:"17 21 17 13 7 13 7 21"},null,-1),e("polyline",{points:"7 3 7 8 15 8"},null,-1)])])),U(" "+c(x.value?"保存中...":"保存到存储库"),1)],8,le)])):b("",!0),e("details",de,[t[41]||(t[41]=e("summary",{class:"raw-details-summary"},"查看原始响应",-1)),e("pre",ue,c(JSON.stringify(i.value,null,2)),1)])])):b("",!0)]),e("section",ce,[e("div",ve,[e("div",pe,[e("span",{class:y(["status-dot",L.value])},null,2),e("span",null,c(j.value),1)]),e("button",{class:y(["generate-btn-large",{loading:u.value}]),disabled:!I.value||u.value,onClick:st},[...t[42]||(t[42]=[e("span",{class:"btn-text"},"生成视频",-1),e("span",{class:"loader"},null,-1)])],10,ge)])])])]),e("div",me,[(d(!0),r(rt,null,dt(S.value,o=>(d(),r("div",{key:o.id,class:y(["toast",o.type])},c(o.message),3))),128))]),_.value?(d(),r("div",{key:0,class:"error-overlay",onClick:t[15]||(t[15]=o=>_.value="")},[e("div",{class:"error-modal",onClick:t[14]||(t[14]=E(()=>{},["stop"]))},[t[43]||(t[43]=B('<div class="error-header" data-v-c080c815><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c080c815><circle cx="12" cy="12" r="10" data-v-c080c815></circle><line x1="12" y1="8" x2="12" y2="12" data-v-c080c815></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-c080c815></line></svg><h3 data-v-c080c815>生成失败</h3></div>',1)),e("p",null,c(_.value),1),e("button",{class:"btn btn-primary",onClick:t[13]||(t[13]=o=>_.value="")},"确定")])])):b("",!0)]))}}),be=gt(fe,[["__scopeId","data-v-c080c815"]]);async function he(){await vt(),pt(be).mount("#app")}he();
