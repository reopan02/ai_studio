import{d as ie,q as j,r as p,c as T,o as le,a as s,b as n,g as w,e as t,f as h,w as b,B,F as S,p as U,t as f,i as M,l as re,n as A,u as D,I as E,s as q,J as N,x as de,y as ce,j as ue,k as ve}from"./supabase-yVp6g-J3.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                        */const fe={class:"ecommerce-image-page"},ge={class:"main-container"},me={class:"sidebar"},he={class:"sidebar-section"},ye={class:"sidebar-section"},we={class:"form-group"},be={class:"form-group"},ke={class:"form-group"},_e=["value"],xe={class:"sidebar-section"},Ce={key:0,class:"product-list"},Ie=["onClick"],Be=["src","alt"],Se={class:"product-info"},Ue={class:"product-name"},Ke={class:"product-meta"},ze={key:1,class:"product-list-empty"},$e={key:2,class:"product-list-loading"},je={class:"main-content"},Me={class:"content-panel"},De={class:"panel-header"},Ve={class:"panel-hint"},He={class:"result-area"},Le={key:0,class:"result-placeholder"},Fe={key:1,class:"loading-state"},Re={key:2,class:"result-container"},Te=["onClick"],Ae=["src"],Ee={class:"image-overlay"},qe=["onClick"],Ne={class:"generate-section"},Pe=["disabled"],Ge={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Xe={key:1,class:"spinner-small"},Je={key:0,class:"generate-hint"},Oe=["src"],Ze={class:"toast-container"},Qe=ie({__name:"image-generate-page",setup(et){const k=j({apiKey:"",baseUrl:""}),P="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
  <rect width="100" height="100" fill="#1a1a2e"/>
  <rect x="25" y="25" width="50" height="50" rx="4" fill="none" stroke="#4a4a6a" stroke-width="2"/>
  <circle cx="38" cy="38" r="5" fill="#4a4a6a"/>
  <path d="M25 65 L45 45 L55 55 L75 35 L75 75 L25 75 Z" fill="#4a4a6a" opacity="0.5"/>
</svg>
`),_=j({model:"gemini-3-pro-image-preview"}),l=j({n:1,size:"1K",aspectRatio:""}),c=p(""),r=p(!1),u=p([]),g=p(""),x=p([]),y=p(""),C=p([]),I=p(!1),K=T(()=>c.value.trim().length>0),G=T(()=>c.value.trim()?"":"请输入图像描述");function X(a){return String(a||"").trim().replace(/^bearer\s+/i,"").trim()}function J(a){return String(a||"").trim()||null}function V(a){if(!a||typeof a!="object")return[];const e=[];if(Array.isArray(a.data))for(const o of a.data)o!=null&&o.url?e.push(o.url):o!=null&&o.b64_json&&e.push(`data:image/png;base64,${o.b64_json}`);return a.url&&e.push(a.url),a.b64_json&&e.push(`data:image/png;base64,${a.b64_json}`),a.image_url&&e.push(a.image_url),e}async function H(){I.value=!0;try{const{data:a,error:e}=await E(()=>q.from("user_images").select("id,prompt,image_url,created_at").order("created_at",{ascending:!1}).limit(20));if(e)throw e;C.value=a||[]}catch(a){console.error("Failed to load history:",a),z(N(a),"error")}finally{I.value=!1}}function O(a){c.value=a.prompt||"",a.image_url&&(u.value=[a.image_url])}function Z(a,e){return a?a.length<=e?a:a.substring(0,e)+"...":""}function Q(a){return a?new Date(a).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function W(){}function Y(){k.apiKey=localStorage.getItem("global_api_key")||localStorage.getItem("video_api_key")||void 0||"",k.baseUrl=localStorage.getItem("global_base_url")||localStorage.getItem("video_base_url")||void 0||""}async function ee(){if(!(!K.value||r.value)){r.value=!0,g.value="";try{const a=new FormData;a.append("prompt",c.value),a.append("model",_.model),a.append("n",String(l.n)),a.append("size",l.size),a.append("response_format","url"),l.aspectRatio&&a.append("aspect_ratio",l.aspectRatio);const e={},o=X(k.apiKey);o&&(e["X-API-Key"]=o);const d=J(k.baseUrl);d&&(e["X-Base-Url"]=d);const v=await de("/api/v1/images/generations",{method:"POST",headers:e,body:a});if(!v.ok){const m=await v.json().catch(()=>({}));throw new Error(m.detail||`HTTP ${v.status}`)}const i=await v.json(),ae=i&&typeof i=="object"&&i.response?i.response:i,F=V(ae);if(F.length===0){const m=V(i);if(m.length>0)u.value=m;else throw new Error("未能获取生成的图像")}else u.value=F;z("图像生成成功","success");const R=await ce();if(R){const m=u.value.map((se,ne)=>({user_id:R,title:null,model:_.model,prompt:c.value.trim(),status:"completed",image_url:se,metadata:{source:"image-generate",n:l.n,size:l.size,aspect_ratio:l.aspectRatio||null,index:ne},request:i&&typeof i=="object"&&i.request?i.request:null,response:i&&typeof i=="object"&&i.response?i.response:i})),{error:$}=await E(()=>q.from("user_images").insert(m));$&&(console.warn("Failed to save images to repository:",$),z(N($),"error"))}H()}catch(a){g.value=a.message||"生成失败，请重试"}finally{r.value=!1}}}function L(a,e){const o=document.createElement("a");o.href=a,o.download=`generated-${Date.now()}-${e}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function te(a){y.value=a}let oe=0;function z(a,e="info"){const o=oe++;x.value.push({id:o,message:a,type:e}),setTimeout(()=>{const d=x.value.findIndex(v=>v.id===o);d!==-1&&x.value.splice(d,1)},3e3)}return le(()=>{Y(),H()}),(a,e)=>(n(),s("div",fe,[e[29]||(e[29]=w('<header class="header" data-v-e2f4dfac><div class="logo" data-v-e2f4dfac><div class="logo-icon" data-v-e2f4dfac><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" data-v-e2f4dfac><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" data-v-e2f4dfac></polygon></svg></div><span data-v-e2f4dfac>图像生成</span></div><div class="header-actions" data-v-e2f4dfac><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;" data-v-e2f4dfac><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e2f4dfac><path d="M19 12H5M12 19l-7-7 7-7" data-v-e2f4dfac></path></svg> 返回主页面 </a></div></header>',1)),t("div",ge,[t("aside",me,[t("section",he,[e[12]||(e[12]=w('<div class="section-title" data-v-e2f4dfac><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e2f4dfac><polygon points="12 2 2 7 12 12 22 7 12 2" data-v-e2f4dfac></polygon><polyline points="2 17 12 22 22 17" data-v-e2f4dfac></polyline><polyline points="2 12 12 17 22 12" data-v-e2f4dfac></polyline></svg> 模型选择 </div>',1)),b(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=o=>_.model=o)},[...e[11]||(e[11]=[t("option",{value:"gemini-3-pro-image-preview"},"gemini-3-pro-image-preview (推荐)",-1),t("option",{value:"gemini-2.5-flash-image"},"gemini-2.5-flash-image (快速)",-1)])],512),[[B,_.model]])]),t("section",ye,[e[18]||(e[18]=w('<div class="section-title" data-v-e2f4dfac><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e2f4dfac><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-e2f4dfac></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-e2f4dfac></circle><polyline points="21 15 16 10 5 21" data-v-e2f4dfac></polyline></svg> 图像设置 </div>',1)),t("div",we,[e[14]||(e[14]=t("label",{class:"form-label"},"宽高比",-1)),b(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=o=>l.aspectRatio=o)},[...e[13]||(e[13]=[w('<option value="" data-v-e2f4dfac>自动</option><option value="1:1" data-v-e2f4dfac>1:1 (正方形)</option><option value="16:9" data-v-e2f4dfac>16:9 (横向)</option><option value="9:16" data-v-e2f4dfac>9:16 (纵向)</option><option value="4:3" data-v-e2f4dfac>4:3 (标准)</option><option value="3:4" data-v-e2f4dfac>3:4 (竖版)</option><option value="3:2" data-v-e2f4dfac>3:2 (照片)</option><option value="2:3" data-v-e2f4dfac>2:3 (竖版照片)</option>',8)])],512),[[B,l.aspectRatio]])]),t("div",be,[e[16]||(e[16]=t("label",{class:"form-label"},"图像尺寸",-1)),b(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=o=>l.size=o)},[...e[15]||(e[15]=[t("option",{value:"1K"},"1K (默认)",-1),t("option",{value:"2K"},"2K (高清)",-1),t("option",{value:"4K"},"4K (超高清)",-1)])],512),[[B,l.size]])]),t("div",ke,[e[17]||(e[17]=t("label",{class:"form-label"},"生成数量",-1)),b(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=o=>l.n=o)},[(n(),s(S,null,U(4,o=>t("option",{key:o,value:o},f(o)+" 张",9,_e)),64))],512),[[B,l.n]])])]),t("section",xe,[e[21]||(e[21]=t("div",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})]),M(" 生成历史 ")],-1)),!I.value&&C.value.length>0?(n(),s("div",Ce,[(n(!0),s(S,null,U(C.value,o=>(n(),s("div",{key:o.id,class:"product-item",onClick:d=>O(o)},[t("img",{src:o.image_url||P,alt:o.prompt,class:"product-thumb"},null,8,Be),t("div",Se,[t("div",Ue,f(Z(o.prompt,30)),1),t("div",Ke,f(Q(o.created_at)),1)])],8,Ie))),128))])):!I.value&&C.value.length===0?(n(),s("div",ze,[...e[19]||(e[19]=[t("p",null,"暂无生成历史",-1)])])):(n(),s("div",$e,[...e[20]||(e[20]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])]))])]),t("main",je,[t("div",Me,[t("div",De,[e[22]||(e[22]=t("h3",null,"描述您想要生成的图像",-1)),t("span",Ve,f(c.value.length)+"/1000 字符",1)]),b(t("textarea",{class:"form-input","onUpdate:modelValue":e[4]||(e[4]=o=>c.value=o),rows:"4",maxlength:"1000",placeholder:"请详细描述您想要生成的图像，例如：一只可爱的橘色小猫咪坐在窗台上，阳光透过窗户洒在它身上，背景是模糊的城市天际线...",onInput:W},null,544),[[re,c.value]])]),t("div",He,[!r.value&&u.value.length===0?(n(),s("div",Le,[...e[23]||(e[23]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1),t("h3",null,"准备生成",-1),t("p",null,"输入描述后点击生成按钮创建图像",-1)])])):h("",!0),r.value?(n(),s("div",Fe,[...e[24]||(e[24]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成图像...",-1)])])):h("",!0),u.value.length>0&&!r.value?(n(),s("div",Re,[t("div",{class:A(["image-grid",{"single-image":u.value.length===1}])},[(n(!0),s(S,null,U(u.value,(o,d)=>(n(),s("div",{key:d,class:"generated-image-item",onClick:v=>te(o)},[t("img",{src:o,alt:"Generated image"},null,8,Ae),t("div",Ee,[t("button",{class:"btn btn-ghost btn-icon",onClick:D(v=>L(o,d),["stop"])},[...e[25]||(e[25]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,qe)])],8,Te))),128))],2)])):h("",!0)]),t("div",Ne,[t("button",{class:"generate-btn",disabled:!K.value||r.value,onClick:ee},[r.value?(n(),s("div",Xe)):(n(),s("svg",Ge,[...e[26]||(e[26]=[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),M(" "+f(r.value?"生成中...":"生成图像"),1)],8,Pe),K.value?h("",!0):(n(),s("div",Je,f(G.value),1))])])]),y.value?(n(),s("div",{key:0,class:"error-overlay",onClick:e[7]||(e[7]=o=>y.value="")},[t("div",{class:"lightbox-content",onClick:e[6]||(e[6]=D(()=>{},["stop"]))},[t("img",{src:y.value,alt:"Full size image"},null,8,Oe),t("button",{class:"btn btn-secondary",onClick:e[5]||(e[5]=o=>L(y.value,0)),style:{"margin-top":"16px"}},[...e[27]||(e[27]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),M(" 下载 ",-1)])])])])):h("",!0),t("div",Ze,[(n(!0),s(S,null,U(x.value,o=>(n(),s("div",{key:o.id,class:A(["toast",o.type])},f(o.message),3))),128))]),g.value?(n(),s("div",{key:1,class:"error-overlay",onClick:e[10]||(e[10]=o=>g.value="")},[t("div",{class:"error-modal",onClick:e[9]||(e[9]=D(()=>{},["stop"]))},[e[28]||(e[28]=w('<div class="error-header" data-v-e2f4dfac><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e2f4dfac><circle cx="12" cy="12" r="10" data-v-e2f4dfac></circle><line x1="12" y1="8" x2="12" y2="12" data-v-e2f4dfac></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-e2f4dfac></line></svg><h3 data-v-e2f4dfac>生成失败</h3></div>',1)),t("p",null,f(g.value),1),t("button",{class:"btn btn-primary",onClick:e[8]||(e[8]=o=>g.value="")},"确定")])])):h("",!0)]))}}),We=pe(Qe,[["__scopeId","data-v-e2f4dfac"]]);async function Ye(){await ue(),ve(We).mount("#app")}Ye();
