import{d as nt,a as n,b as i,n as b,e as t,s as se,l as re,q as m,f as u,u as Te,t as a,T as it,x as L,w as v,v as At,m as G,r as d,c as P,y as st,o as Ft,g as ae,F as _,p as x,z as Ge,k as D,i as j,A as $e,B as Rt,C as Nt,j as Gt}from"./runtime-dom.esm-bundler-D9CM_geE.js";/* empty css                        */const Xt=["aria-expanded","onKeydown"],qt={class:"collapsible-title"},Jt={class:"collapsible-title-text"},Zt={key:0,class:"collapsible-summary"},Yt={class:"collapsible-actions"},Qt={class:"collapsible-body"},Se=nt({__name:"CollapsibleGroup",props:{title:{},summary:{},open:{type:Boolean}},emits:["toggle"],setup(X,{emit:Ue}){const M=Ue;function O(){M("toggle")}return(g,de)=>(i(),n("div",{class:b(["collapsible-group",{collapsed:!X.open}])},[t("div",{class:"collapsible-header",role:"button",tabindex:"0","aria-expanded":X.open,onClick:O,onKeydown:[re(m(O,["prevent"]),["enter"]),re(m(O,["prevent"]),["space"])]},[t("div",qt,[t("span",Jt,a(X.title),1),Te(g.$slots,"title-extra")]),X.open?u("",!0):(i(),n("div",Zt,[Te(g.$slots,"summary",{},()=>[t("span",null,a(X.summary),1)])])),t("div",Yt,[Te(g.$slots,"actions"),de[0]||(de[0]=t("span",{class:"collapsible-toggle"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"6 9 12 15 18 9"})])],-1))])],40,Xt),se(it,{name:"collapse"},{default:L(()=>[v(t("div",Qt,[Te(g.$slots,"default")],512),[[At,X.open]])]),_:3})],2))}}),Wt={class:"ecommerce-image-page"},es={class:"wizard-nav"},ts={class:"wizard-steps"},ss=["aria-current","aria-disabled","onClick"],ls={class:"wizard-step-indicator"},ns={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},is={key:1},os={class:"wizard-step-label"},as={key:0,class:"wizard-step-hint"},rs={class:"main-container"},ds={class:"sidebar"},us={class:"sidebar-section"},cs={class:"form-group",style:{"margin-top":"16px"}},ps={class:"form-group"},vs={class:"sidebar-section"},ms={class:"search-wrapper"},gs={key:0,class:"product-list"},fs=["onClick"],hs={class:"product-thumb-wrap"},ys=["src","alt"],bs={key:0,class:"product-count-badge"},ks={class:"product-info"},ws={class:"product-name"},_s={class:"product-meta"},xs={key:0},Cs={key:1},Ts={key:2},$s={key:0,class:"spinner-small"},Ss={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},Bs={key:1,class:"product-list-empty"},Us={key:2,class:"product-list-loading"},Ps={key:3,class:"pagination"},Ds=["disabled"],Ms={class:"page-info"},Vs=["disabled"],zs={key:0,class:"sidebar-section"},Es={class:"section-title"},Is={key:0,class:"image-grid"},js=["onClick"],Ls=["src"],Ks={key:0,class:"image-check"},Hs={key:1,class:"image-primary"},Os={key:1,class:"no-images"},As={class:"sidebar-section"},Fs={key:0,class:"product-list"},Rs=["onClick"],Ns=["src","alt"],Gs={class:"product-info"},Xs={class:"product-name"},qs={class:"product-meta"},Js={key:1,class:"product-list-empty"},Zs={key:2,class:"product-list-loading"},Ys={class:"main-content"},Qs={key:0,class:"workflow-section"},Ws={class:"content-panel"},el={class:"panel-header"},tl={key:0,class:"panel-hint"},sl={key:0,class:"product-fields"},ll={class:"field-row"},nl={class:"field-checkbox"},il=["disabled"],ol={class:"field-row"},al={class:"field-checkbox"},rl=["disabled"],dl={class:"field-row"},ul={class:"field-checkbox"},cl=["disabled"],pl={class:"field-row"},vl={class:"field-checkbox"},ml=["disabled"],gl={key:1,class:"panel-empty"},fl={key:1,class:"workflow-section"},hl={class:"content-panel"},yl={class:"template-modules"},bl={class:"option-chips"},kl=["onClick"],wl=["onUpdate:modelValue","data-option-id","onKeydown"],_l=["onClick"],xl=["onClick"],Cl={class:"option-chips"},Tl=["onClick"],$l=["onUpdate:modelValue","data-option-id","onKeydown"],Sl=["onClick"],Bl=["onClick"],Ul={class:"option-chips"},Pl=["onClick"],Dl=["onUpdate:modelValue","data-option-id","onKeydown"],Ml=["onClick"],Vl=["onClick"],zl={class:"target-type-selector"},El={class:"target-type-options"},Il=["value","onChange"],jl={class:"target-type-label"},Ll={key:0,class:"target-description-input"},Kl={key:0,class:"saved-descriptions-section"},Hl={class:"saved-descriptions-list"},Ol=["onClick"],Al=["onClick"],Fl=["placeholder","disabled"],Rl={class:"target-description-actions"},Nl=["disabled"],Gl=["disabled"],Xl={key:1,class:"target-loading"},ql={class:"template-editor"},Jl={class:"template-editor-section"},Zl={key:2,class:"workflow-section"},Yl={class:"content-panel prompt-preview-panel"},Ql={class:"panel-header"},Wl={key:0,class:"panel-hint"},en={class:"prompt-structured"},tn={class:"prompt-row"},sn={key:1,class:"prompt-empty"},ln={class:"prompt-row"},nn={key:1,class:"prompt-empty"},on={class:"prompt-row"},an={key:1,class:"prompt-empty"},rn={class:"prompt-row"},dn={key:1,class:"prompt-empty"},un={class:"prompt-row"},cn={key:0,class:"prompt-chip target-chip"},pn={key:0,class:"target-chip-name"},vn={key:1,class:"prompt-empty"},mn={class:"prompt-full"},gn={class:"prompt-full-header"},fn=["disabled"],hn={class:"prompt-full-body"},yn={key:0},bn={key:1,class:"prompt-placeholder"},kn={key:3,class:"workflow-section"},wn={class:"content-panel"},_n={class:"panel-header"},xn={key:0,class:"panel-hint"},Cn={class:"result-area"},Tn={key:0,class:"result-placeholder"},$n={key:1,class:"loading-state"},Sn={key:2,class:"result-container"},Bn=["src"],Un={class:"generate-section"},Pn=["disabled"],Dn={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Mn={key:1,class:"spinner-small"},Vn={key:0,class:"generate-hint"},zn={class:"preview-panel"},En={class:"preview-card"},In={class:"preview-card-header"},jn={key:0,class:"preview-card-hint"},Ln={class:"preview-card-body"},Kn={key:0},Hn={key:1,class:"preview-placeholder"},On={class:"preview-card"},An={class:"preview-card-body preview-result"},Fn={key:0,class:"preview-loading"},Rn={key:1},Nn=["src"],Gn={key:2,class:"preview-placeholder"},Xn={class:"toast-container"},qn={class:"save-dialog-header"},Jn={class:"save-dialog-body"},Zn={class:"form-group"},Yn={class:"form-group"},Qn=["value"],Wn={class:"save-dialog-footer"},ei=["disabled"],lt="高清产品摄影",Be=10,ti=nt({__name:"ecommerce-image-page",setup(X){const Ue=[{id:"target-main",name:"主图",placeholder:"请描述主图的展示重点，如产品摆放方式、突出的卖点...",default_template:"适合电商主图展示的产品图，突出产品整体外观，简洁大方",sort_order:0},{id:"target-detail",name:"详情页",placeholder:"请描述详情页需要展示的产品细节或使用场景...",default_template:"适合详情页的产品展示图，展现产品细节和使用场景",sort_order:1},{id:"target-poster",name:"海报",placeholder:"请描述海报的主题和风格，如促销活动、节日氛围...",default_template:"具有视觉冲击力的营销海报风格，适合活动推广",sort_order:2},{id:"target-white",name:"白底图",placeholder:"请描述白底图的拍摄角度和展示方式...",default_template:"纯白色背景的产品图，适合平台商品展示",sort_order:3},{id:"target-scene",name:"场景图",placeholder:"请描述期望的使用场景和环境氛围...",default_template:"产品在真实使用场景中的展示图，增强代入感",sort_order:4}],M={scene:[{id:"scene-white",label:"白色背景"},{id:"scene-natural-table",label:"自然光桌面"},{id:"scene-outdoor",label:"户外场景"},{id:"scene-solid",label:"纯色背景"},{id:"scene-life",label:"生活场景"}],angle:[{id:"angle-front",label:"正面"},{id:"angle-45",label:"45度侧面"},{id:"angle-top",label:"俯视"},{id:"angle-eye",label:"平视"},{id:"angle-close",label:"特写"}],style:[{id:"style-soft",label:"柔和光影"},{id:"style-contrast",label:"高对比度"},{id:"style-natural",label:"自然光"},{id:"style-studio",label:"专业棚拍"},{id:"style-warm",label:"暖色调"}],target:[{id:"target-main",label:"主图"},{id:"target-detail",label:"详情页"},{id:"target-poster",label:"海报"},{id:"target-white",label:"白底图"},{id:"target-scene",label:"场景图"}]},O=G({apiKey:"",baseUrl:""}),g=G({model:"gemini-3-pro-image-preview",aspectRatio:"",imageSize:"1K"}),de=[{id:1,title:"选择产品"},{id:2,title:"配置模板"},{id:3,title:"预览提示词"},{id:4,title:"生成图片"}],V=d(1),le=d(""),ue=d([]),ce=d(!1),pe=d(""),K=d(1),Pe=d(0),$=d(null),z=d([]),C=d([]),ne=d(null),ve=d([]),me=d(!1),ot="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
  <rect width="100" height="100" fill="#1a1a2e"/>
  <rect x="25" y="25" width="50" height="50" rx="4" fill="none" stroke="#4a4a6a" stroke-width="2"/>
  <circle cx="38" cy="38" r="5" fill="#4a4a6a"/>
  <path d="M25 65 L45 45 L55 55 L75 35 L75 75 L25 75 Z" fill="#4a4a6a" opacity="0.5"/>
</svg>
`),f=G({name:"",dimensions:"",featuresText:"",characteristicsText:""}),ie=d([]),De=d(!1),E=d(null),w=d(""),at=d(!1),Q=d(!1),A=d([]),W=d(!1),q=d(null),oe=d(""),J=P(()=>E.value&&ie.value.find(l=>l.id===E.value)||null),rt=P(()=>{var l;return((l=J.value)==null?void 0:l.placeholder)||"请描述您期望的生成效果..."}),h=G({name:!0,dimensions:!0,features:!0,characteristics:!0}),p=G({scene:M.scene.map(l=>({...l})),angle:M.angle.map(l=>({...l})),style:M.style.map(l=>({...l})),target:M.target.map(l=>({...l}))}),k=G({scene:[],angle:[],style:[],target:[]}),F=G({scene:!0,angle:!1,style:!1,target:!1}),ge=d(!1),y=G({category:"",id:""}),R=d(lt),U=d(!1),I=d(""),ee=d(""),fe=d([]),Me=P(()=>Math.ceil(Pe.value/Be));function Ve(l){return globalThis.crypto&&"randomUUID"in globalThis.crypto?`${l}-${globalThis.crypto.randomUUID()}`:`${l}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function Xe(l){return l.split(`
`).map(e=>e.trim()).filter(Boolean)}function qe(l){return l.filter(Boolean).join("、")}function he(l){const e=new Set(k[l]);return p[l].filter(s=>e.has(s.id)).map(s=>s.label.trim()).filter(Boolean)}function H(l,e){return y.category===l&&y.id===e}const Z=P(()=>({scene:he("scene"),angle:he("angle"),style:he("style"),target:he("target")})),dt=P(()=>k.scene.length>0||k.angle.length>0||k.style.length>0||!!E.value);function ze(l){const e=Z.value[l];return e.length?e.length<=2?e.join("、"):`${e[0]}、${e[1]} 等${e.length}项`:"未选择"}function ye(l){F[l]=!F[l],ge.value=!0}function Ee(l=!1){if(ge.value&&!l)return;const e=["scene","angle","style","target"];let s=!1;e.forEach(o=>{!s&&k[o].length===0?(F[o]=!0,s=!0):F[o]=!1}),ge.value=!1}const Ie=P(()=>{const l=[],e=f.name.trim(),s=f.dimensions.trim();return h.name&&e&&l.push(e),h.dimensions&&s&&l.push(s),h.features&&l.push(...Xe(f.featuresText)),h.characteristics&&l.push(...Xe(f.characteristicsText)),l}),S=P(()=>({product:Ie.value,scene:Z.value.scene,angle:Z.value.angle,style:Z.value.style,target:w.value?[w.value]:[]}));function je(l,e){return e.length?`${l}：${qe(e)}`:""}function Je(l){return l.replace(/[，、]{2,}/g,"，").replace(/^[，、\s]+/,"").replace(/[，、\s]+$/,"").replace(/\s*[，、]\s*/g,"，").trim()}function Le(l){if(!l)return"";const e=l.trim();if(!e.includes("{{"))return e;const s=e.replace(/\{\{(\w+)(?:\|([^}]*))?\}\}/g,(o,r,c)=>c??"");return Je(s)}const T=P(()=>{if(!$.value)return"";const l=[];Ie.value.length&&l.push(qe(Ie.value));const e=je("场景",Z.value.scene);e&&l.push(e);const s=je("拍摄角度",Z.value.angle);s&&l.push(s);const o=je("风格",Z.value.style);o&&l.push(o);const r=w.value.trim();r&&l.push(r);const c=Le(R.value);return c&&l.push(c),Je(l.join("，"))}),Ze=P(()=>$.value&&C.value.length>0&&T.value.length>0),be=P(()=>U.value?"正在生成图片...":$.value?C.value.length===0?"请选择至少一张参考图片":T.value?"":"请完善模板选项或产品信息":"请先在左侧选择产品");function N(l){return l===1?!!$.value&&C.value.length>0:l===2?dt.value:l===3?T.value.length>0:l===4?I.value.length>0:!1}const Ye=P(()=>N(1)?N(2)?N(3)?4:3:2:1);function Ke(l){return l<=Ye.value}function ut(){return N(1)?N(2)?N(3)?"请先完成前置步骤":"请先完成步骤3：完善提示词预览":"请先完成步骤2：至少选择一个模板选项":"请先完成步骤1：选择产品并勾选参考图"}function ct(l){if(Ke(l)){V.value=l,le.value="";return}le.value=ut()}function He(){const l=document.cookie.match(/csrf_token=([^;]+)/);return l?l[1]:""}function pt(l){return String(l||"").trim().replace(/^bearer\s+/i,"").trim()}function vt(l){return String(l||"").trim()||null}function Qe(l){if(!l||typeof l!="object")return null;if(Array.isArray(l.data)&&l.data[0]){const e=l.data[0];if(e!=null&&e.url)return e.url;if(e!=null&&e.b64_json)return`data:image/png;base64,${e.b64_json}`}return l.url?l.url:l.b64_json?`data:image/png;base64,${l.b64_json}`:l.image_url?l.image_url:null}async function ke(){ce.value=!0;try{const l=new URLSearchParams({offset:String((K.value-1)*Be),limit:String(Be)});pe.value&&l.set("name",pe.value);const e=await fetch(`/api/v1/products?${l}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch products");const s=await e.json();ue.value=s.products||[],Pe.value=s.total||0}catch{B("加载产品列表失败","error")}finally{ce.value=!1}}function mt(){K.value=1,ke()}async function We(){me.value=!0;try{const l=await fetch("/api/v1/images?limit=20",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch history");const e=await l.json();ve.value=e||[]}catch(l){console.error("Failed to load history:",l)}finally{me.value=!1}}function gt(l){l.image_url&&(I.value=l.image_url,V.value=4)}function ft(l,e){return l?l.length<=e?l:l.substring(0,e)+"...":""}function ht(l){return l?new Date(l).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}async function yt(){De.value=!0;try{const l=await fetch("/api/v1/target-types",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch target types");const e=await l.json();ie.value=e.target_types||[]}catch{console.warn("Failed to load target types from API, using defaults"),ie.value=[...Ue]}finally{De.value=!1}}async function bt(l){if(!l){A.value=[];return}try{const e=await fetch(`/api/v1/target-descriptions?target_type_id=${encodeURIComponent(l)}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch saved descriptions");const s=await e.json();A.value=s.descriptions||[]}catch(e){console.warn("Failed to load saved descriptions:",e),A.value=[]}}function kt(l){w.value=l.description,q.value=l.id}async function wt(){const l=E.value,e=oe.value.trim(),s=w.value.trim();if(!l||!e||!s){B("请填写名称和描述","error");return}Q.value=!0;try{const o={target_type_id:l,name:e,description:s},r=await fetch("/api/v1/target-descriptions",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":He()},body:JSON.stringify(o)});if(!r.ok){const Y=await r.json().catch(()=>({}));throw new Error(Y.detail||`HTTP ${r.status}`)}const c=await r.json();A.value.unshift(c),q.value=c.id,W.value=!1,oe.value="",B("描述已保存","success")}catch(o){B(o.message||"保存描述失败","error")}finally{Q.value=!1}}async function _t(l){if(confirm("确定要删除这个保存的描述吗？"))try{const e=await fetch(`/api/v1/target-descriptions/${l}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":He()}});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||`HTTP ${e.status}`)}A.value=A.value.filter(s=>s.id!==l),q.value===l&&(q.value=null),B("描述已删除","success")}catch(e){B(e.message||"删除描述失败","error")}}function xt(){const l=J.value;l&&(w.value=l.default_template||"",q.value=null)}async function Ct(l){const e=E.value;if(E.value=l,e!==l){q.value=null;const s=ie.value.find(o=>o.id===l);w.value=(s==null?void 0:s.default_template)||"",await bt(l)}}function Tt(){K.value>1&&(K.value--,ke())}function $t(){K.value<Me.value&&(K.value++,ke())}function St(l){if(l.images&&l.images.length>0){const e=l.images.find(s=>s.is_primary);return e?e.image_url:l.images[0].image_url}return l.original_image_url||"/static/placeholder.png"}async function Bt(l){var e;if(l!=null&&l.id&&((e=$.value)==null?void 0:e.id)!==l.id&&!ne.value){ne.value=l.id;try{const s=await fetch(`/api/v1/products/${l.id}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to load product details");const o=await s.json();$.value=o,f.name=o.name||"",f.dimensions=o.dimensions||"",f.featuresText=(o.features||[]).join(`
`),f.characteristicsText=(o.characteristics||[]).join(`
`),z.value=o.images||[],z.value.length===0&&o.original_image_url&&(z.value=[{id:o.id,image_url:o.original_image_url,is_primary:!0}]);const r=z.value.find(c=>c.is_primary);r?C.value=[r.id]:z.value.length>0?C.value=[z.value[0].id]:C.value=[]}catch{B("加载产品详情失败","error")}finally{ne.value=null}}}function Ut(l){const e=C.value.indexOf(l);e===-1?C.value.push(l):C.value.splice(e,1)}function Pt(l,e){return p[l].find(s=>s.id===e)??null}function Dt(l){Nt(()=>{const e=document.querySelector(`.option-edit-input[data-option-id="${l}"]`);e&&(e.focus(),e.select())})}function Oe(l,e){const s=k[l],o=s.indexOf(e);o===-1?s.push(e):s.splice(o,1)}function Ae(l){const e={id:Ve(l),label:"新选项"};p[l].push(e),Fe(),_e(l,e.id)}function we(l,e){const s=p[l].findIndex(r=>r.id===e);if(s===-1)return;p[l].splice(s,1);const o=k[l].indexOf(e);o!==-1&&k[l].splice(o,1),y.category===l&&y.id===e&&(y.category="",y.id=""),Fe()}function _e(l,e){y.category=l,y.id=e,Dt(e)}function te(){if(!y.category||!y.id)return;const l=y.category,e=y.id;y.category="",y.id="";const s=Pt(l,e);if(!s)return;const o=s.label.trim();if(!o){we(l,e);return}s.label=o,Fe()}function Mt(){p.scene=M.scene.map(l=>({...l})),p.angle=M.angle.map(l=>({...l})),p.style=M.style.map(l=>({...l})),p.target=M.target.map(l=>({...l})),k.scene=[],k.angle=[],k.style=[],k.target=[],y.category="",y.id="",ge.value=!1,Ee(!0),localStorage.removeItem("ecommerce-image-templates"),B("模板已重置为默认值","success")}function Fe(){const l={version:2,templates:{scene:p.scene.map(e=>({id:e.id,label:e.label})),angle:p.angle.map(e=>({id:e.id,label:e.label})),style:p.style.map(e=>({id:e.id,label:e.label})),target:p.target.map(e=>({id:e.id,label:e.label}))}};localStorage.setItem("ecommerce-image-templates",JSON.stringify(l))}function xe(l,e){if(!Array.isArray(l))return null;const s=[];for(const o of l){if(typeof o=="string"){const r=o.trim();r&&s.push({id:Ve(e),label:r});continue}if(o&&typeof o=="object"){const r=typeof o.label=="string"?o.label.trim():"";if(!r)continue;const c=typeof o.id=="string"?String(o.id):Ve(e);s.push({id:c,label:r})}}return s.length?s:null}function Vt(){const l=localStorage.getItem("ecommerce-image-templates");if(l)try{const e=JSON.parse(l),s=(e==null?void 0:e.templates)||e,o=xe(s==null?void 0:s.scene,"scene"),r=xe(s==null?void 0:s.angle,"angle"),c=xe(s==null?void 0:s.style,"style"),Y=xe(s==null?void 0:s.target,"target");o&&(p.scene=o),r&&(p.angle=r),c&&(p.style=c),Y&&(p.target=Y)}catch{}}function zt(){const l=Le(R.value);l!==R.value&&(R.value=l),localStorage.setItem("ecommerce-image-prompt-template",l)}function Et(){const l=localStorage.getItem("ecommerce-image-prompt-template");l&&(R.value=Le(l))}function It(){R.value=lt,localStorage.removeItem("ecommerce-image-prompt-template"),B("提示词模板已重置为默认值","success")}function jt(){O.apiKey=localStorage.getItem("global_api_key")||localStorage.getItem("video_api_key")||"",O.baseUrl=localStorage.getItem("global_base_url")||localStorage.getItem("video_base_url")||""}async function Lt(){if(T.value)try{await navigator.clipboard.writeText(T.value),B("提示词已复制到剪贴板","success")}catch{B("复制失败","error")}}async function et(){if(!(!Ze.value||U.value)){U.value=!0,ee.value="";try{const l=new FormData;l.append("prompt",T.value),l.append("model",g.model),l.append("response_format","url"),g.aspectRatio&&l.append("aspect_ratio",g.aspectRatio),g.imageSize&&l.append("image_size",g.imageSize);for(const Ce of C.value){const Re=z.value.find(Ne=>Ne.id===Ce);if(Re)try{const Ot=await(await fetch(Re.image_url)).blob();l.append("image",Ot,`ref-${Ce}.jpg`)}catch{console.warn("Failed to fetch reference image:",Re.image_url)}}const e={"X-CSRF-Token":He()},s=pt(O.apiKey);s&&(e["X-API-Key"]=s);const o=vt(O.baseUrl);o&&(e["X-Base-Url"]=o);const r=await fetch("/api/v1/images/edits",{method:"POST",credentials:"include",headers:e,body:l});if(!r.ok){const Ce=await r.json().catch(()=>({}));throw new Error(Ce.detail||`HTTP ${r.status}`)}const c=await r.json(),Y=c&&typeof c=="object"&&c.response?c.response:c,tt=Qe(Y)||Qe(c);if(tt)I.value=tt;else throw new Error("Invalid response format");B("图片生成成功","success"),We()}catch(l){ee.value=l.message||"生成失败，请重试"}finally{U.value=!1}}}function Kt(){if(!I.value)return;const l=document.createElement("a");l.href=I.value,l.download=`ecommerce-${Date.now()}.png`,document.body.appendChild(l),l.click(),document.body.removeChild(l)}let Ht=0;function B(l,e="info"){const s=Ht++;fe.value.push({id:s,message:l,type:e}),setTimeout(()=>{const o=fe.value.findIndex(r=>r.id===s);o!==-1&&fe.value.splice(o,1)},3e3)}return st(V,l=>{le.value="",l===2&&Ee()}),st(Ye,l=>{V.value>l&&(V.value=l)}),Ft(()=>{Vt(),Et(),jt(),ke(),yt(),We(),Ee(!0)}),(l,e)=>(i(),n("div",Wt,[e[99]||(e[99]=ae('<header class="header"><div class="logo"><div class="logo-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></div><span>电商图生成</span></div><div class="header-actions"><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> 返回主页面 </a></div></header>',1)),t("nav",es,[t("div",ts,[(i(),n(_,null,x(de,s=>t("button",{key:s.id,class:b(["wizard-step",{active:V.value===s.id,completed:N(s.id),disabled:!Ke(s.id)}]),"aria-current":V.value===s.id?"step":void 0,"aria-disabled":!Ke(s.id),onClick:o=>ct(s.id)},[t("span",ls,[N(s.id)?(i(),n("svg",ns,[...e[31]||(e[31]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(i(),n("span",is,a(s.id),1))]),t("span",os,a(s.title),1)],10,ss)),64))]),le.value?(i(),n("div",as,a(le.value),1)):u("",!0)]),t("div",rs,[t("aside",ds,[t("section",us,[e[37]||(e[37]=ae('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg> Model Selection </div>',1)),v(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=s=>g.model=s)},[...e[32]||(e[32]=[t("option",{value:"gemini-3-pro-image-preview"},"gemini-3-pro-image-preview (推荐)",-1),t("option",{value:"gemini-2.5-flash-image"},"gemini-2.5-flash-image (快速)",-1)])],512),[[Ge,g.model]]),t("div",cs,[e[34]||(e[34]=t("label",{class:"form-label"},"Aspect Ratio",-1)),v(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>g.aspectRatio=s)},[...e[33]||(e[33]=[ae('<option value="">Auto</option><option value="1:1">1:1 (Square)</option><option value="16:9">16:9 (Landscape)</option><option value="9:16">9:16 (Portrait)</option><option value="4:3">4:3</option><option value="3:4">3:4</option><option value="3:2">3:2</option><option value="2:3">2:3</option><option value="4:5">4:5</option><option value="5:4">5:4</option>',10)])],512),[[Ge,g.aspectRatio]])]),t("div",ps,[e[36]||(e[36]=t("label",{class:"form-label"},"Image Size",-1)),v(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=s=>g.imageSize=s)},[...e[35]||(e[35]=[t("option",{value:""},"Default",-1),t("option",{value:"1K"},"1K",-1),t("option",{value:"2K"},"2K",-1),t("option",{value:"4K"},"4K",-1)])],512),[[Ge,g.imageSize]])])]),t("section",vs,[e[44]||(e[44]=ae('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Z"></path><path d="M9 2v5"></path><path d="M15 2v5"></path><path d="M2 9h20"></path></svg> 选择产品 </div>',1)),t("div",ms,[e[38]||(e[38]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)),v(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=s=>pe.value=s),placeholder:"搜索产品...",onInput:mt},null,544),[[D,pe.value]])]),!ce.value&&ue.value.length>0?(i(),n("div",gs,[(i(!0),n(_,null,x(ue.value,s=>{var o,r,c;return i(),n("div",{key:s.id,class:b(["product-item",{selected:((o=$.value)==null?void 0:o.id)===s.id,loading:ne.value===s.id}]),onClick:Y=>Bt(s)},[t("div",hs,[t("img",{src:St(s),alt:s.name,class:"product-thumb"},null,8,ys),s.image_count>1?(i(),n("span",bs,a(s.image_count),1)):u("",!0)]),t("div",ks,[t("div",ws,a(s.name||"未命名产品"),1),t("div",_s,[s.dimensions?(i(),n("span",xs,a(s.dimensions),1)):u("",!0),s.dimensions&&s.image_count?(i(),n("span",Cs,"·")):u("",!0),s.image_count?(i(),n("span",Ts,a(s.image_count)+" 张",1)):u("",!0)])]),t("div",{class:b(["product-select-indicator",{active:((r=$.value)==null?void 0:r.id)===s.id}])},[ne.value===s.id?(i(),n("div",$s)):((c=$.value)==null?void 0:c.id)===s.id?(i(),n("svg",Ss,[...e[39]||(e[39]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):u("",!0)],2)],10,fs)}),128))])):!ce.value&&ue.value.length===0?(i(),n("div",Bs,[...e[40]||(e[40]=[t("p",null,"暂无产品",-1),t("a",{href:"/products",class:"btn btn-secondary btn-sm"},"前往产品库",-1)])])):(i(),n("div",Us,[...e[41]||(e[41]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])])),Pe.value>Be?(i(),n("div",Ps,[t("button",{class:"btn btn-ghost btn-sm",disabled:K.value<=1,onClick:Tt},[...e[42]||(e[42]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)])],8,Ds),t("span",Ms,a(K.value)+" / "+a(Me.value),1),t("button",{class:"btn btn-ghost btn-sm",disabled:K.value>=Me.value,onClick:$t},[...e[43]||(e[43]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 18 15 12 9 6"})],-1)])],8,Vs)])):u("",!0)]),$.value?(i(),n("section",zs,[t("div",Es,[e[45]||(e[45]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("polyline",{points:"21 15 16 10 5 21"})],-1)),j(" 参考图片 ("+a(C.value.length)+"/"+a(z.value.length)+") ",1)]),z.value.length>0?(i(),n("div",Is,[(i(!0),n(_,null,x(z.value,s=>(i(),n("div",{key:s.id,class:b(["image-item",{selected:C.value.includes(s.id)}]),onClick:o=>Ut(s.id)},[t("img",{src:s.image_url,alt:"Product image"},null,8,Ls),C.value.includes(s.id)?(i(),n("div",Ks,[...e[46]||(e[46]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white","stroke-width":"3"},[t("polyline",{points:"20 6 9 17 4 12"})],-1)])])):u("",!0),s.is_primary?(i(),n("div",Hs,"主图")):u("",!0)],10,js))),128))])):(i(),n("div",Os,[...e[47]||(e[47]=[t("p",null,"该产品暂无图片",-1)])]))])):u("",!0),t("section",As,[e[50]||(e[50]=t("div",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})]),j(" 生成历史 ")],-1)),!me.value&&ve.value.length>0?(i(),n("div",Fs,[(i(!0),n(_,null,x(ve.value,s=>(i(),n("div",{key:s.id,class:"product-item",onClick:o=>gt(s)},[t("img",{src:s.image_url||ot,alt:s.prompt,class:"product-thumb"},null,8,Ns),t("div",Gs,[t("div",Xs,a(ft(s.prompt,30)),1),t("div",qs,a(ht(s.created_at)),1)])],8,Rs))),128))])):!me.value&&ve.value.length===0?(i(),n("div",Js,[...e[48]||(e[48]=[t("p",null,"暂无生成历史",-1)])])):(i(),n("div",Zs,[...e[49]||(e[49]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])]))])]),t("main",Ys,[se(it,{name:"step-fade",mode:"out-in"},{default:L(()=>[V.value===1?(i(),n("section",Qs,[t("div",Ws,[t("div",el,[e[51]||(e[51]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"1"),t("div",null,[t("h3",null,"产品选择"),t("p",{class:"panel-subtitle"},"选择产品与参考图，并完善提示词字段")])],-1)),$.value?u("",!0):(i(),n("span",tl,"请先从左侧选择产品"))]),$.value?(i(),n("div",sl,[t("div",ll,[t("label",nl,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=s=>h.name=s)},null,512),[[$e,h.name]]),e[52]||(e[52]=t("span",null,"产品名称",-1))]),v(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[5]||(e[5]=s=>f.name=s),disabled:!h.name,placeholder:"例如：保温杯"},null,8,il),[[D,f.name]])]),t("div",ol,[t("label",al,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>h.dimensions=s)},null,512),[[$e,h.dimensions]]),e[53]||(e[53]=t("span",null,"尺寸规格",-1))]),v(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[7]||(e[7]=s=>f.dimensions=s),disabled:!h.dimensions,placeholder:"例如：500ml"},null,8,rl),[[D,f.dimensions]])]),t("div",dl,[t("label",ul,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>h.features=s)},null,512),[[$e,h.features]]),e[54]||(e[54]=t("span",null,"功能特征",-1))]),v(t("textarea",{class:"form-input","onUpdate:modelValue":e[9]||(e[9]=s=>f.featuresText=s),disabled:!h.features,rows:"2",placeholder:"每行一个特征"},null,8,cl),[[D,f.featuresText]])]),t("div",pl,[t("label",vl,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=s=>h.characteristics=s)},null,512),[[$e,h.characteristics]]),e[55]||(e[55]=t("span",null,"产品特点",-1))]),v(t("textarea",{class:"form-input","onUpdate:modelValue":e[11]||(e[11]=s=>f.characteristicsText=s),disabled:!h.characteristics,rows:"2",placeholder:"每行一个特点"},null,8,ml),[[D,f.characteristicsText]])])])):(i(),n("div",gl," 选择产品后将自动填充名称、规格与特征信息。 "))])])):V.value===2?(i(),n("section",fl,[t("div",hl,[t("div",{class:"panel-header"},[e[57]||(e[57]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"2"),t("div",null,[t("h3",null,"模板配置"),t("p",{class:"panel-subtitle"},"点击标签可多选，支持就地编辑")])],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:Mt},[...e[56]||(e[56]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),j(" 重置模板 ",-1)])])]),t("div",yl,[se(Se,{title:"场景选择",summary:ze("scene"),open:F.scene,onToggle:e[13]||(e[13]=s=>ye("scene"))},{actions:L(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[12]||(e[12]=m(s=>Ae("scene"),["stop"]))},[...e[58]||(e[58]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:L(()=>[t("div",bl,[(i(!0),n(_,null,x(p.scene,s=>(i(),n("div",{key:s.id,class:b(["option-chip",{selected:k.scene.includes(s.id),editing:H("scene",s.id)}])},[H("scene",s.id)?v((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:te,onKeydown:re(m(te,["prevent"]),["enter"])},null,40,wl)),[[D,s.label]]):(i(),n("span",{key:0,onClick:o=>Oe("scene",s.id)},a(s.label),9,kl)),H("scene",s.id)?u("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:m(o=>_e("scene",s.id),["stop"])},[...e[59]||(e[59]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,_l)),t("button",{class:"chip-delete",onClick:m(o=>we("scene",s.id),["stop"])},[...e[60]||(e[60]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,xl)],2))),128))])]),_:1},8,["summary","open"]),se(Se,{title:"拍摄角度",summary:ze("angle"),open:F.angle,onToggle:e[15]||(e[15]=s=>ye("angle"))},{actions:L(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[14]||(e[14]=m(s=>Ae("angle"),["stop"]))},[...e[61]||(e[61]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:L(()=>[t("div",Cl,[(i(!0),n(_,null,x(p.angle,s=>(i(),n("div",{key:s.id,class:b(["option-chip",{selected:k.angle.includes(s.id),editing:H("angle",s.id)}])},[H("angle",s.id)?v((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:te,onKeydown:re(m(te,["prevent"]),["enter"])},null,40,$l)),[[D,s.label]]):(i(),n("span",{key:0,onClick:o=>Oe("angle",s.id)},a(s.label),9,Tl)),H("angle",s.id)?u("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:m(o=>_e("angle",s.id),["stop"])},[...e[62]||(e[62]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Sl)),t("button",{class:"chip-delete",onClick:m(o=>we("angle",s.id),["stop"])},[...e[63]||(e[63]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Bl)],2))),128))])]),_:1},8,["summary","open"]),se(Se,{title:"风格 / 光影",summary:ze("style"),open:F.style,onToggle:e[17]||(e[17]=s=>ye("style"))},{"title-extra":L(()=>[...e[64]||(e[64]=[t("span",{class:"optional-tag"},"(可选)",-1)])]),actions:L(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[16]||(e[16]=m(s=>Ae("style"),["stop"]))},[...e[65]||(e[65]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:L(()=>[t("div",Ul,[(i(!0),n(_,null,x(p.style,s=>(i(),n("div",{key:s.id,class:b(["option-chip",{selected:k.style.includes(s.id),editing:H("style",s.id)}])},[H("style",s.id)?v((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:te,onKeydown:re(m(te,["prevent"]),["enter"])},null,40,Dl)),[[D,s.label]]):(i(),n("span",{key:0,onClick:o=>Oe("style",s.id)},a(s.label),9,Pl)),H("style",s.id)?u("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:m(o=>_e("style",s.id),["stop"])},[...e[66]||(e[66]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Ml)),t("button",{class:"chip-delete",onClick:m(o=>we("style",s.id),["stop"])},[...e[67]||(e[67]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Vl)],2))),128))])]),_:1},8,["summary","open"]),se(Se,{title:"生成目标",summary:J.value?J.value.name:"未选择",open:F.target,onToggle:e[21]||(e[21]=s=>ye("target"))},{default:L(()=>[t("div",zl,[t("div",El,[(i(!0),n(_,null,x(ie.value,s=>(i(),n("label",{key:s.id,class:b(["target-type-radio",{selected:E.value===s.id}])},[v(t("input",{type:"radio",name:"target-type",value:s.id,"onUpdate:modelValue":e[18]||(e[18]=o=>E.value=o),onChange:o=>Ct(s.id)},null,40,Il),[[Rt,E.value]]),t("span",jl,a(s.name),1)],2))),128))]),E.value?(i(),n("div",Ll,[A.value.length>0?(i(),n("div",Kl,[e[69]||(e[69]=t("label",{class:"target-description-label"},"已保存的描述",-1)),t("div",Hl,[(i(!0),n(_,null,x(A.value,s=>(i(),n("div",{key:s.id,class:b(["saved-description-item",{active:q.value===s.id}])},[t("button",{class:"saved-description-btn",onClick:o=>kt(s)},a(s.name),9,Ol),t("button",{class:"saved-description-delete",onClick:m(o=>_t(s.id),["stop"]),title:"删除"},[...e[68]||(e[68]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Al)],2))),128))])])):u("",!0),e[71]||(e[71]=t("label",{class:"target-description-label"},"目标描述",-1)),v(t("textarea",{class:"form-input target-textarea","onUpdate:modelValue":e[19]||(e[19]=s=>w.value=s),placeholder:rt.value,disabled:at.value||Q.value,rows:"3"},null,8,Fl),[[D,w.value]]),t("div",Rl,[t("button",{class:"btn btn-secondary btn-sm",type:"button",onClick:e[20]||(e[20]=s=>W.value=!0),disabled:!w.value.trim()||Q.value},[...e[70]||(e[70]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),t("polyline",{points:"17 21 17 13 7 13 7 21"}),t("polyline",{points:"7 3 7 8 15 8"})],-1),j(" 保存描述 ",-1)])],8,Nl),t("button",{class:"btn btn-ghost btn-sm",type:"button",onClick:xt,disabled:!J.value}," 重置为默认 ",8,Gl)]),e[72]||(e[72]=t("p",{class:"target-description-hint"}," 描述将作为生成提示词的一部分，请详细描述您期望的效果 ",-1))])):u("",!0),De.value?(i(),n("div",Xl,[...e[73]||(e[73]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载目标类型...",-1)])])):u("",!0)])]),_:1},8,["summary","open"])]),t("div",ql,[t("div",{class:"template-editor-header"},[e[75]||(e[75]=t("div",null,[t("h4",null,"提示词模板"),t("p",{class:"template-editor-subtitle"},"系统会自动拼接已选信息，可补充额外描述")],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:It},[...e[74]||(e[74]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),j(" 重置模板 ",-1)])])]),t("div",Jl,[e[76]||(e[76]=t("div",{class:"template-editor-hint"}," 已选场景/角度等会自动生成，例如：场景：客厅，拍摄角度：正面。 ",-1)),v(t("textarea",{class:"form-input template-textarea","onUpdate:modelValue":e[22]||(e[22]=s=>R.value=s),rows:"4",placeholder:"补充提示词",onInput:zt},null,544),[[D,R.value]])])])])])):V.value===3?(i(),n("section",Zl,[t("div",Yl,[t("div",Ql,[e[77]||(e[77]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"3"),t("div",null,[t("h3",null,"提示词预览"),t("p",{class:"panel-subtitle"},"分段预览并高亮关键信息")])],-1)),T.value?u("",!0):(i(),n("span",Wl,"完善产品信息与模板后自动生成"))]),t("div",en,[t("div",tn,[e[78]||(e[78]=t("span",{class:"prompt-label"},"产品信息",-1)),t("div",{class:b(["prompt-value",{empty:S.value.product.length===0}])},[S.value.product.length?(i(!0),n(_,{key:0},x(S.value.product,(s,o)=>(i(),n("span",{key:`product-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",sn,"未选择或未填写"))],2)]),t("div",ln,[e[79]||(e[79]=t("span",{class:"prompt-label"},"场景",-1)),t("div",{class:b(["prompt-value",{empty:S.value.scene.length===0}])},[S.value.scene.length?(i(!0),n(_,{key:0},x(S.value.scene,(s,o)=>(i(),n("span",{key:`scene-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",nn,"未选择场景"))],2)]),t("div",on,[e[80]||(e[80]=t("span",{class:"prompt-label"},"角度",-1)),t("div",{class:b(["prompt-value",{empty:S.value.angle.length===0}])},[S.value.angle.length?(i(!0),n(_,{key:0},x(S.value.angle,(s,o)=>(i(),n("span",{key:`angle-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",an,"未选择角度"))],2)]),t("div",rn,[e[81]||(e[81]=t("span",{class:"prompt-label"},"风格 / 光影",-1)),t("div",{class:b(["prompt-value",{empty:S.value.style.length===0}])},[S.value.style.length?(i(!0),n(_,{key:0},x(S.value.style,(s,o)=>(i(),n("span",{key:`style-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",dn,"未选择风格"))],2)]),t("div",un,[e[82]||(e[82]=t("span",{class:"prompt-label"},"生成目标",-1)),t("div",{class:b(["prompt-value",{empty:!w.value}])},[w.value?(i(),n("span",cn,[J.value?(i(),n("span",pn,a(J.value.name)+"：",1)):u("",!0),j(" "+a(w.value),1)])):(i(),n("span",vn,"未选择目标"))],2)])]),t("div",mn,[t("div",gn,[e[84]||(e[84]=t("div",null,[t("h4",null,"完整 Prompt"),t("p",{class:"prompt-full-hint"},"可直接复制用于生成")],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:Lt,disabled:!T.value},[...e[83]||(e[83]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1),j(" 复制 ",-1)])],8,fn)]),t("div",hn,[T.value?(i(),n("p",yn,a(T.value),1)):(i(),n("p",bn,"选择产品和模板选项后，提示词将在这里生成。"))])])])])):(i(),n("section",kn,[t("div",wn,[t("div",_n,[e[85]||(e[85]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"4"),t("div",null,[t("h3",null,"生成与结果"),t("p",{class:"panel-subtitle"},"确认参考图与提示词后开始生成")])],-1)),be.value?(i(),n("span",xn,a(be.value),1)):u("",!0)]),t("div",Cn,[!U.value&&!I.value?(i(),n("div",Tn,[...e[86]||(e[86]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("polyline",{points:"21 15 16 10 5 21"})],-1),t("h3",null,"准备生成",-1),t("p",null,"选择产品、参考图片与模板选项，然后点击生成。",-1)])])):u("",!0),U.value?(i(),n("div",$n,[...e[87]||(e[87]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成图片...",-1)])])):u("",!0),I.value&&!U.value?(i(),n("div",Sn,[t("img",{src:I.value,alt:"Generated image",class:"result-image"},null,8,Bn),t("div",{class:"result-actions"},[t("button",{class:"btn btn-secondary",onClick:Kt},[...e[88]||(e[88]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),j(" 下载 ",-1)])]),t("button",{class:"btn btn-primary",onClick:et},[...e[89]||(e[89]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),j(" 重新生成 ",-1)])])])])):u("",!0)]),t("div",Un,[t("button",{class:"generate-btn",disabled:!Ze.value||U.value,onClick:et},[U.value?(i(),n("div",Mn)):(i(),n("svg",Dn,[...e[90]||(e[90]=[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),j(" "+a(U.value?"生成中...":"生成电商图"),1)],8,Pn),be.value?(i(),n("div",Vn,a(be.value),1)):u("",!0)])])]))]),_:1})]),t("aside",zn,[t("div",En,[t("div",In,[e[91]||(e[91]=t("h4",null,"提示词预览",-1)),T.value?u("",!0):(i(),n("span",jn,"完成前两步后显示"))]),t("div",Ln,[T.value?(i(),n("p",Kn,a(T.value),1)):(i(),n("p",Hn,"选择产品与模板选项后生成提示词。"))])]),t("div",On,[e[93]||(e[93]=t("div",{class:"preview-card-header"},[t("h4",null,"生成结果")],-1)),t("div",An,[U.value?(i(),n("div",Fn,[...e[92]||(e[92]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"正在生成...",-1)])])):I.value?(i(),n("div",Rn,[t("img",{src:I.value,alt:"Generated preview",class:"preview-image"},null,8,Nn)])):(i(),n("p",Gn,"生成完成后显示结果。"))])])])]),t("div",Xn,[(i(!0),n(_,null,x(fe.value,s=>(i(),n("div",{key:s.id,class:b(["toast",s.type])},a(s.message),3))),128))]),ee.value?(i(),n("div",{key:0,class:"error-overlay",onClick:e[25]||(e[25]=s=>ee.value="")},[t("div",{class:"error-modal",onClick:e[24]||(e[24]=m(()=>{},["stop"]))},[e[94]||(e[94]=ae('<div class="error-header"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><h3>生成失败</h3></div>',1)),t("p",null,a(ee.value),1),t("button",{class:"btn btn-primary",onClick:e[23]||(e[23]=s=>ee.value="")},"确定")])])):u("",!0),W.value?(i(),n("div",{key:1,class:"save-dialog-overlay",onClick:e[30]||(e[30]=s=>W.value=!1)},[t("div",{class:"save-dialog-modal",onClick:e[29]||(e[29]=m(()=>{},["stop"]))},[t("div",qn,[e[96]||(e[96]=t("h3",null,"保存目标描述",-1)),t("button",{class:"save-dialog-close",onClick:e[26]||(e[26]=s=>W.value=!1)},[...e[95]||(e[95]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),t("div",Jn,[t("div",Zn,[e[97]||(e[97]=t("label",{class:"form-label"},"描述名称",-1)),v(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[27]||(e[27]=s=>oe.value=s),placeholder:"例如：清新自然风格",maxlength:"100"},null,512),[[D,oe.value]])]),t("div",Yn,[e[98]||(e[98]=t("label",{class:"form-label"},"描述内容",-1)),t("textarea",{class:"form-input",value:w.value,readonly:"",rows:"3"},null,8,Qn)])]),t("div",Wn,[t("button",{class:"btn btn-secondary",onClick:e[28]||(e[28]=s=>W.value=!1)},"取消"),t("button",{class:"btn btn-primary",onClick:wt,disabled:!oe.value.trim()||Q.value},a(Q.value?"保存中...":"保存"),9,ei)])])])):u("",!0)]))}});Gt(ti).mount("#app");
