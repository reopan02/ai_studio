import{d as ct,a as n,b as i,n as y,e as t,s as ae,l as ge,q as k,f as d,u as De,t as a,T as pt,x as A,w as p,v as Wt,m as W,r as u,c as E,y as dt,o as Yt,g as ve,F as h,p as f,z as Ve,k as z,i as I,A as je,B as Qt,C as es,j as ts}from"./runtime-dom.esm-bundler-D9CM_geE.js";/* empty css                        */const ss=["aria-expanded","onKeydown"],ls={class:"collapsible-title"},ns={class:"collapsible-title-text"},is={key:0,class:"collapsible-summary"},os={class:"collapsible-actions"},as={class:"collapsible-body"},Ee=ct({__name:"CollapsibleGroup",props:{title:{},summary:{},open:{type:Boolean}},emits:["toggle"],setup(Y,{emit:Ie}){const L=Ie;function N(){L("toggle")}return(m,me)=>(i(),n("div",{class:y(["collapsible-group",{collapsed:!Y.open}])},[t("div",{class:"collapsible-header",role:"button",tabindex:"0","aria-expanded":Y.open,onClick:N,onKeydown:[ge(k(N,["prevent"]),["enter"]),ge(k(N,["prevent"]),["space"])]},[t("div",ls,[t("span",ns,a(Y.title),1),De(m.$slots,"title-extra")]),Y.open?d("",!0):(i(),n("div",is,[De(m.$slots,"summary",{},()=>[t("span",null,a(Y.summary),1)])])),t("div",os,[De(m.$slots,"actions"),me[0]||(me[0]=t("span",{class:"collapsible-toggle"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"6 9 12 15 18 9"})])],-1))])],40,ss),ae(pt,{name:"collapse"},{default:A(()=>[p(t("div",as,[De(m.$slots,"default")],512),[[Wt,Y.open]])]),_:3})],2))}}),rs={class:"ecommerce-image-page"},ds={class:"wizard-nav"},us={class:"wizard-steps"},cs=["aria-current","aria-disabled","onClick"],ps={class:"wizard-step-indicator"},vs={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},gs={key:1},ms={class:"wizard-step-label"},hs={key:0,class:"wizard-step-hint"},fs={class:"main-container"},ys={class:"sidebar"},ks={class:"sidebar-section"},bs={class:"form-group",style:{"margin-top":"16px"}},ws={class:"form-group"},_s={class:"form-group"},xs=["value"],Cs={class:"sidebar-section"},Ts={class:"search-wrapper"},$s={key:0,class:"product-list"},Ss=["onClick"],Bs={class:"product-thumb-wrap"},Ps=["src","alt"],Us={key:0,class:"product-count-badge"},Ms={class:"product-info"},Ds={class:"product-name"},Vs={class:"product-meta"},js={key:0},Es={key:1},zs={key:2},Is={key:0,class:"spinner-small"},Ls={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},Ks={key:1,class:"product-list-empty"},Hs={key:2,class:"product-list-loading"},As={key:3,class:"pagination"},Fs=["disabled"],Os={class:"page-info"},Rs=["disabled"],Ns={key:0,class:"sidebar-section"},Gs={class:"section-title"},Xs={key:0,class:"image-grid"},qs=["onClick"],Js=["src"],Zs={key:0,class:"image-check"},Ws={key:1,class:"image-primary"},Ys={key:1,class:"no-images"},Qs={class:"main-content"},el={key:0,class:"workflow-section"},tl={class:"content-panel"},sl={class:"panel-header"},ll={key:0,class:"panel-hint"},nl={key:0,class:"product-fields"},il={class:"field-row"},ol={class:"field-checkbox"},al=["disabled"],rl={class:"field-row"},dl={class:"field-checkbox"},ul=["disabled"],cl={class:"field-row"},pl={class:"field-checkbox"},vl=["disabled"],gl={class:"field-row"},ml={class:"field-checkbox"},hl=["disabled"],fl={key:1,class:"panel-empty"},yl={key:1,class:"workflow-section"},kl={class:"content-panel"},bl={class:"template-modules"},wl={class:"option-chips"},_l=["onClick"],xl=["onUpdate:modelValue","data-option-id","onKeydown"],Cl=["onClick"],Tl=["onClick"],$l={class:"option-chips"},Sl=["onClick"],Bl=["onUpdate:modelValue","data-option-id","onKeydown"],Pl=["onClick"],Ul=["onClick"],Ml={class:"option-chips"},Dl=["onClick"],Vl=["onUpdate:modelValue","data-option-id","onKeydown"],jl=["onClick"],El=["onClick"],zl={class:"target-type-selector"},Il={class:"target-type-options"},Ll=["value","onChange"],Kl={class:"target-type-label"},Hl={key:0,class:"target-description-input"},Al={key:0,class:"saved-descriptions-section"},Fl={class:"saved-descriptions-list"},Ol=["onClick"],Rl=["onClick"],Nl=["placeholder","disabled"],Gl={class:"target-description-actions"},Xl=["disabled"],ql=["disabled"],Jl={key:1,class:"target-loading"},Zl={class:"template-editor"},Wl={class:"template-editor-section"},Yl={key:2,class:"workflow-section"},Ql={class:"content-panel prompt-preview-panel"},en={class:"panel-header"},tn={key:0,class:"panel-hint"},sn={class:"prompt-structured"},ln={class:"prompt-row"},nn={key:1,class:"prompt-empty"},on={class:"prompt-row"},an={key:1,class:"prompt-empty"},rn={class:"prompt-row"},dn={key:1,class:"prompt-empty"},un={class:"prompt-row"},cn={key:1,class:"prompt-empty"},pn={class:"prompt-row"},vn={key:0,class:"prompt-chip target-chip"},gn={key:0,class:"target-chip-name"},mn={key:1,class:"prompt-empty"},hn={class:"prompt-full"},fn={class:"prompt-full-header"},yn=["disabled"],kn={class:"prompt-full-body"},bn={key:0},wn={key:1,class:"prompt-placeholder"},_n={key:3,class:"workflow-section"},xn={class:"content-panel"},Cn={class:"panel-header"},Tn={key:0,class:"panel-hint"},$n={class:"result-area"},Sn={key:0,class:"result-placeholder"},Bn={key:1,class:"loading-state"},Pn={key:0},Un={key:1},Mn={key:2,class:"result-container"},Dn=["src"],Vn={class:"result-image-overlay"},jn=["onClick"],En={class:"result-actions"},zn={class:"generate-section"},In=["disabled"],Ln={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Kn={key:1,class:"spinner-small"},Hn={key:0,class:"generate-hint"},An={key:0,class:"history-section"},Fn={class:"history-header"},On={key:0,class:"history-count"},Rn={key:0,class:"history-grid"},Nn=["onClick"],Gn=["src","alt"],Xn={class:"history-info"},qn={class:"history-prompt"},Jn={class:"history-meta"},Zn={key:1,class:"history-loading"},Wn={class:"preview-panel"},Yn={class:"preview-card"},Qn={class:"preview-card-header"},ei={key:0,class:"preview-card-hint"},ti={class:"preview-card-body"},si={key:0},li={key:1,class:"preview-placeholder"},ni={class:"preview-card"},ii={class:"preview-card-header"},oi={key:0,class:"preview-count"},ai={class:"preview-card-body preview-result"},ri={key:0,class:"preview-loading"},di={key:0},ui={key:1},ci={key:1,class:"preview-images-grid"},pi=["src"],vi={key:2,class:"preview-placeholder"},gi={class:"toast-container"},mi={class:"save-dialog-header"},hi={class:"save-dialog-body"},fi={class:"form-group"},yi={class:"form-group"},ki=["value"],bi={class:"save-dialog-footer"},wi=["disabled"],ut="",ze=10,_i=ct({__name:"ecommerce-image-page",setup(Y){const Ie=[{id:"target-main",name:"主图",placeholder:"请描述主图的展示重点，如产品摆放方式、突出的卖点...",default_template:"适合电商主图展示的产品图，突出产品整体外观，简洁大方",sort_order:0},{id:"target-detail",name:"详情页",placeholder:"请描述详情页需要展示的产品细节或使用场景...",default_template:"适合详情页的产品展示图，展现产品细节和使用场景",sort_order:1},{id:"target-poster",name:"海报",placeholder:"请描述海报的主题和风格，如促销活动、节日氛围...",default_template:"具有视觉冲击力的营销海报风格，适合活动推广",sort_order:2},{id:"target-white",name:"白底图",placeholder:"请描述白底图的拍摄角度和展示方式...",default_template:"纯白色背景的产品图，适合平台商品展示",sort_order:3},{id:"target-scene",name:"场景图",placeholder:"请描述期望的使用场景和环境氛围...",default_template:"产品在真实使用场景中的展示图，增强代入感",sort_order:4}],L={scene:[{id:"scene-white",label:"白色背景"},{id:"scene-natural-table",label:"自然光桌面"},{id:"scene-outdoor",label:"户外场景"},{id:"scene-solid",label:"纯色背景"},{id:"scene-life",label:"生活场景"}],angle:[{id:"angle-front",label:"正面"},{id:"angle-45",label:"45度侧面"},{id:"angle-top",label:"俯视"},{id:"angle-eye",label:"平视"},{id:"angle-close",label:"特写"}],style:[{id:"style-soft",label:"柔和光影"},{id:"style-contrast",label:"高对比度"},{id:"style-natural",label:"自然光"},{id:"style-studio",label:"专业棚拍"},{id:"style-warm",label:"暖色调"}],target:[{id:"target-main",label:"主图"},{id:"target-detail",label:"详情页"},{id:"target-poster",label:"海报"},{id:"target-white",label:"白底图"},{id:"target-scene",label:"场景图"}]},N=W({apiKey:"",baseUrl:""}),m=W({model:"gemini-3-pro-image-preview",aspectRatio:"",imageSize:"1K",generateCount:1}),me=[{id:1,title:"选择产品"},{id:2,title:"配置模板"},{id:3,title:"预览提示词"},{id:4,title:"生成图片"}],D=u(1),re=u(""),he=u([]),fe=u(!1),ye=u(""),F=u(1),Le=u(0),P=u(null),K=u([]),S=u([]),de=u(null),se=u([]),ue=u(!1),vt="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
  <rect width="100" height="100" fill="#1a1a2e"/>
  <rect x="25" y="25" width="50" height="50" rx="4" fill="none" stroke="#4a4a6a" stroke-width="2"/>
  <circle cx="38" cy="38" r="5" fill="#4a4a6a"/>
  <path d="M25 65 L45 45 L55 55 L75 35 L75 75 L25 75 Z" fill="#4a4a6a" opacity="0.5"/>
</svg>
`),b=W({name:"",dimensions:"",featuresText:"",characteristicsText:""}),ce=u([]),Ke=u(!1),H=u(null),T=u(""),gt=u(!1),le=u(!1),G=u([]),ne=u(!1),Q=u(null),pe=u(""),ee=E(()=>H.value&&ce.value.find(l=>l.id===H.value)||null),mt=E(()=>{var l;return((l=ee.value)==null?void 0:l.placeholder)||"请描述您期望的生成效果..."}),w=W({name:!0,dimensions:!0,features:!0,characteristics:!0}),v=W({scene:L.scene.map(l=>({...l})),angle:L.angle.map(l=>({...l})),style:L.style.map(l=>({...l})),target:L.target.map(l=>({...l}))}),C=W({scene:[],angle:[],style:[],target:[]}),X=W({scene:!0,angle:!1,style:!1,target:!1}),ke=u(!1),_=W({category:"",id:""}),q=u(ut),V=u(!1),g=u([]),O=u({current:0,total:0}),ie=u(""),be=u([]),He=E(()=>Math.ceil(Le.value/ze));function Ae(l){return globalThis.crypto&&"randomUUID"in globalThis.crypto?`${l}-${globalThis.crypto.randomUUID()}`:`${l}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function st(l){return l.split(`
`).map(e=>e.trim()).filter(Boolean)}function lt(l){return l.filter(Boolean).join("、")}function we(l){const e=new Set(C[l]);return v[l].filter(s=>e.has(s.id)).map(s=>s.label.trim()).filter(Boolean)}function R(l,e){return _.category===l&&_.id===e}const te=E(()=>({scene:we("scene"),angle:we("angle"),style:we("style"),target:we("target")})),ht=E(()=>C.scene.length>0||C.angle.length>0||C.style.length>0||!!H.value);function Fe(l){const e=te.value[l];return e.length?e.length<=2?e.join("、"):`${e[0]}、${e[1]} 等${e.length}项`:"未选择"}function _e(l){X[l]=!X[l],ke.value=!0}function Oe(l=!1){if(ke.value&&!l)return;const e=["scene","angle","style","target"];let s=!1;e.forEach(o=>{!s&&C[o].length===0?(X[o]=!0,s=!0):X[o]=!1}),ke.value=!1}const Re=E(()=>{const l=[],e=b.name.trim(),s=b.dimensions.trim();return w.name&&e&&l.push(e),w.dimensions&&s&&l.push(s),w.features&&l.push(...st(b.featuresText)),w.characteristics&&l.push(...st(b.characteristicsText)),l}),U=E(()=>({product:Re.value,scene:te.value.scene,angle:te.value.angle,style:te.value.style,target:T.value?[T.value]:[]}));function Ne(l,e){return e.length?`${l}：${lt(e)}`:""}function nt(l){return l.replace(/[，、]{2,}/g,"，").replace(/^[，、\s]+/,"").replace(/[，、\s]+$/,"").replace(/\s*[，、]\s*/g,"，").trim()}function Ge(l){if(!l)return"";const e=l.trim();if(!e.includes("{{"))return e;const s=e.replace(/\{\{(\w+)(?:\|([^}]*))?\}\}/g,(o,r,c)=>c??"");return nt(s)}const B=E(()=>{if(!P.value)return"";const l=[];Re.value.length&&l.push(lt(Re.value));const e=Ne("场景",te.value.scene);e&&l.push(e);const s=Ne("拍摄角度",te.value.angle);s&&l.push(s);const o=Ne("风格",te.value.style);o&&l.push(o);const r=T.value.trim();r&&l.push(r);const c=Ge(q.value);return c&&l.push(c),nt(l.join("，"))}),it=E(()=>P.value&&S.value.length>0&&B.value.length>0),xe=E(()=>V.value?"正在生成图片...":P.value?S.value.length===0?"请选择至少一张参考图片":B.value?"":"请完善模板选项或产品信息":"请先在左侧选择产品");function J(l){return l===1?!!P.value&&S.value.length>0:l===2?ht.value:l===3?B.value.length>0:l===4?g.value.length>0:!1}const ot=E(()=>J(1)?J(2)?J(3)?4:3:2:1);function Xe(l){return l<=ot.value}function ft(){return J(1)?J(2)?J(3)?"请先完成前置步骤":"请先完成步骤3：完善提示词预览":"请先完成步骤2：至少选择一个模板选项":"请先完成步骤1：选择产品并勾选参考图"}function yt(l){if(Xe(l)){D.value=l,re.value="";return}re.value=ft()}function qe(){const l=document.cookie.match(/csrf_token=([^;]+)/);return l?l[1]:""}function kt(l){return String(l||"").trim().replace(/^bearer\s+/i,"").trim()}function bt(l){return String(l||"").trim()||null}function Ce(l,e){if(!l||typeof l!="object")return null;if(Array.isArray(l.data)&&l.data[0]){const s=l.data[0];if(e)return`/api/v1/images/${e}/data/0`;if(s!=null&&s.saved_url)return s.saved_url;if(s!=null&&s.url)return s.url;if(s!=null&&s.b64_json)return`data:image/png;base64,${s.b64_json}`}return e&&l.b64_json?`/api/v1/images/${e}/data/0`:l.saved_url?l.saved_url:l.url?l.url:l.b64_json?`data:image/png;base64,${l.b64_json}`:l.image_url?l.image_url:null}async function Te(){fe.value=!0;try{const l=new URLSearchParams({offset:String((F.value-1)*ze),limit:String(ze)});ye.value&&l.set("name",ye.value);const e=await fetch(`/api/v1/products?${l}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch products");const s=await e.json();he.value=s.products||[],Le.value=s.total||0}catch{$("加载产品列表失败","error")}finally{fe.value=!1}}function wt(){F.value=1,Te()}async function at(){ue.value=!0;try{const l=await fetch("/api/v1/images?limit=20",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch history");const s=await l.json()||[],o=s.filter(r=>!r.image_url);if(o.length>0){const r=o.slice(0,5).map(async c=>{try{const M=await fetch(`/api/v1/images/${c.id}`,{credentials:"include"});if(M.ok){const Qe=await M.json(),Pe=Ce(Qe.response,c.id);Pe&&(c.image_url=Pe)}}catch(M){console.warn("Failed to fetch image detail:",M)}});await Promise.all(r)}se.value=s}catch(l){console.error("Failed to load history:",l)}finally{ue.value=!1}}async function _t(l){if(l.image_url){g.value=[l.image_url],D.value=4;return}try{const e=await fetch(`/api/v1/images/${l.id}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch image detail");const s=await e.json(),o=Ce(s.response,l.id);o?(g.value=[o],l.image_url=o,D.value=4):$("无法加载图片数据","error")}catch{$("加载图片失败","error")}}function xt(l,e){return l?l.length<=e?l:l.substring(0,e)+"...":""}function Ct(l){return l?new Date(l).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}async function Tt(){Ke.value=!0;try{const l=await fetch("/api/v1/target-types",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch target types");const e=await l.json();ce.value=e.target_types||[]}catch{console.warn("Failed to load target types from API, using defaults"),ce.value=[...Ie]}finally{Ke.value=!1}}async function $t(l){if(!l){G.value=[];return}try{const e=await fetch(`/api/v1/target-descriptions?target_type_id=${encodeURIComponent(l)}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch saved descriptions");const s=await e.json();G.value=s.descriptions||[]}catch(e){console.warn("Failed to load saved descriptions:",e),G.value=[]}}function St(l){T.value=l.description,Q.value=l.id}async function Bt(){const l=H.value,e=pe.value.trim(),s=T.value.trim();if(!l||!e||!s){$("请填写名称和描述","error");return}le.value=!0;try{const o={target_type_id:l,name:e,description:s},r=await fetch("/api/v1/target-descriptions",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":qe()},body:JSON.stringify(o)});if(!r.ok){const M=await r.json().catch(()=>({}));throw new Error(M.detail||`HTTP ${r.status}`)}const c=await r.json();G.value.unshift(c),Q.value=c.id,ne.value=!1,pe.value="",$("描述已保存","success")}catch(o){$(o.message||"保存描述失败","error")}finally{le.value=!1}}async function Pt(l){if(confirm("确定要删除这个保存的描述吗？"))try{const e=await fetch(`/api/v1/target-descriptions/${l}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":qe()}});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||`HTTP ${e.status}`)}G.value=G.value.filter(s=>s.id!==l),Q.value===l&&(Q.value=null),$("描述已删除","success")}catch(e){$(e.message||"删除描述失败","error")}}function Ut(){const l=ee.value;l&&(T.value=l.default_template||"",Q.value=null)}async function Mt(l){const e=H.value;if(H.value=l,e!==l){Q.value=null;const s=ce.value.find(o=>o.id===l);T.value=(s==null?void 0:s.default_template)||"",await $t(l)}}function Dt(){F.value>1&&(F.value--,Te())}function Vt(){F.value<He.value&&(F.value++,Te())}function jt(l){if(l.images&&l.images.length>0){const e=l.images.find(s=>s.is_primary);return e?e.image_url:l.images[0].image_url}return l.original_image_url||"/static/placeholder.png"}async function Et(l){var e;if(l!=null&&l.id&&((e=P.value)==null?void 0:e.id)!==l.id&&!de.value){de.value=l.id;try{const s=await fetch(`/api/v1/products/${l.id}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to load product details");const o=await s.json();P.value=o,b.name=o.name||"",b.dimensions=o.dimensions||"",b.featuresText=(o.features||[]).join(`
`),b.characteristicsText=(o.characteristics||[]).join(`
`),K.value=o.images||[],K.value.length===0&&o.original_image_url&&(K.value=[{id:o.id,image_url:o.original_image_url,is_primary:!0}]);const r=K.value.find(c=>c.is_primary);r?S.value=[r.id]:K.value.length>0?S.value=[K.value[0].id]:S.value=[]}catch{$("加载产品详情失败","error")}finally{de.value=null}}}function zt(l){const e=S.value.indexOf(l);e===-1?S.value.push(l):S.value.splice(e,1)}function It(l,e){return v[l].find(s=>s.id===e)??null}function Lt(l){es(()=>{const e=document.querySelector(`.option-edit-input[data-option-id="${l}"]`);e&&(e.focus(),e.select())})}function Je(l,e){const s=C[l],o=s.indexOf(e);o===-1?s.push(e):s.splice(o,1)}function Ze(l){const e={id:Ae(l),label:"新选项"};v[l].push(e),We(),Se(l,e.id)}function $e(l,e){const s=v[l].findIndex(r=>r.id===e);if(s===-1)return;v[l].splice(s,1);const o=C[l].indexOf(e);o!==-1&&C[l].splice(o,1),_.category===l&&_.id===e&&(_.category="",_.id=""),We()}function Se(l,e){_.category=l,_.id=e,Lt(e)}function oe(){if(!_.category||!_.id)return;const l=_.category,e=_.id;_.category="",_.id="";const s=It(l,e);if(!s)return;const o=s.label.trim();if(!o){$e(l,e);return}s.label=o,We()}function Kt(){v.scene=L.scene.map(l=>({...l})),v.angle=L.angle.map(l=>({...l})),v.style=L.style.map(l=>({...l})),v.target=L.target.map(l=>({...l})),C.scene=[],C.angle=[],C.style=[],C.target=[],_.category="",_.id="",ke.value=!1,Oe(!0),localStorage.removeItem("ecommerce-image-templates"),$("模板已重置为默认值","success")}function We(){const l={version:2,templates:{scene:v.scene.map(e=>({id:e.id,label:e.label})),angle:v.angle.map(e=>({id:e.id,label:e.label})),style:v.style.map(e=>({id:e.id,label:e.label})),target:v.target.map(e=>({id:e.id,label:e.label}))}};localStorage.setItem("ecommerce-image-templates",JSON.stringify(l))}function Be(l,e){if(!Array.isArray(l))return null;const s=[];for(const o of l){if(typeof o=="string"){const r=o.trim();r&&s.push({id:Ae(e),label:r});continue}if(o&&typeof o=="object"){const r=typeof o.label=="string"?o.label.trim():"";if(!r)continue;const c=typeof o.id=="string"?String(o.id):Ae(e);s.push({id:c,label:r})}}return s.length?s:null}function Ht(){const l=localStorage.getItem("ecommerce-image-templates");if(l)try{const e=JSON.parse(l),s=(e==null?void 0:e.templates)||e,o=Be(s==null?void 0:s.scene,"scene"),r=Be(s==null?void 0:s.angle,"angle"),c=Be(s==null?void 0:s.style,"style"),M=Be(s==null?void 0:s.target,"target");o&&(v.scene=o),r&&(v.angle=r),c&&(v.style=c),M&&(v.target=M)}catch{}}function At(){const l=Ge(q.value);l!==q.value&&(q.value=l),localStorage.setItem("ecommerce-image-prompt-template",l)}function Ft(){const l=localStorage.getItem("ecommerce-image-prompt-template");l&&(q.value=Ge(l))}function Ot(){q.value=ut,localStorage.removeItem("ecommerce-image-prompt-template"),$("提示词模板已重置为默认值","success")}function Rt(){N.apiKey=localStorage.getItem("global_api_key")||localStorage.getItem("video_api_key")||"",N.baseUrl=localStorage.getItem("global_base_url")||localStorage.getItem("video_base_url")||""}async function Nt(){if(B.value)try{await navigator.clipboard.writeText(B.value),$("提示词已复制到剪贴板","success")}catch{$("复制失败","error")}}async function rt(){var e;if(!it.value||V.value)return;V.value=!0,ie.value="",g.value=[];const l=m.generateCount;O.value={current:0,total:l};try{const s={"X-CSRF-Token":qe()},o=kt(N.apiKey);o&&(s["X-API-Key"]=o);const r=bt(N.baseUrl);r&&(s["X-Base-Url"]=r);const c=[];for(const x of S.value){const Z=K.value.find(j=>j.id===x);if(Z)try{const Me=await(await fetch(Z.image_url)).blob();c.push({id:x,blob:Me})}catch{console.warn("Failed to fetch reference image:",Z.image_url)}}const M=async()=>{const x=new FormData;x.append("prompt",B.value),x.append("model",m.model),x.append("response_format","url"),m.aspectRatio&&x.append("aspect_ratio",m.aspectRatio),m.imageSize&&x.append("image_size",m.imageSize);for(const{id:tt,blob:Zt}of c)x.append("image",Zt,`ref-${tt}.jpg`);const Z=await fetch("/api/v1/images/edits",{method:"POST",credentials:"include",headers:s,body:x});if(!Z.ok){const tt=await Z.json().catch(()=>({}));throw new Error(tt.detail||`HTTP ${Z.status}`)}const j=await Z.json(),Me=j.id,qt=j&&typeof j=="object"&&j.response?j.response:j,Jt=Ce(qt,Me)||Ce(j,Me);return O.value.current++,Jt},Qe=Array.from({length:l},()=>M()),Pe=await Promise.allSettled(Qe),Ue=[],et=[];for(const x of Pe)x.status==="fulfilled"&&x.value?Ue.push(x.value):x.status==="rejected"&&et.push(((e=x.reason)==null?void 0:e.message)||"生成失败");if(Ue.length>0)g.value=Ue,$(`成功生成 ${Ue.length} 张图片`,"success"),at();else throw et.length>0?new Error(et[0]):new Error("Invalid response format")}catch(s){ie.value=s.message||"生成失败，请重试"}finally{V.value=!1,O.value={current:0,total:0}}}function Ye(l,e){if(!l)return;const s=document.createElement("a");s.href=l,s.download=`ecommerce-${Date.now()}-${e+1}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s)}async function Gt(){if(g.value.length!==0)for(let l=0;l<g.value.length;l++)Ye(g.value[l],l),l<g.value.length-1&&await new Promise(e=>setTimeout(e,300))}let Xt=0;function $(l,e="info"){const s=Xt++;be.value.push({id:s,message:l,type:e}),setTimeout(()=>{const o=be.value.findIndex(r=>r.id===s);o!==-1&&be.value.splice(o,1)},3e3)}return dt(D,l=>{re.value="",l===2&&Oe()}),dt(ot,l=>{D.value>l&&(D.value=l)}),Yt(()=>{Ht(),Ft(),Rt(),Te(),Tt(),at(),Oe(!0)}),(l,e)=>(i(),n("div",rs,[e[103]||(e[103]=ve('<header class="header"><div class="logo"><div class="logo-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></div><span>电商图生成</span></div><div class="header-actions"><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> 返回主页面 </a></div></header>',1)),t("nav",ds,[t("div",us,[(i(),n(h,null,f(me,s=>t("button",{key:s.id,class:y(["wizard-step",{active:D.value===s.id,completed:J(s.id),disabled:!Xe(s.id)}]),"aria-current":D.value===s.id?"step":void 0,"aria-disabled":!Xe(s.id),onClick:o=>yt(s.id)},[t("span",ps,[J(s.id)?(i(),n("svg",vs,[...e[33]||(e[33]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(i(),n("span",gs,a(s.id),1))]),t("span",ms,a(s.title),1)],10,cs)),64))]),re.value?(i(),n("div",hs,a(re.value),1)):d("",!0)]),t("div",fs,[t("aside",ys,[t("section",ks,[e[40]||(e[40]=ve('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg> Model Selection </div>',1)),p(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=s=>m.model=s)},[...e[34]||(e[34]=[t("option",{value:"gemini-3-pro-image-preview"},"gemini-3-pro-image-preview (推荐)",-1),t("option",{value:"gemini-2.5-flash-image"},"gemini-2.5-flash-image (快速)",-1)])],512),[[Ve,m.model]]),t("div",bs,[e[36]||(e[36]=t("label",{class:"form-label"},"Aspect Ratio",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>m.aspectRatio=s)},[...e[35]||(e[35]=[ve('<option value="">Auto</option><option value="1:1">1:1 (Square)</option><option value="16:9">16:9 (Landscape)</option><option value="9:16">9:16 (Portrait)</option><option value="4:3">4:3</option><option value="3:4">3:4</option><option value="3:2">3:2</option><option value="2:3">2:3</option><option value="4:5">4:5</option><option value="5:4">5:4</option>',10)])],512),[[Ve,m.aspectRatio]])]),t("div",ws,[e[38]||(e[38]=t("label",{class:"form-label"},"Image Size",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=s=>m.imageSize=s)},[...e[37]||(e[37]=[t("option",{value:""},"Default",-1),t("option",{value:"1K"},"1K",-1),t("option",{value:"2K"},"2K",-1),t("option",{value:"4K"},"4K",-1)])],512),[[Ve,m.imageSize]])]),t("div",_s,[e[39]||(e[39]=t("label",{class:"form-label"},"生成数量",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=s=>m.generateCount=s)},[(i(),n(h,null,f(4,s=>t("option",{key:s,value:s},a(s)+" 张",9,xs)),64))],512),[[Ve,m.generateCount]])])]),t("section",Cs,[e[47]||(e[47]=ve('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Z"></path><path d="M9 2v5"></path><path d="M15 2v5"></path><path d="M2 9h20"></path></svg> 选择产品 </div>',1)),t("div",Ts,[e[41]||(e[41]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)),p(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[4]||(e[4]=s=>ye.value=s),placeholder:"搜索产品...",onInput:wt},null,544),[[z,ye.value]])]),!fe.value&&he.value.length>0?(i(),n("div",$s,[(i(!0),n(h,null,f(he.value,s=>{var o,r,c;return i(),n("div",{key:s.id,class:y(["product-item",{selected:((o=P.value)==null?void 0:o.id)===s.id,loading:de.value===s.id}]),onClick:M=>Et(s)},[t("div",Bs,[t("img",{src:jt(s),alt:s.name,class:"product-thumb"},null,8,Ps),s.image_count>1?(i(),n("span",Us,a(s.image_count),1)):d("",!0)]),t("div",Ms,[t("div",Ds,a(s.name||"未命名产品"),1),t("div",Vs,[s.dimensions?(i(),n("span",js,a(s.dimensions),1)):d("",!0),s.dimensions&&s.image_count?(i(),n("span",Es,"·")):d("",!0),s.image_count?(i(),n("span",zs,a(s.image_count)+" 张",1)):d("",!0)])]),t("div",{class:y(["product-select-indicator",{active:((r=P.value)==null?void 0:r.id)===s.id}])},[de.value===s.id?(i(),n("div",Is)):((c=P.value)==null?void 0:c.id)===s.id?(i(),n("svg",Ls,[...e[42]||(e[42]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):d("",!0)],2)],10,Ss)}),128))])):!fe.value&&he.value.length===0?(i(),n("div",Ks,[...e[43]||(e[43]=[t("p",null,"暂无产品",-1),t("a",{href:"/products",class:"btn btn-secondary btn-sm"},"前往产品库",-1)])])):(i(),n("div",Hs,[...e[44]||(e[44]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])])),Le.value>ze?(i(),n("div",As,[t("button",{class:"btn btn-ghost btn-sm",disabled:F.value<=1,onClick:Dt},[...e[45]||(e[45]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)])],8,Fs),t("span",Os,a(F.value)+" / "+a(He.value),1),t("button",{class:"btn btn-ghost btn-sm",disabled:F.value>=He.value,onClick:Vt},[...e[46]||(e[46]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9 18 15 12 9 6"})],-1)])],8,Rs)])):d("",!0)]),P.value?(i(),n("section",Ns,[t("div",Gs,[e[48]||(e[48]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("polyline",{points:"21 15 16 10 5 21"})],-1)),I(" 参考图片 ("+a(S.value.length)+"/"+a(K.value.length)+") ",1)]),K.value.length>0?(i(),n("div",Xs,[(i(!0),n(h,null,f(K.value,s=>(i(),n("div",{key:s.id,class:y(["image-item",{selected:S.value.includes(s.id)}]),onClick:o=>zt(s.id)},[t("img",{src:s.image_url,alt:"Product image"},null,8,Js),S.value.includes(s.id)?(i(),n("div",Zs,[...e[49]||(e[49]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white","stroke-width":"3"},[t("polyline",{points:"20 6 9 17 4 12"})],-1)])])):d("",!0),s.is_primary?(i(),n("div",Ws,"主图")):d("",!0)],10,qs))),128))])):(i(),n("div",Ys,[...e[50]||(e[50]=[t("p",null,"该产品暂无图片",-1)])]))])):d("",!0)]),t("main",Qs,[ae(pt,{name:"step-fade",mode:"out-in"},{default:A(()=>[D.value===1?(i(),n("section",el,[t("div",tl,[t("div",sl,[e[51]||(e[51]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"1"),t("div",null,[t("h3",null,"产品选择"),t("p",{class:"panel-subtitle"},"选择产品与参考图，并完善提示词字段")])],-1)),P.value?d("",!0):(i(),n("span",ll,"请先从左侧选择产品"))]),P.value?(i(),n("div",nl,[t("div",il,[t("label",ol,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>w.name=s)},null,512),[[je,w.name]]),e[52]||(e[52]=t("span",null,"产品名称",-1))]),p(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[6]||(e[6]=s=>b.name=s),disabled:!w.name,placeholder:"例如：保温杯"},null,8,al),[[z,b.name]])]),t("div",rl,[t("label",dl,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>w.dimensions=s)},null,512),[[je,w.dimensions]]),e[53]||(e[53]=t("span",null,"尺寸规格",-1))]),p(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[8]||(e[8]=s=>b.dimensions=s),disabled:!w.dimensions,placeholder:"例如：500ml"},null,8,ul),[[z,b.dimensions]])]),t("div",cl,[t("label",pl,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>w.features=s)},null,512),[[je,w.features]]),e[54]||(e[54]=t("span",null,"功能特征",-1))]),p(t("textarea",{class:"form-input","onUpdate:modelValue":e[10]||(e[10]=s=>b.featuresText=s),disabled:!w.features,rows:"2",placeholder:"每行一个特征"},null,8,vl),[[z,b.featuresText]])]),t("div",gl,[t("label",ml,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=s=>w.characteristics=s)},null,512),[[je,w.characteristics]]),e[55]||(e[55]=t("span",null,"产品特点",-1))]),p(t("textarea",{class:"form-input","onUpdate:modelValue":e[12]||(e[12]=s=>b.characteristicsText=s),disabled:!w.characteristics,rows:"2",placeholder:"每行一个特点"},null,8,hl),[[z,b.characteristicsText]])])])):(i(),n("div",fl," 选择产品后将自动填充名称、规格与特征信息。 "))])])):D.value===2?(i(),n("section",yl,[t("div",kl,[t("div",{class:"panel-header"},[e[57]||(e[57]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"2"),t("div",null,[t("h3",null,"模板配置"),t("p",{class:"panel-subtitle"},"点击标签可多选，支持就地编辑")])],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:Kt},[...e[56]||(e[56]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),I(" 重置模板 ",-1)])])]),t("div",bl,[ae(Ee,{title:"场景选择",summary:Fe("scene"),open:X.scene,onToggle:e[14]||(e[14]=s=>_e("scene"))},{actions:A(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[13]||(e[13]=k(s=>Ze("scene"),["stop"]))},[...e[58]||(e[58]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:A(()=>[t("div",wl,[(i(!0),n(h,null,f(v.scene,s=>(i(),n("div",{key:s.id,class:y(["option-chip",{selected:C.scene.includes(s.id),editing:R("scene",s.id)}])},[R("scene",s.id)?p((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:oe,onKeydown:ge(k(oe,["prevent"]),["enter"])},null,40,xl)),[[z,s.label]]):(i(),n("span",{key:0,onClick:o=>Je("scene",s.id)},a(s.label),9,_l)),R("scene",s.id)?d("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:k(o=>Se("scene",s.id),["stop"])},[...e[59]||(e[59]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Cl)),t("button",{class:"chip-delete",onClick:k(o=>$e("scene",s.id),["stop"])},[...e[60]||(e[60]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Tl)],2))),128))])]),_:1},8,["summary","open"]),ae(Ee,{title:"拍摄角度",summary:Fe("angle"),open:X.angle,onToggle:e[16]||(e[16]=s=>_e("angle"))},{actions:A(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[15]||(e[15]=k(s=>Ze("angle"),["stop"]))},[...e[61]||(e[61]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:A(()=>[t("div",$l,[(i(!0),n(h,null,f(v.angle,s=>(i(),n("div",{key:s.id,class:y(["option-chip",{selected:C.angle.includes(s.id),editing:R("angle",s.id)}])},[R("angle",s.id)?p((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:oe,onKeydown:ge(k(oe,["prevent"]),["enter"])},null,40,Bl)),[[z,s.label]]):(i(),n("span",{key:0,onClick:o=>Je("angle",s.id)},a(s.label),9,Sl)),R("angle",s.id)?d("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:k(o=>Se("angle",s.id),["stop"])},[...e[62]||(e[62]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Pl)),t("button",{class:"chip-delete",onClick:k(o=>$e("angle",s.id),["stop"])},[...e[63]||(e[63]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Ul)],2))),128))])]),_:1},8,["summary","open"]),ae(Ee,{title:"风格 / 光影",summary:Fe("style"),open:X.style,onToggle:e[18]||(e[18]=s=>_e("style"))},{"title-extra":A(()=>[...e[64]||(e[64]=[t("span",{class:"optional-tag"},"(可选)",-1)])]),actions:A(()=>[t("button",{class:"btn btn-ghost btn-icon-sm",onClick:e[17]||(e[17]=k(s=>Ze("style"),["stop"]))},[...e[65]||(e[65]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),default:A(()=>[t("div",Ml,[(i(!0),n(h,null,f(v.style,s=>(i(),n("div",{key:s.id,class:y(["option-chip",{selected:C.style.includes(s.id),editing:R("style",s.id)}])},[R("style",s.id)?p((i(),n("input",{key:1,type:"text",class:"option-edit-input","onUpdate:modelValue":o=>s.label=o,"data-option-id":s.id,onBlur:oe,onKeydown:ge(k(oe,["prevent"]),["enter"])},null,40,Vl)),[[z,s.label]]):(i(),n("span",{key:0,onClick:o=>Je("style",s.id)},a(s.label),9,Dl)),R("style",s.id)?d("",!0):(i(),n("button",{key:2,class:"chip-edit",onClick:k(o=>Se("style",s.id),["stop"])},[...e[66]||(e[66]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,jl)),t("button",{class:"chip-delete",onClick:k(o=>$e("style",s.id),["stop"])},[...e[67]||(e[67]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,El)],2))),128))])]),_:1},8,["summary","open"]),ae(Ee,{title:"生成目标",summary:ee.value?ee.value.name:"未选择",open:X.target,onToggle:e[22]||(e[22]=s=>_e("target"))},{default:A(()=>[t("div",zl,[t("div",Il,[(i(!0),n(h,null,f(ce.value,s=>(i(),n("label",{key:s.id,class:y(["target-type-radio",{selected:H.value===s.id}])},[p(t("input",{type:"radio",name:"target-type",value:s.id,"onUpdate:modelValue":e[19]||(e[19]=o=>H.value=o),onChange:o=>Mt(s.id)},null,40,Ll),[[Qt,H.value]]),t("span",Kl,a(s.name),1)],2))),128))]),H.value?(i(),n("div",Hl,[G.value.length>0?(i(),n("div",Al,[e[69]||(e[69]=t("label",{class:"target-description-label"},"已保存的描述",-1)),t("div",Fl,[(i(!0),n(h,null,f(G.value,s=>(i(),n("div",{key:s.id,class:y(["saved-description-item",{active:Q.value===s.id}])},[t("button",{class:"saved-description-btn",onClick:o=>St(s)},a(s.name),9,Ol),t("button",{class:"saved-description-delete",onClick:k(o=>Pt(s.id),["stop"]),title:"删除"},[...e[68]||(e[68]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Rl)],2))),128))])])):d("",!0),e[71]||(e[71]=t("label",{class:"target-description-label"},"目标描述",-1)),p(t("textarea",{class:"form-input target-textarea","onUpdate:modelValue":e[20]||(e[20]=s=>T.value=s),placeholder:mt.value,disabled:gt.value||le.value,rows:"3"},null,8,Nl),[[z,T.value]]),t("div",Gl,[t("button",{class:"btn btn-secondary btn-sm",type:"button",onClick:e[21]||(e[21]=s=>ne.value=!0),disabled:!T.value.trim()||le.value},[...e[70]||(e[70]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),t("polyline",{points:"17 21 17 13 7 13 7 21"}),t("polyline",{points:"7 3 7 8 15 8"})],-1),I(" 保存描述 ",-1)])],8,Xl),t("button",{class:"btn btn-ghost btn-sm",type:"button",onClick:Ut,disabled:!ee.value}," 重置为默认 ",8,ql)]),e[72]||(e[72]=t("p",{class:"target-description-hint"}," 描述将作为生成提示词的一部分，请详细描述您期望的效果 ",-1))])):d("",!0),Ke.value?(i(),n("div",Jl,[...e[73]||(e[73]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载目标类型...",-1)])])):d("",!0)])]),_:1},8,["summary","open"])]),t("div",Zl,[t("div",{class:"template-editor-header"},[e[75]||(e[75]=t("div",null,[t("h4",null,"提示词模板"),t("p",{class:"template-editor-subtitle"},"系统会自动拼接已选信息，可补充额外描述")],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:Ot},[...e[74]||(e[74]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),I(" 重置模板 ",-1)])])]),t("div",Wl,[e[76]||(e[76]=t("div",{class:"template-editor-hint"}," 已选场景/角度等会自动生成，例如：场景：客厅，拍摄角度：正面。 ",-1)),p(t("textarea",{class:"form-input template-textarea","onUpdate:modelValue":e[23]||(e[23]=s=>q.value=s),rows:"4",placeholder:"补充提示词",onInput:At},null,544),[[z,q.value]])])])])])):D.value===3?(i(),n("section",Yl,[t("div",Ql,[t("div",en,[e[77]||(e[77]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"3"),t("div",null,[t("h3",null,"提示词预览"),t("p",{class:"panel-subtitle"},"分段预览并高亮关键信息")])],-1)),B.value?d("",!0):(i(),n("span",tn,"完善产品信息与模板后自动生成"))]),t("div",sn,[t("div",ln,[e[78]||(e[78]=t("span",{class:"prompt-label"},"产品信息",-1)),t("div",{class:y(["prompt-value",{empty:U.value.product.length===0}])},[U.value.product.length?(i(!0),n(h,{key:0},f(U.value.product,(s,o)=>(i(),n("span",{key:`product-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",nn,"未选择或未填写"))],2)]),t("div",on,[e[79]||(e[79]=t("span",{class:"prompt-label"},"场景",-1)),t("div",{class:y(["prompt-value",{empty:U.value.scene.length===0}])},[U.value.scene.length?(i(!0),n(h,{key:0},f(U.value.scene,(s,o)=>(i(),n("span",{key:`scene-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",an,"未选择场景"))],2)]),t("div",rn,[e[80]||(e[80]=t("span",{class:"prompt-label"},"角度",-1)),t("div",{class:y(["prompt-value",{empty:U.value.angle.length===0}])},[U.value.angle.length?(i(!0),n(h,{key:0},f(U.value.angle,(s,o)=>(i(),n("span",{key:`angle-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",dn,"未选择角度"))],2)]),t("div",un,[e[81]||(e[81]=t("span",{class:"prompt-label"},"风格 / 光影",-1)),t("div",{class:y(["prompt-value",{empty:U.value.style.length===0}])},[U.value.style.length?(i(!0),n(h,{key:0},f(U.value.style,(s,o)=>(i(),n("span",{key:`style-${o}`,class:"prompt-chip"},a(s),1))),128)):(i(),n("span",cn,"未选择风格"))],2)]),t("div",pn,[e[82]||(e[82]=t("span",{class:"prompt-label"},"生成目标",-1)),t("div",{class:y(["prompt-value",{empty:!T.value}])},[T.value?(i(),n("span",vn,[ee.value?(i(),n("span",gn,a(ee.value.name)+"：",1)):d("",!0),I(" "+a(T.value),1)])):(i(),n("span",mn,"未选择目标"))],2)])]),t("div",hn,[t("div",fn,[e[84]||(e[84]=t("div",null,[t("h4",null,"完整 Prompt"),t("p",{class:"prompt-full-hint"},"可直接复制用于生成")],-1)),t("button",{class:"btn btn-ghost btn-sm",onClick:Nt,disabled:!B.value},[...e[83]||(e[83]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1),I(" 复制 ",-1)])],8,yn)]),t("div",kn,[B.value?(i(),n("p",bn,a(B.value),1)):(i(),n("p",wn,"选择产品和模板选项后，提示词将在这里生成。"))])])])])):(i(),n("section",_n,[t("div",xn,[t("div",Cn,[e[85]||(e[85]=t("div",{class:"panel-title"},[t("span",{class:"step-indicator"},"4"),t("div",null,[t("h3",null,"生成与结果"),t("p",{class:"panel-subtitle"},"确认参考图与提示词后开始生成")])],-1)),xe.value?(i(),n("span",Tn,a(xe.value),1)):d("",!0)]),t("div",$n,[!V.value&&g.value.length===0?(i(),n("div",Sn,[...e[86]||(e[86]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("polyline",{points:"21 15 16 10 5 21"})],-1),t("h3",null,"准备生成",-1),t("p",null,"选择产品、参考图片与模板选项，然后点击生成。",-1)])])):d("",!0),V.value?(i(),n("div",Bn,[e[87]||(e[87]=t("div",{class:"spinner"},null,-1)),O.value.total>1?(i(),n("p",Pn,"正在生成图片 ("+a(O.value.current)+"/"+a(O.value.total)+")...",1)):(i(),n("p",Un,"正在生成图片..."))])):d("",!0),g.value.length>0&&!V.value?(i(),n("div",Mn,[t("div",{class:y(["result-grid",{"single-image":g.value.length===1}])},[(i(!0),n(h,null,f(g.value,(s,o)=>(i(),n("div",{key:o,class:"result-image-item"},[t("img",{src:s,alt:"Generated image",class:"result-image"},null,8,Dn),t("div",Vn,[t("button",{class:"btn btn-ghost btn-icon",onClick:r=>Ye(s,o),title:"下载"},[...e[88]||(e[88]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,jn)])]))),128))],2),t("div",En,[g.value.length>1?(i(),n("button",{key:0,class:"btn btn-secondary",onClick:Gt},[e[89]||(e[89]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)),I(" 下载全部 ("+a(g.value.length)+") ",1)])):(i(),n("button",{key:1,class:"btn btn-secondary",onClick:e[24]||(e[24]=s=>Ye(g.value[0],0))},[...e[90]||(e[90]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),I(" 下载 ",-1)])])),t("button",{class:"btn btn-primary",onClick:rt},[...e[91]||(e[91]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),I(" 重新生成 ",-1)])])])])):d("",!0)]),t("div",zn,[t("button",{class:"generate-btn",disabled:!it.value||V.value,onClick:rt},[V.value?(i(),n("div",Kn)):(i(),n("svg",Ln,[...e[92]||(e[92]=[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),I(" "+a(V.value?"生成中...":"生成电商图"),1)],8,In),xe.value?(i(),n("div",Hn,a(xe.value),1)):d("",!0)]),se.value.length>0||ue.value?(i(),n("div",An,[t("div",Fn,[e[93]||(e[93]=t("h4",null,[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})]),I(" 生成历史 ")],-1)),se.value.length>0?(i(),n("span",On,"("+a(se.value.length)+")",1)):d("",!0)]),!ue.value&&se.value.length>0?(i(),n("div",Rn,[(i(!0),n(h,null,f(se.value,s=>(i(),n("div",{key:s.id,class:"history-item",onClick:o=>_t(s)},[t("img",{src:s.image_url||vt,alt:s.prompt,class:"history-thumb"},null,8,Gn),t("div",Xn,[t("div",qn,a(xt(s.prompt,40)),1),t("div",Jn,a(Ct(s.created_at)),1)])],8,Nn))),128))])):ue.value?(i(),n("div",Zn,[...e[94]||(e[94]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])])):d("",!0)])):d("",!0)])]))]),_:1})]),t("aside",Wn,[t("div",Yn,[t("div",Qn,[e[95]||(e[95]=t("h4",null,"提示词预览",-1)),B.value?d("",!0):(i(),n("span",ei,"完成前两步后显示"))]),t("div",ti,[B.value?(i(),n("p",si,a(B.value),1)):(i(),n("p",li,"选择产品与模板选项后生成提示词。"))])]),t("div",ni,[t("div",ii,[e[96]||(e[96]=t("h4",null,"生成结果",-1)),g.value.length>1?(i(),n("span",oi,"("+a(g.value.length)+")",1)):d("",!0)]),t("div",ai,[V.value?(i(),n("div",ri,[e[97]||(e[97]=t("div",{class:"spinner-small"},null,-1)),O.value.total>1?(i(),n("span",di,a(O.value.current)+"/"+a(O.value.total),1)):(i(),n("span",ui,"正在生成..."))])):g.value.length>0?(i(),n("div",ci,[(i(!0),n(h,null,f(g.value.slice(0,4),(s,o)=>(i(),n("img",{key:o,src:s,alt:"Generated preview",class:"preview-image"},null,8,pi))),128))])):(i(),n("p",vi,"生成完成后显示结果。"))])])])]),t("div",gi,[(i(!0),n(h,null,f(be.value,s=>(i(),n("div",{key:s.id,class:y(["toast",s.type])},a(s.message),3))),128))]),ie.value?(i(),n("div",{key:0,class:"error-overlay",onClick:e[27]||(e[27]=s=>ie.value="")},[t("div",{class:"error-modal",onClick:e[26]||(e[26]=k(()=>{},["stop"]))},[e[98]||(e[98]=ve('<div class="error-header"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><h3>生成失败</h3></div>',1)),t("p",null,a(ie.value),1),t("button",{class:"btn btn-primary",onClick:e[25]||(e[25]=s=>ie.value="")},"确定")])])):d("",!0),ne.value?(i(),n("div",{key:1,class:"save-dialog-overlay",onClick:e[32]||(e[32]=s=>ne.value=!1)},[t("div",{class:"save-dialog-modal",onClick:e[31]||(e[31]=k(()=>{},["stop"]))},[t("div",mi,[e[100]||(e[100]=t("h3",null,"保存目标描述",-1)),t("button",{class:"save-dialog-close",onClick:e[28]||(e[28]=s=>ne.value=!1)},[...e[99]||(e[99]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),t("div",hi,[t("div",fi,[e[101]||(e[101]=t("label",{class:"form-label"},"描述名称",-1)),p(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[29]||(e[29]=s=>pe.value=s),placeholder:"例如：清新自然风格",maxlength:"100"},null,512),[[z,pe.value]])]),t("div",yi,[e[102]||(e[102]=t("label",{class:"form-label"},"描述内容",-1)),t("textarea",{class:"form-input",value:T.value,readonly:"",rows:"3"},null,8,ki)])]),t("div",bi,[t("button",{class:"btn btn-secondary",onClick:e[30]||(e[30]=s=>ne.value=!1)},"取消"),t("button",{class:"btn btn-primary",onClick:Bt,disabled:!pe.value.trim()||le.value},a(le.value?"保存中...":"保存"),9,wi)])])])):d("",!0)]))}});ts(_i).mount("#app");
