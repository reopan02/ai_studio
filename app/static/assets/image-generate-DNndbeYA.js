import{d as te,m as j,r as u,c as H,o as oe,a,b as i,g as y,e as t,f,w,z as I,F as B,p as $,t as v,i as z,k as se,n as L,q as M,j as ne}from"./runtime-dom.esm-bundler-D9CM_geE.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                        */const ie={class:"ecommerce-image-page"},le={class:"main-container"},re={class:"sidebar"},de={class:"sidebar-section"},ce={class:"sidebar-section"},ue={class:"form-group"},ve={class:"form-group"},pe={class:"form-group"},ge=["value"],me={class:"sidebar-section"},fe={key:0,class:"product-list"},he=["onClick"],ye=["src","alt"],we={class:"product-info"},ke={class:"product-name"},_e={class:"product-meta"},be={key:1,class:"product-list-empty"},xe={key:2,class:"product-list-loading"},Ce={class:"main-content"},Ie={class:"content-panel"},Be={class:"panel-header"},$e={class:"panel-hint"},Ue={class:"result-area"},Ke={key:0,class:"result-placeholder"},Se={key:1,class:"loading-state"},je={key:2,class:"result-container"},ze=["onClick"],Me=["src"],De={class:"image-overlay"},Te=["onClick"],Ve={class:"generate-section"},Fe=["disabled"],He={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Le={key:1,class:"spinner-small"},Re={key:0,class:"generate-hint"},Ae=["src"],Ee={class:"toast-container"},Ne=te({__name:"image-generate-page",setup(Ge){const k=j({apiKey:"",baseUrl:""}),R="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
  <rect width="100" height="100" fill="#1a1a2e"/>
  <rect x="25" y="25" width="50" height="50" rx="4" fill="none" stroke="#4a4a6a" stroke-width="2"/>
  <circle cx="38" cy="38" r="5" fill="#4a4a6a"/>
  <path d="M25 65 L45 45 L55 55 L75 35 L75 75 L25 75 Z" fill="#4a4a6a" opacity="0.5"/>
</svg>
`),U=j({model:"gemini-3-pro-image-preview"}),r=j({n:1,size:"1K",aspectRatio:""}),p=u(""),d=u(!1),c=u([]),m=u(""),_=u([]),h=u(""),b=u([]),x=u(!1),K=H(()=>p.value.trim().length>0),A=H(()=>p.value.trim()?"":"请输入图像描述");function E(){const s=document.cookie.match(/csrf_token=([^;]+)/);return s?s[1]:""}function N(s){return String(s||"").trim().replace(/^bearer\s+/i,"").trim()}function P(s){return String(s||"").trim()||null}function S(s,e){if(!s||typeof s!="object")return[];const o=[];if(Array.isArray(s.data))for(let l=0;l<s.data.length;l++){const n=s.data[l];e?o.push(`/api/v1/images/${e}/data/${l}`):n!=null&&n.saved_url?o.push(n.saved_url):n!=null&&n.url?o.push(n.url):n!=null&&n.b64_json&&o.push(`data:image/png;base64,${n.b64_json}`)}return o.length===0&&(e&&s.b64_json?o.push(`/api/v1/images/${e}/data/0`):s.saved_url?o.push(s.saved_url):s.url?o.push(s.url):s.b64_json&&o.push(`data:image/png;base64,${s.b64_json}`)),s.image_url&&!o.includes(s.image_url)&&o.push(s.image_url),o}async function D(){x.value=!0;try{const s=await fetch("/api/v1/images?limit=20",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch history");const e=await s.json();b.value=e||[]}catch(s){console.error("Failed to load history:",s)}finally{x.value=!1}}async function G(s){p.value=s.prompt||"";try{const e=await fetch(`/api/v1/images/${s.id}`,{credentials:"include"});if(e.ok){const o=await e.json();if(o.response){const l=S(o.response,s.id);if(l.length>0){c.value=l;return}}}}catch(e){console.warn("Failed to fetch image detail:",e)}s.image_url&&(c.value=[s.image_url])}function X(s,e){return s?s.length<=e?s:s.substring(0,e)+"...":""}function q(s){return s?new Date(s).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function O(){}function Z(){k.apiKey=localStorage.getItem("global_api_key")||localStorage.getItem("video_api_key")||"",k.baseUrl=localStorage.getItem("global_base_url")||localStorage.getItem("video_base_url")||""}async function J(){if(!(!K.value||d.value)){d.value=!0,m.value="";try{const s=new FormData;s.append("prompt",p.value),s.append("model",U.model),s.append("n",String(r.n)),s.append("size",r.size),s.append("response_format","url"),r.aspectRatio&&s.append("aspect_ratio",r.aspectRatio);const e={"X-CSRF-Token":E()},o=N(k.apiKey);o&&(e["X-API-Key"]=o);const l=P(k.baseUrl);l&&(e["X-Base-Url"]=l);const n=await fetch("/api/v1/images/generations",{method:"POST",credentials:"include",headers:e,body:s});if(!n.ok){const C=await n.json().catch(()=>({}));throw new Error(C.detail||`HTTP ${n.status}`)}const g=await n.json(),V=g.id,ee=g&&typeof g=="object"&&g.response?g.response:g,F=S(ee,V);if(F.length===0){const C=S(g,V);if(C.length>0)c.value=C;else throw new Error("未能获取生成的图像")}else c.value=F;Y("图像生成成功","success"),D()}catch(s){m.value=s.message||"生成失败，请重试"}finally{d.value=!1}}}function T(s,e){const o=document.createElement("a");o.href=s,o.download=`generated-${Date.now()}-${e}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function Q(s){h.value=s}let W=0;function Y(s,e="info"){const o=W++;_.value.push({id:o,message:s,type:e}),setTimeout(()=>{const l=_.value.findIndex(n=>n.id===o);l!==-1&&_.value.splice(l,1)},3e3)}return oe(()=>{Z(),D()}),(s,e)=>(i(),a("div",ie,[e[29]||(e[29]=y('<header class="header" data-v-81cd735d><div class="logo" data-v-81cd735d><div class="logo-icon" data-v-81cd735d><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" data-v-81cd735d><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" data-v-81cd735d></polygon></svg></div><span data-v-81cd735d>图像生成</span></div><div class="header-actions" data-v-81cd735d><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;" data-v-81cd735d><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-81cd735d><path d="M19 12H5M12 19l-7-7 7-7" data-v-81cd735d></path></svg> 返回主页面 </a></div></header>',1)),t("div",le,[t("aside",re,[t("section",de,[e[12]||(e[12]=y('<div class="section-title" data-v-81cd735d><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-81cd735d><polygon points="12 2 2 7 12 12 22 7 12 2" data-v-81cd735d></polygon><polyline points="2 17 12 22 22 17" data-v-81cd735d></polyline><polyline points="2 12 12 17 22 12" data-v-81cd735d></polyline></svg> 模型选择 </div>',1)),w(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=o=>U.model=o)},[...e[11]||(e[11]=[t("option",{value:"gemini-3-pro-image-preview"},"gemini-3-pro-image-preview (推荐)",-1),t("option",{value:"gemini-2.5-flash-image"},"gemini-2.5-flash-image (快速)",-1)])],512),[[I,U.model]])]),t("section",ce,[e[18]||(e[18]=y('<div class="section-title" data-v-81cd735d><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-81cd735d><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-81cd735d></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-81cd735d></circle><polyline points="21 15 16 10 5 21" data-v-81cd735d></polyline></svg> 图像设置 </div>',1)),t("div",ue,[e[14]||(e[14]=t("label",{class:"form-label"},"宽高比",-1)),w(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=o=>r.aspectRatio=o)},[...e[13]||(e[13]=[y('<option value="" data-v-81cd735d>自动</option><option value="1:1" data-v-81cd735d>1:1 (正方形)</option><option value="16:9" data-v-81cd735d>16:9 (横向)</option><option value="9:16" data-v-81cd735d>9:16 (纵向)</option><option value="4:3" data-v-81cd735d>4:3 (标准)</option><option value="3:4" data-v-81cd735d>3:4 (竖版)</option><option value="3:2" data-v-81cd735d>3:2 (照片)</option><option value="2:3" data-v-81cd735d>2:3 (竖版照片)</option>',8)])],512),[[I,r.aspectRatio]])]),t("div",ve,[e[16]||(e[16]=t("label",{class:"form-label"},"图像尺寸",-1)),w(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=o=>r.size=o)},[...e[15]||(e[15]=[t("option",{value:"1K"},"1K (默认)",-1),t("option",{value:"2K"},"2K (高清)",-1),t("option",{value:"4K"},"4K (超高清)",-1)])],512),[[I,r.size]])]),t("div",pe,[e[17]||(e[17]=t("label",{class:"form-label"},"生成数量",-1)),w(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=o=>r.n=o)},[(i(),a(B,null,$(4,o=>t("option",{key:o,value:o},v(o)+" 张",9,ge)),64))],512),[[I,r.n]])])]),t("section",me,[e[21]||(e[21]=t("div",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})]),z(" 生成历史 ")],-1)),!x.value&&b.value.length>0?(i(),a("div",fe,[(i(!0),a(B,null,$(b.value,o=>(i(),a("div",{key:o.id,class:"product-item",onClick:l=>G(o)},[t("img",{src:o.image_url||R,alt:o.prompt,class:"product-thumb"},null,8,ye),t("div",we,[t("div",ke,v(X(o.prompt,30)),1),t("div",_e,v(q(o.created_at)),1)])],8,he))),128))])):!x.value&&b.value.length===0?(i(),a("div",be,[...e[19]||(e[19]=[t("p",null,"暂无生成历史",-1)])])):(i(),a("div",xe,[...e[20]||(e[20]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])]))])]),t("main",Ce,[t("div",Ie,[t("div",Be,[e[22]||(e[22]=t("h3",null,"描述您想要生成的图像",-1)),t("span",$e,v(p.value.length)+"/1000 字符",1)]),w(t("textarea",{class:"form-input","onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),rows:"4",maxlength:"1000",placeholder:"请详细描述您想要生成的图像，例如：一只可爱的橘色小猫咪坐在窗台上，阳光透过窗户洒在它身上，背景是模糊的城市天际线...",onInput:O},null,544),[[se,p.value]])]),t("div",Ue,[!d.value&&c.value.length===0?(i(),a("div",Ke,[...e[23]||(e[23]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1),t("h3",null,"准备生成",-1),t("p",null,"输入描述后点击生成按钮创建图像",-1)])])):f("",!0),d.value?(i(),a("div",Se,[...e[24]||(e[24]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成图像...",-1)])])):f("",!0),c.value.length>0&&!d.value?(i(),a("div",je,[t("div",{class:L(["image-grid",{"single-image":c.value.length===1}])},[(i(!0),a(B,null,$(c.value,(o,l)=>(i(),a("div",{key:l,class:"generated-image-item",onClick:n=>Q(o)},[t("img",{src:o,alt:"Generated image"},null,8,Me),t("div",De,[t("button",{class:"btn btn-ghost btn-icon",onClick:M(n=>T(o,l),["stop"])},[...e[25]||(e[25]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Te)])],8,ze))),128))],2)])):f("",!0)]),t("div",Ve,[t("button",{class:"generate-btn",disabled:!K.value||d.value,onClick:J},[d.value?(i(),a("div",Le)):(i(),a("svg",He,[...e[26]||(e[26]=[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),z(" "+v(d.value?"生成中...":"生成图像"),1)],8,Fe),K.value?f("",!0):(i(),a("div",Re,v(A.value),1))])])]),h.value?(i(),a("div",{key:0,class:"error-overlay",onClick:e[7]||(e[7]=o=>h.value="")},[t("div",{class:"lightbox-content",onClick:e[6]||(e[6]=M(()=>{},["stop"]))},[t("img",{src:h.value,alt:"Full size image"},null,8,Ae),t("button",{class:"btn btn-secondary",onClick:e[5]||(e[5]=o=>T(h.value,0)),style:{"margin-top":"16px"}},[...e[27]||(e[27]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),z(" 下载 ",-1)])])])])):f("",!0),t("div",Ee,[(i(!0),a(B,null,$(_.value,o=>(i(),a("div",{key:o.id,class:L(["toast",o.type])},v(o.message),3))),128))]),m.value?(i(),a("div",{key:1,class:"error-overlay",onClick:e[10]||(e[10]=o=>m.value="")},[t("div",{class:"error-modal",onClick:e[9]||(e[9]=M(()=>{},["stop"]))},[e[28]||(e[28]=y('<div class="error-header" data-v-81cd735d><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-81cd735d><circle cx="12" cy="12" r="10" data-v-81cd735d></circle><line x1="12" y1="8" x2="12" y2="12" data-v-81cd735d></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-81cd735d></line></svg><h3 data-v-81cd735d>生成失败</h3></div>',1)),t("p",null,v(m.value),1),t("button",{class:"btn btn-primary",onClick:e[8]||(e[8]=o=>m.value="")},"确定")])])):f("",!0)]))}}),Pe=ae(Ne,[["__scopeId","data-v-81cd735d"]]);ne(Pe).mount("#app");
