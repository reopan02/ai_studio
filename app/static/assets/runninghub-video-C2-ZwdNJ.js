import{d as O,q as E,r as g,c as B,o as D,a as r,b as a,g as M,e,f as p,i as y,w as f,h as G,G as L,E as R,t as v,l as H,F as P,p as j,n as F,u as J,y as K,s as Y,x as X,j as Z,k as Q}from"./supabase-Bkt_6nLH.js";/* empty css                   */async function W(S){const m=await S.text();try{const l=JSON.parse(m);return String((l==null?void 0:l.detail)||(l==null?void 0:l.error)||(l==null?void 0:l.message)||m)}catch{return m||`HTTP ${S.status}`}}const tt={class:"video-page"},et={class:"main-container"},ot={class:"sidebar"},st={class:"sidebar-section config-section"},nt={class:"form-group"},it={class:"input-wrapper"},lt=["type"],rt={class:"form-group"},at={class:"checkbox-item",style:{"user-select":"none"}},ut={class:"form-group"},dt=["disabled"],pt={class:"sidebar-section"},vt={class:"form-group"},ct={class:"form-group"},mt={class:"form-group"},gt={class:"main-content"},yt={class:"content-panel"},ft={class:"panel-header"},ht={class:"panel-hint"},kt={class:"content-panel"},wt={key:0,class:"image-preview",style:{"margin-top":"12px"}},xt=["src"],bt={class:"result-area"},_t={key:0,class:"result-placeholder"},St={key:1,class:"loading-state"},Ct={key:2,class:"result-container"},Ut={class:"content-panel",style:{"margin-bottom":"16px"}},Bt={class:"panel-header"},Mt={class:"panel-hint"},Rt={style:{display:"grid",gap:"8px","font-size":"13px",color:"var(--text-secondary)"}},Vt={key:0},Tt={key:1,style:{color:"#ef4444"}},Et={key:0,class:"result-video-container"},Ht=["src"],Nt={key:1,class:"result-actions"},$t=["disabled"],It={key:0,class:"spinner-small"},At={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},qt={class:"content-panel",style:{"margin-top":"16px"}},zt={style:{"white-space":"pre-wrap","margin-top":"12px","font-size":"12px",color:"var(--text-secondary)"}},Ot={class:"generate-section"},Dt=["disabled"],Gt={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Lt={key:1,class:"spinner-small"},Pt={key:0,class:"generate-hint"},jt={class:"toast-container"},Ft=O({__name:"runninghub-video-page",setup(S){const m={token:"runninghub_token",autoSave:"runninghub_auto_save"},l=E({token:"",autoSave:!0}),s=E({prompt:"",imageUrl:"",resolution:"1080p",aspectRatio:"16:9",duration:4}),C=g(!1),d=g(!1),b=g(!1),u=g(null),c=g(""),h=g(""),x=g([]),U=B(()=>!!s.prompt.trim()&&!!s.imageUrl.trim()),N=B(()=>s.prompt.trim()?s.imageUrl.trim()?"":"请输入图片 URL":"请输入提示词"),V=B(()=>{const n=s.imageUrl.trim();return!n||!/^https?:\/\//i.test(n)?"":n});function k(n,t="info",o=3e3){const i=`${Date.now()}-${Math.random().toString(16).slice(2)}`,w={id:i,message:n,type:t};x.value=[...x.value,w],window.setTimeout(()=>{x.value=x.value.filter(_=>_.id!==i)},o)}function $(){l.token=localStorage.getItem(m.token)||"",localStorage.getItem(m.autoSave)==="0"&&(l.autoSave=!1)}function I(){localStorage.setItem(m.token,l.token),localStorage.setItem(m.autoSave,l.autoSave?"1":"0"),k("配置已保存","success")}function A(n){var o,i;const t=((i=(o=n==null?void 0:n.results)==null?void 0:o[0])==null?void 0:i.url)||"";return String(t||"").trim()}async function T(n){var t,o;if(!c.value){n&&k("缺少视频链接，无法保存","warning");return}b.value=!0;try{const i={title:`RunningHub ${((t=u.value)==null?void 0:t.task_id)||""}`.trim(),model:"runninghub-video-s",prompt:s.prompt.trim(),video_url:c.value,status:"completed",metadata:{provider:"runninghub",provider_task_id:((o=u.value)==null?void 0:o.task_id)||null,resolution:s.resolution,aspect_ratio:s.aspectRatio,duration:s.duration,image_url:s.imageUrl.trim()},request:{prompt:s.prompt.trim(),resolution:s.resolution,aspect_ratio:s.aspectRatio,image_url:s.imageUrl.trim(),duration:s.duration},response:u.value},w=await K();if(!w)throw new Error("Not authenticated");const{error:_}=await Y.from("user_videos").insert({user_id:w,title:i.title,model:i.model,prompt:i.prompt,status:i.status,video_url:i.video_url,metadata:i.metadata,request:i.request,response:i.response});if(_)throw new Error(_.message);k("已保存到存储库","success")}catch(i){const w=String((i==null?void 0:i.message)||i||"保存失败");k(`保存失败：${w}`,"error")}finally{b.value=!1}}async function q(){if(!(!U.value||d.value)){d.value=!0,h.value="",u.value=null,c.value="";try{const n={"Content-Type":"application/json"};l.token.trim()&&(n["X-RunningHub-Token"]=l.token.trim());const t=await X("/api/v1/runninghub/image-to-video-realistic",{method:"POST",headers:n,body:JSON.stringify({prompt:s.prompt.trim(),resolution:s.resolution,aspect_ratio:s.aspectRatio,image_url:s.imageUrl.trim(),duration:s.duration})});if(!t.ok)throw new Error(await W(t));const o=await t.json();u.value=o;const i=A(o);if(i){c.value=i,k("生成成功","success"),l.autoSave&&await T(!1);return}k(`已提交任务（状态：${o.status}）`,"info")}catch(n){h.value=String((n==null?void 0:n.message)||n||"生成失败")}finally{d.value=!1}}}function z(){var t;if(!c.value)return;const n=document.createElement("a");n.href=c.value,n.download=`runninghub-${((t=u.value)==null?void 0:t.task_id)||"video"}.mp4`,n.rel="noopener",document.body.appendChild(n),n.click(),n.remove()}return D(()=>{$()}),(n,t)=>(a(),r("div",tt,[t[38]||(t[38]=M('<header class="header"><div class="logo"><div class="logo-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><polygon points="10 8 16 12 10 16" fill="white" stroke="none"></polygon></svg></div><span>RunningHub 图生视频</span></div><div class="header-actions"><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> 返回主页面 </a><a href="/storage" class="btn btn-ghost btn-icon" title="生成记录" style="text-decoration:none;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg></a></div></header>',1)),e("div",et,[e("aside",ot,[e("section",st,[t[16]||(t[16]=e("div",{class:"section-title"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4"})]),y(" 配置 ")],-1)),e("div",nt,[t[13]||(t[13]=e("label",{class:"form-label"},"RunningHub Token（可选）",-1)),e("div",it,[f(e("input",{type:C.value?"text":"password",class:"form-input","onUpdate:modelValue":t[0]||(t[0]=o=>l.token=o),placeholder:"后端已配置 RUNNINGHUB_API_KEY 可留空",autocomplete:"current-password"},null,8,lt),[[G,l.token]]),e("button",{class:"toggle-visibility",type:"button",onClick:t[1]||(t[1]=o=>C.value=!C.value)},[...t[12]||(t[12]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),t[14]||(t[14]=e("div",{class:"form-hint"},"请求头：Authorization: Bearer <token>",-1))]),e("div",rt,[e("label",at,[f(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>l.autoSave=o)},null,512),[[L,l.autoSave]]),t[15]||(t[15]=e("span",null,"生成成功后自动保存到存储库",-1))])]),e("div",ut,[e("button",{class:"btn btn-secondary",style:{width:"100%"},disabled:d.value,onClick:I}," 保存配置 ",8,dt)])]),e("section",pt,[t[23]||(t[23]=M('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line></svg> 参数 </div>',1)),e("div",vt,[t[18]||(t[18]=e("label",{class:"form-label"},"分辨率",-1)),f(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=o=>s.resolution=o)},[...t[17]||(t[17]=[e("option",{value:"720p"},"720p",-1),e("option",{value:"1080p"},"1080p",-1)])],512),[[R,s.resolution]])]),e("div",ct,[t[20]||(t[20]=e("label",{class:"form-label"},"画幅比例",-1)),f(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=o=>s.aspectRatio=o)},[...t[19]||(t[19]=[e("option",{value:"16:9"},"16:9（横向）",-1),e("option",{value:"9:16"},"9:16（纵向）",-1)])],512),[[R,s.aspectRatio]])]),e("div",mt,[t[22]||(t[22]=e("label",{class:"form-label"},"时长（秒）",-1)),f(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=o=>s.duration=o)},[...t[21]||(t[21]=[e("option",{value:4},"4",-1),e("option",{value:8},"8",-1),e("option",{value:12},"12",-1)])],512),[[R,s.duration,void 0,{number:!0}]])])])]),e("main",gt,[e("div",yt,[e("div",ft,[t[24]||(t[24]=e("h3",null,"输入提示词",-1)),e("span",ht,v(s.prompt.length)+"/1000 字符",1)]),f(e("textarea",{class:"form-input","onUpdate:modelValue":t[6]||(t[6]=o=>s.prompt=o),rows:"4",maxlength:"1000",placeholder:"例如：一位女孩在海边，风吹动头发，写实风格..."},null,512),[[H,s.prompt]])]),e("div",kt,[t[25]||(t[25]=e("div",{class:"panel-header"},[e("h3",null,"输入图片 URL"),e("span",{class:"panel-hint"},"需要可公网访问的 http(s) 地址")],-1)),f(e("input",{class:"form-input","onUpdate:modelValue":t[7]||(t[7]=o=>s.imageUrl=o),placeholder:"https://example.com/input.png"},null,512),[[H,s.imageUrl]]),V.value?(a(),r("div",wt,[e("img",{src:V.value,alt:"input preview",style:{"max-width":"100%","border-radius":"12px"}},null,8,xt)])):p("",!0)]),e("div",bt,[!d.value&&!u.value?(a(),r("div",_t,[...t[26]||(t[26]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}),e("polygon",{points:"10 8 16 12 10 16"})],-1),e("h3",null,"准备生成",-1),e("p",null,"填写提示词与图片 URL 后点击「生成视频」",-1)])])):p("",!0),d.value?(a(),r("div",St,[...t[27]||(t[27]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在提交任务...",-1)])])):p("",!0),u.value&&!d.value?(a(),r("div",Ct,[e("div",Ut,[e("div",Bt,[t[28]||(t[28]=e("h3",null,"任务状态",-1)),e("span",Mt,v(u.value.status),1)]),e("div",Rt,[e("div",null,[t[29]||(t[29]=e("span",{style:{color:"var(--text-muted)"}},"task_id：",-1)),y(v(u.value.task_id),1)]),u.value.prompt_tips?(a(),r("div",Vt,[t[30]||(t[30]=e("span",{style:{color:"var(--text-muted)"}},"prompt_tips：",-1)),y(v(u.value.prompt_tips),1)])):p("",!0),u.value.error_message?(a(),r("div",Tt,[t[31]||(t[31]=e("span",{style:{color:"var(--text-muted)"}},"error：",-1)),y(v(u.value.error_message),1)])):p("",!0)])]),c.value?(a(),r("div",Et,[e("video",{src:c.value,controls:"",preload:"metadata"},null,8,Ht)])):p("",!0),c.value?(a(),r("div",Nt,[e("button",{class:"btn btn-secondary",onClick:z},[...t[32]||(t[32]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),y(" 下载 ",-1)])]),e("button",{class:"btn btn-secondary",disabled:b.value,onClick:t[8]||(t[8]=o=>T(!0))},[b.value?(a(),r("div",It)):(a(),r("svg",At,[...t[33]||(t[33]=[e("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},null,-1),e("polyline",{points:"17 21 17 13 7 13 7 21"},null,-1),e("polyline",{points:"7 3 7 8 15 8"},null,-1)])])),t[34]||(t[34]=y(" 保存到存储库 ",-1))],8,$t)])):p("",!0),e("details",qt,[t[35]||(t[35]=e("summary",{style:{cursor:"pointer","font-weight":"500"}},"查看原始响应",-1)),e("pre",zt,v(JSON.stringify(u.value,null,2)),1)])])):p("",!0)]),e("div",Ot,[e("button",{class:"generate-btn",disabled:!U.value||d.value,onClick:q},[d.value?(a(),r("div",Lt)):(a(),r("svg",Gt,[...t[36]||(t[36]=[e("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),y(" "+v(d.value?"生成中...":"生成视频"),1)],8,Dt),U.value?p("",!0):(a(),r("div",Pt,v(N.value),1))])])]),e("div",jt,[(a(!0),r(P,null,j(x.value,o=>(a(),r("div",{key:o.id,class:F(["toast",o.type])},v(o.message),3))),128))]),h.value?(a(),r("div",{key:0,class:"error-overlay",onClick:t[11]||(t[11]=o=>h.value="")},[e("div",{class:"error-modal",onClick:t[10]||(t[10]=J(()=>{},["stop"]))},[t[37]||(t[37]=M('<div class="error-header"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><h3>生成失败</h3></div>',1)),e("p",null,v(h.value),1),e("button",{class:"btn btn-primary",onClick:t[9]||(t[9]=o=>h.value="")},"确定")])])):p("",!0)]))}});async function Jt(){await Z(),Q(Ft).mount("#app")}Jt();
