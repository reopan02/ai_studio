import{d as v,r as l,a as f,b as w,e as t,w as p,k as c,l as g,n as h,t as y,h as m,j as x}from"./runtime-dom.esm-bundler-BMO6sHJC.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                   */function b(){const a=new URL(window.location.href).searchParams.get("next")||"/";return!a.startsWith("/")||a.includes("://")||a.startsWith("//")?"/":a}async function T(o){const a=await o.text();try{const s=JSON.parse(a);return String((s==null?void 0:s.detail)||(s==null?void 0:s.error)||(s==null?void 0:s.message)||a)}catch{return a||`HTTP ${o.status}`}}const O={class:"container"},k={class:"card auth-card"},E={class:"form-group"},P={class:"form-group"},S={class:"auth-actions"},N=["disabled"],B={id:"error",class:"auth-error",role:"alert","aria-live":"polite"},C=v({__name:"login-page",setup(o){const a=l(""),s=l(""),r=l(""),n=l(!1);async function d(){r.value="";const i=a.value.trim();if(!i||!s.value){r.value="请输入用户名/邮箱和密码";return}n.value=!0;try{const e=await fetch("/api/v1/auth/login?set_cookie=1",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username_or_email:i,password:s.value})});if(!e.ok)throw new Error(await T(e));window.location.href=b()}catch(e){r.value=(e==null?void 0:e.message)||"登录失败"}finally{n.value=!1}}return(i,e)=>(w(),f("div",O,[t("main",null,[t("section",k,[e[6]||(e[6]=t("h2",null,"登录",-1)),t("div",E,[e[2]||(e[2]=t("label",{for:"usernameOrEmail"},"用户名或邮箱",-1)),p(t("input",{id:"usernameOrEmail","onUpdate:modelValue":e[0]||(e[0]=u=>a.value=u),type:"text",autocomplete:"username",placeholder:"输入用户名或邮箱"},null,512),[[c,a.value]])]),t("div",P,[e[3]||(e[3]=t("label",{for:"password"},"密码",-1)),p(t("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=u=>s.value=u),type:"password",autocomplete:"current-password",placeholder:"输入密码",onKeydown:g(d,["enter"])},null,544),[[c,s.value]])]),t("div",S,[t("button",{id:"loginBtn",class:h(["primary-btn",{loading:n.value}]),type:"button",disabled:n.value,onClick:d},[...e[4]||(e[4]=[t("span",{class:"btn-text"},"登录",-1),t("span",{class:"loader"},null,-1)])],10,N),e[5]||(e[5]=t("a",{class:"meta-text",href:"/",style:{"text-decoration":"none"}},"返回首页",-1))]),t("div",B,y(r.value),1),e[7]||(e[7]=t("div",{class:"auth-meta"},[m(" 没有账号？请使用 "),t("code",null,"POST /api/v1/auth/register"),m(" 注册后再登录。 ")],-1))])])]))}}),V=_(C,[["__scopeId","data-v-4566f593"]]);x(V).mount("#app");
