import{d as D,m as R,r as m,c as S,o as L,a as l,b as i,g as U,e,f as p,i as g,w as y,h as G,B as J,A as B,t as v,k as T,F as P,q as F,n as K,p as Y,j as q}from"./runtime-dom.esm-bundler-BI5Nxju0.js";/* empty css                   */import{c as H}from"./csrf-B-6zPzK2.js";import{r as N}from"./http-BvltrcKL.js";const X={class:"video-page"},Z={class:"main-container"},Q={class:"sidebar"},W={class:"sidebar-section config-section"},tt={class:"form-group"},et={class:"input-wrapper"},ot=["type"],st={class:"form-group"},nt={class:"checkbox-item",style:{"user-select":"none"}},lt={class:"form-group"},it=["disabled"],at={class:"sidebar-section"},rt={class:"form-group"},dt={class:"form-group"},ut={class:"form-group"},pt={class:"main-content"},vt={class:"content-panel"},ct={class:"panel-header"},mt={class:"panel-hint"},gt={class:"content-panel"},yt={key:0,class:"image-preview",style:{"margin-top":"12px"}},ft=["src"],ht={class:"result-area"},kt={key:0,class:"result-placeholder"},wt={key:1,class:"loading-state"},bt={key:2,class:"result-container"},xt={class:"content-panel",style:{"margin-bottom":"16px"}},_t={class:"panel-header"},Ct={class:"panel-hint"},St={style:{display:"grid",gap:"8px","font-size":"13px",color:"var(--text-secondary)"}},Ut={key:0},Bt={key:1,style:{color:"#ef4444"}},Mt={key:0,class:"result-video-container"},Vt=["src"],Rt={key:1,class:"result-actions"},Tt=["disabled"],Ht={key:0,class:"spinner-small"},Nt={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},$t={class:"content-panel",style:{"margin-top":"16px"}},At={style:{"white-space":"pre-wrap","margin-top":"12px","font-size":"12px",color:"var(--text-secondary)"}},Et={class:"generate-section"},It=["disabled"],zt={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ot={key:1,class:"spinner-small"},jt={key:0,class:"generate-hint"},Dt={class:"toast-container"},Lt=D({__name:"runninghub-video-page",setup(Gt){const b={token:"runninghub_token",autoSave:"runninghub_auto_save"},d=R({token:"",autoSave:!0}),n=R({prompt:"",imageUrl:"",resolution:"1080p",aspectRatio:"16:9",duration:4}),_=m(!1),u=m(!1),x=m(!1),r=m(null),c=m(""),f=m(""),w=m([]),C=S(()=>!!n.prompt.trim()&&!!n.imageUrl.trim()),$=S(()=>n.prompt.trim()?n.imageUrl.trim()?"":"请输入图片 URL":"请输入提示词"),M=S(()=>{const s=n.imageUrl.trim();return!s||!/^https?:\/\//i.test(s)?"":s});function h(s,t="info",o=3e3){const a=`${Date.now()}-${Math.random().toString(16).slice(2)}`,k={id:a,message:s,type:t};w.value=[...w.value,k],window.setTimeout(()=>{w.value=w.value.filter(j=>j.id!==a)},o)}function A(){d.token=localStorage.getItem(b.token)||"",localStorage.getItem(b.autoSave)==="0"&&(d.autoSave=!1)}function E(){localStorage.setItem(b.token,d.token),localStorage.setItem(b.autoSave,d.autoSave?"1":"0"),h("配置已保存","success")}function I(s){var o,a;const t=((a=(o=s==null?void 0:s.results)==null?void 0:o[0])==null?void 0:a.url)||"";return String(t||"").trim()}async function V(s){var t,o;if(!c.value){s&&h("缺少视频链接，无法保存","warning");return}x.value=!0;try{const a={title:`RunningHub ${((t=r.value)==null?void 0:t.task_id)||""}`.trim(),model:"runninghub-video-s",prompt:n.prompt.trim(),video_url:c.value,status:"completed",metadata:{provider:"runninghub",provider_task_id:((o=r.value)==null?void 0:o.task_id)||null,resolution:n.resolution,aspect_ratio:n.aspectRatio,duration:n.duration,image_url:n.imageUrl.trim()}},k=await fetch("/api/v1/videos",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...H()},body:JSON.stringify(a)});if(!k.ok)throw new Error(await N(k));h("已保存到存储库","success")}catch(a){const k=String((a==null?void 0:a.message)||a||"保存失败");h(`保存失败：${k}`,"error")}finally{x.value=!1}}async function z(){if(!(!C.value||u.value)){u.value=!0,f.value="",r.value=null,c.value="";try{const s={"Content-Type":"application/json",...H()};d.token.trim()&&(s["X-RunningHub-Token"]=d.token.trim());const t=await fetch("/api/v1/runninghub/image-to-video-realistic",{method:"POST",credentials:"include",headers:s,body:JSON.stringify({prompt:n.prompt.trim(),resolution:n.resolution,aspect_ratio:n.aspectRatio,image_url:n.imageUrl.trim(),duration:n.duration})});if(!t.ok)throw new Error(await N(t));const o=await t.json();r.value=o;const a=I(o);if(a){c.value=a,h("生成成功","success"),d.autoSave&&await V(!1);return}h(`已提交任务（状态：${o.status}）`,"info")}catch(s){f.value=String((s==null?void 0:s.message)||s||"生成失败")}finally{u.value=!1}}}function O(){var t;if(!c.value)return;const s=document.createElement("a");s.href=c.value,s.download=`runninghub-${((t=r.value)==null?void 0:t.task_id)||"video"}.mp4`,s.rel="noopener",document.body.appendChild(s),s.click(),s.remove()}return L(()=>{A()}),(s,t)=>(i(),l("div",X,[t[38]||(t[38]=U('<header class="header"><div class="logo"><div class="logo-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><polygon points="10 8 16 12 10 16" fill="white" stroke="none"></polygon></svg></div><span>RunningHub 图生视频</span></div><div class="header-actions"><a href="/" class="btn btn-secondary" style="text-decoration:none;display:flex;align-items:center;gap:8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> 返回主页面 </a><a href="/storage" class="btn btn-ghost btn-icon" title="生成记录" style="text-decoration:none;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg></a></div></header>',1)),e("div",Z,[e("aside",Q,[e("section",W,[t[16]||(t[16]=e("div",{class:"section-title"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4"})]),g(" 配置 ")],-1)),e("div",tt,[t[13]||(t[13]=e("label",{class:"form-label"},"RunningHub Token（可选）",-1)),e("div",et,[y(e("input",{type:_.value?"text":"password",class:"form-input","onUpdate:modelValue":t[0]||(t[0]=o=>d.token=o),placeholder:"后端已配置 RUNNINGHUB_API_KEY 可留空",autocomplete:"current-password"},null,8,ot),[[G,d.token]]),e("button",{class:"toggle-visibility",type:"button",onClick:t[1]||(t[1]=o=>_.value=!_.value)},[...t[12]||(t[12]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),t[14]||(t[14]=e("div",{class:"form-hint"},"请求头：Authorization: Bearer <token>",-1))]),e("div",st,[e("label",nt,[y(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>d.autoSave=o)},null,512),[[J,d.autoSave]]),t[15]||(t[15]=e("span",null,"生成成功后自动保存到存储库",-1))])]),e("div",lt,[e("button",{class:"btn btn-secondary",style:{width:"100%"},disabled:u.value,onClick:E}," 保存配置 ",8,it)])]),e("section",at,[t[23]||(t[23]=U('<div class="section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line></svg> 参数 </div>',1)),e("div",rt,[t[18]||(t[18]=e("label",{class:"form-label"},"分辨率",-1)),y(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=o=>n.resolution=o)},[...t[17]||(t[17]=[e("option",{value:"720p"},"720p",-1),e("option",{value:"1080p"},"1080p",-1)])],512),[[B,n.resolution]])]),e("div",dt,[t[20]||(t[20]=e("label",{class:"form-label"},"画幅比例",-1)),y(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=o=>n.aspectRatio=o)},[...t[19]||(t[19]=[e("option",{value:"16:9"},"16:9（横向）",-1),e("option",{value:"9:16"},"9:16（纵向）",-1)])],512),[[B,n.aspectRatio]])]),e("div",ut,[t[22]||(t[22]=e("label",{class:"form-label"},"时长（秒）",-1)),y(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=o=>n.duration=o)},[...t[21]||(t[21]=[e("option",{value:4},"4",-1),e("option",{value:8},"8",-1),e("option",{value:12},"12",-1)])],512),[[B,n.duration,void 0,{number:!0}]])])])]),e("main",pt,[e("div",vt,[e("div",ct,[t[24]||(t[24]=e("h3",null,"输入提示词",-1)),e("span",mt,v(n.prompt.length)+"/1000 字符",1)]),y(e("textarea",{class:"form-input","onUpdate:modelValue":t[6]||(t[6]=o=>n.prompt=o),rows:"4",maxlength:"1000",placeholder:"例如：一位女孩在海边，风吹动头发，写实风格..."},null,512),[[T,n.prompt]])]),e("div",gt,[t[25]||(t[25]=e("div",{class:"panel-header"},[e("h3",null,"输入图片 URL"),e("span",{class:"panel-hint"},"需要可公网访问的 http(s) 地址")],-1)),y(e("input",{class:"form-input","onUpdate:modelValue":t[7]||(t[7]=o=>n.imageUrl=o),placeholder:"https://example.com/input.png"},null,512),[[T,n.imageUrl]]),M.value?(i(),l("div",yt,[e("img",{src:M.value,alt:"input preview",style:{"max-width":"100%","border-radius":"12px"}},null,8,ft)])):p("",!0)]),e("div",ht,[!u.value&&!r.value?(i(),l("div",kt,[...t[26]||(t[26]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}),e("polygon",{points:"10 8 16 12 10 16"})],-1),e("h3",null,"准备生成",-1),e("p",null,"填写提示词与图片 URL 后点击「生成视频」",-1)])])):p("",!0),u.value?(i(),l("div",wt,[...t[27]||(t[27]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在提交任务...",-1)])])):p("",!0),r.value&&!u.value?(i(),l("div",bt,[e("div",xt,[e("div",_t,[t[28]||(t[28]=e("h3",null,"任务状态",-1)),e("span",Ct,v(r.value.status),1)]),e("div",St,[e("div",null,[t[29]||(t[29]=e("span",{style:{color:"var(--text-muted)"}},"task_id：",-1)),g(v(r.value.task_id),1)]),r.value.prompt_tips?(i(),l("div",Ut,[t[30]||(t[30]=e("span",{style:{color:"var(--text-muted)"}},"prompt_tips：",-1)),g(v(r.value.prompt_tips),1)])):p("",!0),r.value.error_message?(i(),l("div",Bt,[t[31]||(t[31]=e("span",{style:{color:"var(--text-muted)"}},"error：",-1)),g(v(r.value.error_message),1)])):p("",!0)])]),c.value?(i(),l("div",Mt,[e("video",{src:c.value,controls:"",preload:"metadata"},null,8,Vt)])):p("",!0),c.value?(i(),l("div",Rt,[e("button",{class:"btn btn-secondary",onClick:O},[...t[32]||(t[32]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),g(" 下载 ",-1)])]),e("button",{class:"btn btn-secondary",disabled:x.value,onClick:t[8]||(t[8]=o=>V(!0))},[x.value?(i(),l("div",Ht)):(i(),l("svg",Nt,[...t[33]||(t[33]=[e("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},null,-1),e("polyline",{points:"17 21 17 13 7 13 7 21"},null,-1),e("polyline",{points:"7 3 7 8 15 8"},null,-1)])])),t[34]||(t[34]=g(" 保存到存储库 ",-1))],8,Tt)])):p("",!0),e("details",$t,[t[35]||(t[35]=e("summary",{style:{cursor:"pointer","font-weight":"500"}},"查看原始响应",-1)),e("pre",At,v(JSON.stringify(r.value,null,2)),1)])])):p("",!0)]),e("div",Et,[e("button",{class:"generate-btn",disabled:!C.value||u.value,onClick:z},[u.value?(i(),l("div",Ot)):(i(),l("svg",zt,[...t[36]||(t[36]=[e("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),g(" "+v(u.value?"生成中...":"生成视频"),1)],8,It),C.value?p("",!0):(i(),l("div",jt,v($.value),1))])])]),e("div",Dt,[(i(!0),l(P,null,F(w.value,o=>(i(),l("div",{key:o.id,class:K(["toast",o.type])},v(o.message),3))),128))]),f.value?(i(),l("div",{key:0,class:"error-overlay",onClick:t[11]||(t[11]=o=>f.value="")},[e("div",{class:"error-modal",onClick:t[10]||(t[10]=Y(()=>{},["stop"]))},[t[37]||(t[37]=U('<div class="error-header"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><h3>生成失败</h3></div>',1)),e("p",null,v(f.value),1),e("button",{class:"btn btn-primary",onClick:t[9]||(t[9]=o=>f.value="")},"确定")])])):p("",!0)]))}});q(Lt).mount("#app");
