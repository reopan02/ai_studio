import{d as ae,r as i,j as K,k as E,o as le,c as n,a,b as t,e as g,i as k,w as h,p as N,f as I,q as H,F as B,m as U,t as c,v as ie,n as L,l as j,g as re}from"./runtime-dom.esm-bundler-CzCxjph-.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                        */const ue={class:"ecommerce-image-page"},ce={class:"header"},ve={class:"header-actions"},pe={class:"main-container"},ge={class:"sidebar"},me={key:0,class:"sidebar-section"},fe={class:"form-group"},ye={class:"input-wrapper"},he=["type"],be={class:"form-group"},ke={class:"input-wrapper"},we=["type"],xe={class:"sidebar-section"},Ce={class:"sidebar-section"},_e={class:"form-group"},Ie=["value"],Be={class:"form-group"},Ue={class:"sidebar-section"},Ae={key:0,class:"product-list"},Se=["onClick"],Me=["src","alt"],$e={class:"product-info"},Ve={class:"product-name"},ze={class:"product-meta"},Ke={key:1,class:"product-list-empty"},He={key:2,class:"product-list-loading"},je={class:"main-content"},De={class:"content-panel"},Pe={class:"panel-header"},Te={class:"panel-hint"},Fe={class:"result-area"},Ee={key:0,class:"result-placeholder"},Ne={key:1,class:"loading-state"},Le={key:2,class:"result-container"},Ge=["onClick"],Xe=["src"],Re={class:"image-overlay"},qe=["onClick"],Oe={class:"generate-section"},Ze=["disabled"],Je={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Qe={key:1,class:"spinner-small"},We={key:0,class:"generate-hint"},Ye=["src"],et={class:"toast-container"},tt=ae({__name:"image-generate-page",setup(st){const A=i(!1),S=i(!1),M=i(!1),l=K({apiKey:"",baseUrl:""}),$=K({model:"gpt-image-1.5"}),m=K({n:1,size:"1024x1024"}),v=i(""),r=i(!1),p=i([]),f=i(""),w=i([]),b=i(""),x=i([]),C=i(!1),V=E(()=>v.value.trim().length>0),G=E(()=>v.value.trim()?"":"请输入图像描述");function X(){const s=document.cookie.match(/csrf_token=([^;]+)/);return s?s[1]:""}function R(s){return String(s||"").trim().replace(/^bearer\s+/i,"").trim()}function q(s){return String(s||"").trim()||null}function D(s){if(!s||typeof s!="object")return[];const e=[];if(Array.isArray(s.data))for(const o of s.data)o!=null&&o.url?e.push(o.url):o!=null&&o.b64_json&&e.push(`data:image/png;base64,${o.b64_json}`);return s.url&&e.push(s.url),s.b64_json&&e.push(`data:image/png;base64,${s.b64_json}`),s.image_url&&e.push(s.image_url),e}async function P(){C.value=!0;try{const s=await fetch("/api/v1/images?limit=20",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch history");const e=await s.json();x.value=e||[]}catch(s){console.error("Failed to load history:",s)}finally{C.value=!1}}function O(s){v.value=s.prompt||"",s.image_url&&(p.value=[s.image_url])}function Z(s,e){return s?s.length<=e?s:s.substring(0,e)+"...":""}function J(s){return s?new Date(s).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function Q(){}function W(){localStorage.setItem("image-edit-api-key",l.apiKey),localStorage.setItem("image-edit-base-url",l.baseUrl),z("API 配置已保存","success")}function Y(){l.apiKey="",l.baseUrl="",localStorage.removeItem("image-edit-api-key"),localStorage.removeItem("image-edit-base-url"),z("API 配置已重置","success")}function ee(){l.apiKey=localStorage.getItem("image-edit-api-key")||"",l.baseUrl=localStorage.getItem("image-edit-base-url")||""}async function te(){if(!(!V.value||r.value)){r.value=!0,f.value="";try{const s=new FormData;s.append("prompt",v.value),s.append("model",$.model),s.append("n",String(m.n)),s.append("size",m.size),s.append("response_format","url");const e={"X-CSRF-Token":X()},o=R(l.apiKey);o&&(e["X-API-Key"]=o);const d=q(l.baseUrl);d&&(e["X-Base-Url"]=d);const u=await fetch("/api/v1/images/generations",{method:"POST",credentials:"include",headers:e,body:s});if(!u.ok){const _=await u.json().catch(()=>({}));throw new Error(_.detail||`HTTP ${u.status}`)}const y=await u.json(),ne=y&&typeof y=="object"&&y.response?y.response:y,F=D(ne);if(F.length===0){const _=D(y);if(_.length>0)p.value=_;else throw new Error("未能获取生成的图像")}else p.value=F;z("图像生成成功","success"),P()}catch(s){f.value=s.message||"生成失败，请重试"}finally{r.value=!1}}}function T(s,e){const o=document.createElement("a");o.href=s,o.download=`generated-${Date.now()}-${e}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function oe(s){b.value=s}let se=0;function z(s,e="info"){const o=se++;w.value.push({id:o,message:s,type:e}),setTimeout(()=>{const d=w.value.findIndex(u=>u.id===o);d!==-1&&w.value.splice(d,1)},3e3)}return le(()=>{ee(),P()}),(s,e)=>(a(),n("div",ue,[t("header",ce,[e[17]||(e[17]=t("div",{class:"logo"},[t("div",{class:"logo-icon"},[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"white","stroke-width":"2"},[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})])]),t("span",null,"图像生成")],-1)),t("div",ve,[e[16]||(e[16]=t("a",{href:"/",class:"btn btn-secondary",style:{"text-decoration":"none",display:"flex","align-items":"center",gap:"8px"}},[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})]),k(" 返回主页面 ")],-1)),t("button",{class:"btn btn-ghost btn-icon",onClick:e[0]||(e[0]=o=>A.value=!A.value),title:"Settings"},[...e[15]||(e[15]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"3"}),t("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})],-1)])])])]),t("div",pe,[t("aside",ge,[A.value?(a(),n("section",me,[e[22]||(e[22]=t("div",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),t("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4"})]),k(" API 配置 ")],-1)),t("div",fe,[e[19]||(e[19]=t("label",{class:"form-label"},"API Key",-1)),t("div",ye,[h(t("input",{type:S.value?"text":"password",class:"form-input","onUpdate:modelValue":e[1]||(e[1]=o=>l.apiKey=o),placeholder:"输入 API Key"},null,8,he),[[N,l.apiKey]]),t("button",{class:"toggle-visibility",onClick:e[2]||(e[2]=o=>S.value=!S.value)},[...e[18]||(e[18]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t("circle",{cx:"12",cy:"12",r:"3"})],-1)])])])]),t("div",be,[e[21]||(e[21]=t("label",{class:"form-label"},"Base URL",-1)),t("div",ke,[h(t("input",{type:M.value?"text":"password",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=o=>l.baseUrl=o),placeholder:"https://api.example.com"},null,8,we),[[N,l.baseUrl]]),t("button",{class:"toggle-visibility",onClick:e[4]||(e[4]=o=>M.value=!M.value)},[...e[20]||(e[20]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t("circle",{cx:"12",cy:"12",r:"3"})],-1)])])])]),t("div",{class:"btn-group"},[t("button",{class:"btn btn-primary btn-sm",onClick:W},"保存"),t("button",{class:"btn btn-secondary btn-sm",onClick:Y},"重置")])])):g("",!0),t("section",xe,[e[24]||(e[24]=I('<div class="section-title" data-v-fa9a2ddc><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-fa9a2ddc><polygon points="12 2 2 7 12 12 22 7 12 2" data-v-fa9a2ddc></polygon><polyline points="2 17 12 22 22 17" data-v-fa9a2ddc></polyline><polyline points="2 12 12 17 22 12" data-v-fa9a2ddc></polyline></svg> 模型选择 </div>',1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=o=>$.model=o)},[...e[23]||(e[23]=[I('<option value="gpt-image-1.5" data-v-fa9a2ddc>gpt-image-1.5</option><option value="nano-banana-2-4k" data-v-fa9a2ddc>nano-banana-2-4k</option><option value="nano-banana-2-2k" data-v-fa9a2ddc>nano-banana-2-2k</option><option value="nano-banana-2" data-v-fa9a2ddc>nano-banana-2</option><option value="nano-banana" data-v-fa9a2ddc>nano-banana</option>',5)])],512),[[H,$.model]])]),t("section",Ce,[e[28]||(e[28]=I('<div class="section-title" data-v-fa9a2ddc><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-fa9a2ddc><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-fa9a2ddc></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-fa9a2ddc></circle><polyline points="21 15 16 10 5 21" data-v-fa9a2ddc></polyline></svg> 图像设置 </div>',1)),t("div",_e,[e[25]||(e[25]=t("label",{class:"form-label"},"生成数量",-1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[6]||(e[6]=o=>m.n=o)},[(a(),n(B,null,U(10,o=>t("option",{key:o,value:o},c(o)+" 张",9,Ie)),64))],512),[[H,m.n]])]),t("div",Be,[e[27]||(e[27]=t("label",{class:"form-label"},"图像尺寸",-1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=o=>m.size=o)},[...e[26]||(e[26]=[t("option",{value:"1024x1024"},"1024x1024 (大)",-1),t("option",{value:"512x512"},"512x512 (中)",-1),t("option",{value:"256x256"},"256x256 (小)",-1)])],512),[[H,m.size]])])]),t("section",Ue,[e[31]||(e[31]=t("div",{class:"section-title"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})]),k(" 生成历史 ")],-1)),!C.value&&x.value.length>0?(a(),n("div",Ae,[(a(!0),n(B,null,U(x.value,o=>(a(),n("div",{key:o.id,class:"product-item",onClick:d=>O(o)},[t("img",{src:o.image_url||"/static/placeholder.png",alt:o.prompt,class:"product-thumb"},null,8,Me),t("div",$e,[t("div",Ve,c(Z(o.prompt,30)),1),t("div",ze,c(J(o.created_at)),1)])],8,Se))),128))])):!C.value&&x.value.length===0?(a(),n("div",Ke,[...e[29]||(e[29]=[t("p",null,"暂无生成历史",-1)])])):(a(),n("div",He,[...e[30]||(e[30]=[t("div",{class:"spinner-small"},null,-1),t("span",null,"加载中...",-1)])]))])]),t("main",je,[t("div",De,[t("div",Pe,[e[32]||(e[32]=t("h3",null,"描述您想要生成的图像",-1)),t("span",Te,c(v.value.length)+"/1000 字符",1)]),h(t("textarea",{class:"form-input","onUpdate:modelValue":e[8]||(e[8]=o=>v.value=o),rows:"4",maxlength:"1000",placeholder:"请详细描述您想要生成的图像，例如：一只可爱的橘色小猫咪坐在窗台上，阳光透过窗户洒在它身上，背景是模糊的城市天际线...",onInput:Q},null,544),[[ie,v.value]])]),t("div",Fe,[!r.value&&p.value.length===0?(a(),n("div",Ee,[...e[33]||(e[33]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1),t("h3",null,"准备生成",-1),t("p",null,"输入描述后点击生成按钮创建图像",-1)])])):g("",!0),r.value?(a(),n("div",Ne,[...e[34]||(e[34]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成图像...",-1)])])):g("",!0),p.value.length>0&&!r.value?(a(),n("div",Le,[t("div",{class:L(["image-grid",{"single-image":p.value.length===1}])},[(a(!0),n(B,null,U(p.value,(o,d)=>(a(),n("div",{key:d,class:"generated-image-item",onClick:u=>oe(o)},[t("img",{src:o,alt:"Generated image"},null,8,Xe),t("div",Re,[t("button",{class:"btn btn-ghost btn-icon",onClick:j(u=>T(o,d),["stop"])},[...e[35]||(e[35]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,qe)])],8,Ge))),128))],2)])):g("",!0)]),t("div",Oe,[t("button",{class:"generate-btn",disabled:!V.value||r.value,onClick:te},[r.value?(a(),n("div",Qe)):(a(),n("svg",Je,[...e[36]||(e[36]=[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])])),k(" "+c(r.value?"生成中...":"生成图像"),1)],8,Ze),V.value?g("",!0):(a(),n("div",We,c(G.value),1))])])]),b.value?(a(),n("div",{key:0,class:"error-overlay",onClick:e[11]||(e[11]=o=>b.value="")},[t("div",{class:"lightbox-content",onClick:e[10]||(e[10]=j(()=>{},["stop"]))},[t("img",{src:b.value,alt:"Full size image"},null,8,Ye),t("button",{class:"btn btn-secondary",onClick:e[9]||(e[9]=o=>T(b.value,0)),style:{"margin-top":"16px"}},[...e[37]||(e[37]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),k(" 下载 ",-1)])])])])):g("",!0),t("div",et,[(a(!0),n(B,null,U(w.value,o=>(a(),n("div",{key:o.id,class:L(["toast",o.type])},c(o.message),3))),128))]),f.value?(a(),n("div",{key:1,class:"error-overlay",onClick:e[14]||(e[14]=o=>f.value="")},[t("div",{class:"error-modal",onClick:e[13]||(e[13]=j(()=>{},["stop"]))},[e[38]||(e[38]=I('<div class="error-header" data-v-fa9a2ddc><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-fa9a2ddc><circle cx="12" cy="12" r="10" data-v-fa9a2ddc></circle><line x1="12" y1="8" x2="12" y2="12" data-v-fa9a2ddc></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-fa9a2ddc></line></svg><h3 data-v-fa9a2ddc>生成失败</h3></div>',1)),t("p",null,c(f.value),1),t("button",{class:"btn btn-primary",onClick:e[12]||(e[12]=o=>f.value="")},"确定")])])):g("",!0)]))}}),ot=de(tt,[["__scopeId","data-v-fa9a2ddc"]]);re(ot).mount("#app");
